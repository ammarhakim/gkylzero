#include <gkyl_ambi_bolt_potential_kernels.h>

GKYL_CU_DH void ambi_bolt_potential_sheath_calc_lower_3x_ser_p1(double sheathDirDx, double q_e, double m_e, double T_e, const double *cmag, const double *jacobtotInv, const double *GammaJac_i, const double *m0Ion, const double *m0JacIon, double *out) 
{ 
  // sheathDirDx: cell length in direction of the sheath.
  // q_e:         electron change.
  // m_e:         electron mass.
  // T_e:         electron temperature.
  // cmag:        Clebsch function in definition of magnetic field.
  // jacobtotInv: reciprocal of the phase-space and conf-space Jacobians (1/(J*B)).
  // GammaJac_i:  ion particle flux (times the Jacobian) through sheath entrance.
  // m0Ion:       ion density.
  // m0JacIon:    ion density (times the geometry Jacobian).
  // out:         ion density and electrostatic potential at the sheath entrance.

  // Particle number density evaluate at the sheath entrance
  out[0] = m0Ion[0]-1.7320508075688772*m0Ion[3]; 
  out[1] = m0Ion[1]-1.7320508075688772*m0Ion[5]; 
  out[2] = m0Ion[2]-1.7320508075688772*m0Ion[6]; 
  out[4] = m0Ion[4]-1.7320508075688772*m0Ion[7]; 

  double GammaJacIonB[4];
  GammaJacIonB[0] = 0.6123724356957944*GammaJac_i[3]*sheathDirDx+0.3535533905932737*GammaJac_i[0]*sheathDirDx; 
  GammaJacIonB[1] = 0.6123724356957944*GammaJac_i[5]*sheathDirDx+0.3535533905932737*GammaJac_i[1]*sheathDirDx; 
  GammaJacIonB[2] = 0.6123724356957944*GammaJac_i[6]*sheathDirDx+0.3535533905932737*GammaJac_i[2]*sheathDirDx; 
  GammaJacIonB[3] = 0.6123724356957944*GammaJac_i[7]*sheathDirDx+0.3535533905932737*GammaJac_i[4]*sheathDirDx; 

  double x3HalfMomJacElcB[4];
  x3HalfMomJacElcB[0] = -(0.18322594196359493*cmag[3]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e))+0.10578554691520431*cmag[0]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e)-0.18322594196359493*jacobtotInv[3]*cmag[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[5]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[5]*sqrt(T_e/m_e)-0.18322594196359493*m0JacIon[3]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*m0JacIon[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[1]*cmag[3]*jacobtotInv[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[1]*jacobtotInv[5]*sqrt(T_e/m_e)-0.06107531398786498*m0JacIon[0]*cmag[1]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*m0JacIon[3]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[1]*jacobtotInv[3]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[1]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*m0JacIon[0]*jacobtotInv[1]*cmag[5]*sqrt(T_e/m_e)-0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[1]*jacobtotInv[1]*m0JacIon[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*cmag[3]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[1]*m0JacIon[1]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[0]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[1]*m0JacIon[1]*cmag[3]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[0]*cmag[3]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[1]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*cmag[1]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*m0JacIon[0]*cmag[1]*jacobtotInv[1]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[0]*sqrt(T_e/m_e); 
  x3HalfMomJacElcB[1] = -(0.32980669553447084*cmag[5]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e))+0.19041398444736776*cmag[1]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.19041398444736776*jacobtotInv[1]*cmag[5]*m0JacIon[5]*sqrt(T_e/m_e)-0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[5]*sqrt(T_e/m_e)-0.10993556517815695*cmag[1]*jacobtotInv[1]*m0JacIon[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[5]*sqrt(T_e/m_e)+0.19041398444736776*m0JacIon[1]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)-0.18322594196359493*cmag[3]*m0JacIon[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*m0JacIon[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*cmag[3]*jacobtotInv[5]*sqrt(T_e/m_e)-0.10993556517815695*cmag[1]*m0JacIon[1]*jacobtotInv[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[0]*jacobtotInv[5]*sqrt(T_e/m_e)-0.18322594196359493*jacobtotInv[3]*m0JacIon[3]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*m0JacIon[3]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*jacobtotInv[3]*cmag[5]*sqrt(T_e/m_e)-0.10993556517815695*jacobtotInv[1]*m0JacIon[1]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[0]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[3]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[1]*cmag[3]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[1]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*m0JacIon[0]*cmag[1]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[1]*cmag[3]*sqrt(T_e/m_e)-0.06107531398786498*m0JacIon[0]*jacobtotInv[1]*cmag[3]*sqrt(T_e/m_e)+0.06347132814912258*cmag[1]*jacobtotInv[1]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*m0JacIon[0]*jacobtotInv[1]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*m0JacIon[0]*cmag[1]*sqrt(T_e/m_e); 
  x3HalfMomJacElcB[2] = -(0.18322594196359493*cmag[3]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e))+0.10578554691520431*cmag[0]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e)-0.18322594196359493*jacobtotInv[3]*cmag[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[7]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[7]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[7]*sqrt(T_e/m_e)-0.18322594196359493*cmag[5]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[5]*m0JacIon[6]*sqrt(T_e/m_e)-0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[6]*sqrt(T_e/m_e)-0.06107531398786498*cmag[1]*jacobtotInv[1]*m0JacIon[6]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[3]*m0JacIon[4]*jacobtotInv[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[4]*jacobtotInv[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[1]*m0JacIon[2]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[3]*m0JacIon[4]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[4]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[1]*m0JacIon[2]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[1]*jacobtotInv[3]*m0JacIon[4]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[1]*cmag[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[1]*m0JacIon[4]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*cmag[1]*m0JacIon[4]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*cmag[3]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[2]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[2]*cmag[3]*sqrt(T_e/m_e)+0.03526184897173477*cmag[1]*jacobtotInv[1]*m0JacIon[2]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[2]*sqrt(T_e/m_e); 
  x3HalfMomJacElcB[3] = -(0.32980669553447084*cmag[5]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e))+0.19041398444736776*cmag[1]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.19041398444736776*jacobtotInv[1]*cmag[5]*m0JacIon[7]*sqrt(T_e/m_e)-0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[7]*sqrt(T_e/m_e)-0.10993556517815695*cmag[1]*jacobtotInv[1]*m0JacIon[7]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[7]*sqrt(T_e/m_e)-0.18322594196359493*cmag[3]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)-0.18322594196359493*jacobtotInv[3]*cmag[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[6]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[6]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[6]*sqrt(T_e/m_e)+0.19041398444736776*m0JacIon[4]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)-0.10993556517815695*cmag[1]*m0JacIon[4]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*cmag[3]*jacobtotInv[5]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*m0JacIon[2]*jacobtotInv[5]*sqrt(T_e/m_e)-0.10993556517815695*jacobtotInv[1]*m0JacIon[4]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*jacobtotInv[3]*cmag[5]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*m0JacIon[2]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[3]*jacobtotInv[3]*m0JacIon[4]*sqrt(T_e/m_e)-0.06107531398786498*cmag[0]*jacobtotInv[3]*m0JacIon[4]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[0]*cmag[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.06347132814912258*cmag[1]*jacobtotInv[1]*m0JacIon[4]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[4]*sqrt(T_e/m_e)-0.06107531398786498*cmag[1]*m0JacIon[2]*jacobtotInv[3]*sqrt(T_e/m_e)-0.06107531398786498*jacobtotInv[1]*m0JacIon[2]*cmag[3]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[1]*m0JacIon[2]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*cmag[1]*m0JacIon[2]*sqrt(T_e/m_e); 

  double m0JacIonB[4];
  m0JacIonB[0] = 0.7071067811865475*m0JacIon[0]-1.224744871391589*m0JacIon[3]; 
  m0JacIonB[1] = 0.7071067811865475*m0JacIon[1]-1.224744871391589*m0JacIon[5]; 
  m0JacIonB[2] = 0.7071067811865475*m0JacIon[2]-1.224744871391589*m0JacIon[6]; 
  m0JacIonB[3] = 0.7071067811865475*m0JacIon[4]-1.224744871391589*m0JacIon[7]; 

  double phiS_qp[4];
  if ((isfinite(0.5*GammaJacIonB[3]-0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (0.5*GammaJacIonB[3]-0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (0.5*m0JacIonB[3]-0.5*m0JacIonB[2]-0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[0] = (log(GammaJacIonB[3]/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])-(1.0*GammaJacIonB[2])/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])-(1.0*GammaJacIonB[1])/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[0] = 0.0;
  }
  if ((isfinite(-(0.5*GammaJacIonB[3])+0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (-(0.5*GammaJacIonB[3])+0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (-(0.5*m0JacIonB[3])+0.5*m0JacIonB[2]-0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[1] = (log(-((1.0*GammaJacIonB[3])/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))+GammaJacIonB[2]/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])-(1.0*GammaJacIonB[1])/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[1] = 0.0;
  }
  if ((isfinite(-(0.5*GammaJacIonB[3])-0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (-(0.5*GammaJacIonB[3])-0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (-(0.5*m0JacIonB[3])-0.5*m0JacIonB[2]+0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[2] = (log(-((1.0*GammaJacIonB[3])/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))-(1.0*GammaJacIonB[2])/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[1]/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[2] = 0.0;
  }
  if ((isfinite(0.5*GammaJacIonB[3]+0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (0.5*GammaJacIonB[3]+0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (0.5*m0JacIonB[3]+0.5*m0JacIonB[2]+0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[3] = (log(GammaJacIonB[3]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[2]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[1]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[3] = 0.0;
  }

  // Sheath potential
  out[8] = 0.7071067811865475*(phiS_qp[3]+phiS_qp[2]+phiS_qp[1]+phiS_qp[0]); 
  out[9] = 0.7071067811865475*(phiS_qp[3]+phiS_qp[2]-1.0*(phiS_qp[1]+phiS_qp[0])); 
  out[10] = 0.7071067811865475*(phiS_qp[3]-1.0*phiS_qp[2]+phiS_qp[1]-1.0*phiS_qp[0]); 
  out[12] = 0.7071067811865475*(phiS_qp[3]-1.0*(phiS_qp[2]+phiS_qp[1])+phiS_qp[0]); 

}

GKYL_CU_DH void ambi_bolt_potential_sheath_calc_upper_3x_ser_p1(double sheathDirDx, double q_e, double m_e, double T_e, const double *cmag, const double *jacobtotInv, const double *GammaJac_i, const double *m0Ion, const double *m0JacIon, double *out) 
{ 
  // sheathDirDx: cell length in direction of the sheath.
  // q_e:         electron change.
  // m_e:         electron mass.
  // T_e:         electron temperature.
  // cmag:        Clebsch function in definition of magnetic field.
  // jacobtotInv: reciprocal of the phase-space and conf-space Jacobians (1/(J*B)).
  // GammaJac_i:  ion particle flux (times the Jacobian) through sheath entrance.
  // m0Ion:       ion density.
  // m0JacIon:    ion density (times the geometry Jacobian).
  // out:         ion density and electrostatic potential at the sheath entrance.

  // Particle number density evaluate at the sheath entrance
  out[0] = 1.7320508075688772*m0Ion[3]+m0Ion[0]; 
  out[1] = 1.7320508075688772*m0Ion[5]+m0Ion[1]; 
  out[2] = 1.7320508075688772*m0Ion[6]+m0Ion[2]; 
  out[4] = 1.7320508075688772*m0Ion[7]+m0Ion[4]; 

  double GammaJacIonB[4];
  GammaJacIonB[0] = 0.3535533905932737*GammaJac_i[0]*sheathDirDx-0.6123724356957944*GammaJac_i[3]*sheathDirDx; 
  GammaJacIonB[1] = 0.3535533905932737*GammaJac_i[1]*sheathDirDx-0.6123724356957944*GammaJac_i[5]*sheathDirDx; 
  GammaJacIonB[2] = 0.3535533905932737*GammaJac_i[2]*sheathDirDx-0.6123724356957944*GammaJac_i[6]*sheathDirDx; 
  GammaJacIonB[3] = 0.3535533905932737*GammaJac_i[4]*sheathDirDx-0.6123724356957944*GammaJac_i[7]*sheathDirDx; 

  double x3HalfMomJacElcB[4];
  x3HalfMomJacElcB[0] = 0.18322594196359493*cmag[3]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.18322594196359493*jacobtotInv[3]*cmag[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[5]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[5]*sqrt(T_e/m_e)+0.18322594196359493*m0JacIon[3]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*m0JacIon[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[1]*cmag[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[1]*jacobtotInv[5]*sqrt(T_e/m_e)+0.06107531398786498*m0JacIon[0]*cmag[1]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*m0JacIon[3]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[1]*jacobtotInv[3]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[1]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*m0JacIon[0]*jacobtotInv[1]*cmag[5]*sqrt(T_e/m_e)+0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[1]*jacobtotInv[1]*m0JacIon[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*cmag[3]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[1]*m0JacIon[1]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[0]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[1]*m0JacIon[1]*cmag[3]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[0]*cmag[3]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[1]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*cmag[1]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*m0JacIon[0]*cmag[1]*jacobtotInv[1]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[0]*sqrt(T_e/m_e); 
  x3HalfMomJacElcB[1] = 0.32980669553447084*cmag[5]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.19041398444736776*cmag[1]*jacobtotInv[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.19041398444736776*jacobtotInv[1]*cmag[5]*m0JacIon[5]*sqrt(T_e/m_e)+0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[5]*sqrt(T_e/m_e)+0.10993556517815695*cmag[1]*jacobtotInv[1]*m0JacIon[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[5]*sqrt(T_e/m_e)+0.19041398444736776*m0JacIon[1]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.18322594196359493*cmag[3]*m0JacIon[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*m0JacIon[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*cmag[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10993556517815695*cmag[1]*m0JacIon[1]*jacobtotInv[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[0]*jacobtotInv[5]*sqrt(T_e/m_e)+0.18322594196359493*jacobtotInv[3]*m0JacIon[3]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*m0JacIon[3]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[0]*jacobtotInv[3]*cmag[5]*sqrt(T_e/m_e)+0.10993556517815695*jacobtotInv[1]*m0JacIon[1]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[0]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[3]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[3]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[1]*cmag[3]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[1]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*m0JacIon[0]*cmag[1]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[1]*cmag[3]*sqrt(T_e/m_e)+0.06107531398786498*m0JacIon[0]*jacobtotInv[1]*cmag[3]*sqrt(T_e/m_e)+0.06347132814912258*cmag[1]*jacobtotInv[1]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[1]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*m0JacIon[0]*jacobtotInv[1]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*m0JacIon[0]*cmag[1]*sqrt(T_e/m_e); 
  x3HalfMomJacElcB[2] = 0.18322594196359493*cmag[3]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.18322594196359493*jacobtotInv[3]*cmag[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[7]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[7]*sqrt(T_e/m_e)+0.18322594196359493*cmag[5]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.06107531398786498*cmag[1]*jacobtotInv[1]*m0JacIon[6]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[3]*m0JacIon[4]*jacobtotInv[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[4]*jacobtotInv[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[1]*m0JacIon[2]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[3]*m0JacIon[4]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[4]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[1]*m0JacIon[2]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[1]*jacobtotInv[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[1]*cmag[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[1]*m0JacIon[4]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*cmag[1]*m0JacIon[4]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*cmag[3]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[2]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[2]*cmag[3]*sqrt(T_e/m_e)+0.03526184897173477*cmag[1]*jacobtotInv[1]*m0JacIon[2]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[2]*sqrt(T_e/m_e); 
  x3HalfMomJacElcB[3] = 0.32980669553447084*cmag[5]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.19041398444736776*cmag[1]*jacobtotInv[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.19041398444736776*jacobtotInv[1]*cmag[5]*m0JacIon[7]*sqrt(T_e/m_e)+0.18322594196359493*cmag[3]*jacobtotInv[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[3]*m0JacIon[7]*sqrt(T_e/m_e)+0.10993556517815695*cmag[1]*jacobtotInv[1]*m0JacIon[7]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[0]*m0JacIon[7]*sqrt(T_e/m_e)+0.18322594196359493*cmag[3]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[0]*jacobtotInv[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.18322594196359493*jacobtotInv[3]*cmag[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[0]*cmag[5]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*cmag[1]*jacobtotInv[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.10578554691520431*jacobtotInv[1]*cmag[3]*m0JacIon[6]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[1]*m0JacIon[6]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*cmag[1]*m0JacIon[6]*sqrt(T_e/m_e)+0.19041398444736776*m0JacIon[4]*cmag[5]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10993556517815695*cmag[1]*m0JacIon[4]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*cmag[3]*jacobtotInv[5]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*m0JacIon[2]*jacobtotInv[5]*sqrt(T_e/m_e)+0.10993556517815695*jacobtotInv[1]*m0JacIon[4]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*m0JacIon[2]*jacobtotInv[3]*cmag[5]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*m0JacIon[2]*cmag[5]*sqrt(T_e/m_e)+0.10578554691520431*cmag[3]*jacobtotInv[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.06107531398786498*cmag[0]*jacobtotInv[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[0]*cmag[3]*m0JacIon[4]*sqrt(T_e/m_e)+0.06347132814912258*cmag[1]*jacobtotInv[1]*m0JacIon[4]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[0]*m0JacIon[4]*sqrt(T_e/m_e)+0.06107531398786498*cmag[1]*m0JacIon[2]*jacobtotInv[3]*sqrt(T_e/m_e)+0.06107531398786498*jacobtotInv[1]*m0JacIon[2]*cmag[3]*sqrt(T_e/m_e)+0.03526184897173477*cmag[0]*jacobtotInv[1]*m0JacIon[2]*sqrt(T_e/m_e)+0.03526184897173477*jacobtotInv[0]*cmag[1]*m0JacIon[2]*sqrt(T_e/m_e); 

  double m0JacIonB[4];
  m0JacIonB[0] = 1.224744871391589*m0JacIon[3]+0.7071067811865475*m0JacIon[0]; 
  m0JacIonB[1] = 1.224744871391589*m0JacIon[5]+0.7071067811865475*m0JacIon[1]; 
  m0JacIonB[2] = 1.224744871391589*m0JacIon[6]+0.7071067811865475*m0JacIon[2]; 
  m0JacIonB[3] = 1.224744871391589*m0JacIon[7]+0.7071067811865475*m0JacIon[4]; 

  double phiS_qp[4];
  if ((isfinite(0.5*GammaJacIonB[3]-0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (0.5*GammaJacIonB[3]-0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (0.5*m0JacIonB[3]-0.5*m0JacIonB[2]-0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[0] = (log(GammaJacIonB[3]/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])-(1.0*GammaJacIonB[2])/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])-(1.0*GammaJacIonB[1])/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(x3HalfMomJacElcB[3]-1.0*x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[0] = 0.0;
  }
  if ((isfinite(-(0.5*GammaJacIonB[3])+0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (-(0.5*GammaJacIonB[3])+0.5*GammaJacIonB[2]-0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (-(0.5*m0JacIonB[3])+0.5*m0JacIonB[2]-0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[1] = (log(-((1.0*GammaJacIonB[3])/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))+GammaJacIonB[2]/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])-(1.0*GammaJacIonB[1])/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(-(1.0*x3HalfMomJacElcB[3])+x3HalfMomJacElcB[2]-1.0*x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[1] = 0.0;
  }
  if ((isfinite(-(0.5*GammaJacIonB[3])-0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (-(0.5*GammaJacIonB[3])-0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (-(0.5*m0JacIonB[3])-0.5*m0JacIonB[2]+0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[2] = (log(-((1.0*GammaJacIonB[3])/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))-(1.0*GammaJacIonB[2])/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[1]/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(-(1.0*x3HalfMomJacElcB[3])-1.0*x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[2] = 0.0;
  }
  if ((isfinite(0.5*GammaJacIonB[3]+0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0])) && (0.5*GammaJacIonB[3]+0.5*GammaJacIonB[2]+0.5*GammaJacIonB[1]+0.5*GammaJacIonB[0]>0.) && (0.5*m0JacIonB[3]+0.5*m0JacIonB[2]+0.5*m0JacIonB[1]+0.5*m0JacIonB[0]>0.)) {
    phiS_qp[3] = (log(GammaJacIonB[3]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[2]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[1]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0])+GammaJacIonB[0]/(x3HalfMomJacElcB[3]+x3HalfMomJacElcB[2]+x3HalfMomJacElcB[1]+x3HalfMomJacElcB[0]))*T_e)/q_e;
  } else {
    phiS_qp[3] = 0.0;
  }

  // Sheath potential
  out[8] = 0.7071067811865475*(phiS_qp[3]+phiS_qp[2]+phiS_qp[1]+phiS_qp[0]); 
  out[9] = 0.7071067811865475*(phiS_qp[3]+phiS_qp[2]-1.0*(phiS_qp[1]+phiS_qp[0])); 
  out[10] = 0.7071067811865475*(phiS_qp[3]-1.0*phiS_qp[2]+phiS_qp[1]-1.0*phiS_qp[0]); 
  out[12] = 0.7071067811865475*(phiS_qp[3]-1.0*(phiS_qp[2]+phiS_qp[1])+phiS_qp[0]); 

}

GKYL_CU_DH void ambi_bolt_potential_phi_calc_3x_ser_p1(double q_e, double T_e, const double *m0Ion, const double *sheathvals, double *phi) 
{ 
  // q_e: electron change.
  // T_e: electron temperature.
  // m0Ion: ion density.
  // sheathvals: ion density and electrostatic potential at the sheath entrance.
  // phi: electrostatic potential in domain volume.

  double phi_qp[8];
  phi_qp[0] = -((1.0*log(-((1.0*m0Ion[7])/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0]))+m0Ion[6]/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[5]/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[4]/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[3])/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[2])/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[1])/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[0]/(-(1.0*sheathvals[7])+sheathvals[6]+sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0]))*T_e)/q_e)-0.3535533905932737*sheathvals[15]+0.3535533905932737*sheathvals[14]+0.3535533905932737*sheathvals[13]+0.3535533905932737*sheathvals[12]-0.3535533905932737*sheathvals[11]-0.3535533905932737*sheathvals[10]-0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[1] = -((1.0*log(m0Ion[7]/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[6])/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[5])/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[4]/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[3]/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[2])/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[1])/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[0]/(sheathvals[7]-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]-1.0*sheathvals[1]+sheathvals[0]))*T_e)/q_e)+0.3535533905932737*sheathvals[15]-0.3535533905932737*sheathvals[14]-0.3535533905932737*sheathvals[13]+0.3535533905932737*sheathvals[12]+0.3535533905932737*sheathvals[11]-0.3535533905932737*sheathvals[10]-0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[2] = -((1.0*log(m0Ion[7]/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[6])/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[5]/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[4])/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[3])/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[2]/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[1])/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[0]/(sheathvals[7]-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0]))*T_e)/q_e)+0.3535533905932737*sheathvals[15]-0.3535533905932737*sheathvals[14]+0.3535533905932737*sheathvals[13]-0.3535533905932737*sheathvals[12]-0.3535533905932737*sheathvals[11]+0.3535533905932737*sheathvals[10]-0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[3] = -((1.0*log(-((1.0*m0Ion[7])/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0]))+m0Ion[6]/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[5])/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[4])/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[3]/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[2]/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])-(1.0*m0Ion[1])/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0])+m0Ion[0]/(-(1.0*sheathvals[7])+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]+sheathvals[2]-1.0*sheathvals[1]+sheathvals[0]))*T_e)/q_e)-0.3535533905932737*sheathvals[15]+0.3535533905932737*sheathvals[14]-0.3535533905932737*sheathvals[13]-0.3535533905932737*sheathvals[12]+0.3535533905932737*sheathvals[11]+0.3535533905932737*sheathvals[10]-0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[4] = -((1.0*log(m0Ion[7]/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[6]/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[5])/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[4])/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[3])/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[2])/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[1]/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[0]/(sheathvals[7]+sheathvals[6]-1.0*sheathvals[5]-1.0*sheathvals[4]-1.0*sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0]))*T_e)/q_e)+0.3535533905932737*sheathvals[15]+0.3535533905932737*sheathvals[14]-0.3535533905932737*sheathvals[13]-0.3535533905932737*sheathvals[12]-0.3535533905932737*sheathvals[11]-0.3535533905932737*sheathvals[10]+0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[5] = -((1.0*log(-((1.0*m0Ion[7])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0]))-(1.0*m0Ion[6])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[5]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[4])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[3]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[2])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[1]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[0]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]+sheathvals[5]-1.0*sheathvals[4]+sheathvals[3]-1.0*sheathvals[2]+sheathvals[1]+sheathvals[0]))*T_e)/q_e)-0.3535533905932737*sheathvals[15]-0.3535533905932737*sheathvals[14]+0.3535533905932737*sheathvals[13]-0.3535533905932737*sheathvals[12]+0.3535533905932737*sheathvals[11]-0.3535533905932737*sheathvals[10]+0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[6] = -((1.0*log(-((1.0*m0Ion[7])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0]))-(1.0*m0Ion[6])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[5])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[4]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])-(1.0*m0Ion[3])/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[2]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[1]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[0]/(-(1.0*sheathvals[7])-1.0*sheathvals[6]-1.0*sheathvals[5]+sheathvals[4]-1.0*sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0]))*T_e)/q_e)-0.3535533905932737*sheathvals[15]-0.3535533905932737*sheathvals[14]-0.3535533905932737*sheathvals[13]+0.3535533905932737*sheathvals[12]-0.3535533905932737*sheathvals[11]+0.3535533905932737*sheathvals[10]+0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 
  phi_qp[7] = -((1.0*log(m0Ion[7]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[6]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[5]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[4]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[3]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[2]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[1]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0])+m0Ion[0]/(sheathvals[7]+sheathvals[6]+sheathvals[5]+sheathvals[4]+sheathvals[3]+sheathvals[2]+sheathvals[1]+sheathvals[0]))*T_e)/q_e)+0.3535533905932737*sheathvals[15]+0.3535533905932737*sheathvals[14]+0.3535533905932737*sheathvals[13]+0.3535533905932737*sheathvals[12]+0.3535533905932737*sheathvals[11]+0.3535533905932737*sheathvals[10]+0.3535533905932737*sheathvals[9]+0.3535533905932737*sheathvals[8]; 

  phi[0] = 0.3535533905932737*(phi_qp[7]+phi_qp[6]+phi_qp[5]+phi_qp[4]+phi_qp[3]+phi_qp[2]+phi_qp[1]+phi_qp[0]); 
  phi[1] = 0.3535533905932737*(phi_qp[7]+phi_qp[6]+phi_qp[5]+phi_qp[4])-0.3535533905932737*(phi_qp[3]+phi_qp[2]+phi_qp[1]+phi_qp[0]); 
  phi[2] = 0.3535533905932737*(phi_qp[7]+phi_qp[6])-0.3535533905932737*(phi_qp[5]+phi_qp[4])+0.3535533905932737*(phi_qp[3]+phi_qp[2])-0.3535533905932737*(phi_qp[1]+phi_qp[0]); 
  phi[3] = 0.3535533905932737*phi_qp[7]-0.3535533905932737*phi_qp[6]+0.3535533905932737*phi_qp[5]-0.3535533905932737*phi_qp[4]+0.3535533905932737*phi_qp[3]-0.3535533905932737*phi_qp[2]+0.3535533905932737*phi_qp[1]-0.3535533905932737*phi_qp[0]; 
  phi[4] = 0.3535533905932737*(phi_qp[7]+phi_qp[6])-0.3535533905932737*(phi_qp[5]+phi_qp[4]+phi_qp[3]+phi_qp[2])+0.3535533905932737*(phi_qp[1]+phi_qp[0]); 
  phi[5] = 0.3535533905932737*phi_qp[7]-0.3535533905932737*phi_qp[6]+0.3535533905932737*phi_qp[5]-0.3535533905932737*(phi_qp[4]+phi_qp[3])+0.3535533905932737*phi_qp[2]-0.3535533905932737*phi_qp[1]+0.3535533905932737*phi_qp[0]; 
  phi[6] = 0.3535533905932737*phi_qp[7]-0.3535533905932737*(phi_qp[6]+phi_qp[5])+0.3535533905932737*(phi_qp[4]+phi_qp[3])-0.3535533905932737*(phi_qp[2]+phi_qp[1])+0.3535533905932737*phi_qp[0]; 
  phi[7] = 0.3535533905932737*phi_qp[7]-0.3535533905932737*(phi_qp[6]+phi_qp[5])+0.3535533905932737*phi_qp[4]-0.3535533905932737*phi_qp[3]+0.3535533905932737*(phi_qp[2]+phi_qp[1])-0.3535533905932737*phi_qp[0]; 
}

