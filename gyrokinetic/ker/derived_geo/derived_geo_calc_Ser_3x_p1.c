#include "gkyl_calc_derived_geo_kernels.h"

GKYL_CU_DH void derived_geo_3x_Ser_p1(const double *gij, const double *bmag, double *J, double *Jinv, double *grij, double *bi, double *cmag, double *Jtot, double *Jtotinv, double *gxxJ, double *gxyJ, double *gyyJ, double *gxzJ, double *eps2) 
{ 
const double *g11  = &gij[0 * 8];
const double *g12  = &gij[1 * 8];
const double *g13  = &gij[2 * 8];
const double *g22  = &gij[3 * 8];
const double *g23  = &gij[4 * 8];
const double *g33  = &gij[5 * 8];
double *gr11  = &grij[0 * 8];
double *gr12  = &grij[1 * 8];
double *gr13  = &grij[2 * 8];
double *gr22  = &grij[3 * 8];
double *gr23  = &grij[4 * 8];
double *gr33  = &grij[5 * 8];
double *b1  = &bi[0 * 8];
double *b2  = &bi[1 * 8];
double *b3  = &bi[2 * 8];
double b1_n[8]; 
double g11_n[8]; 
double gr11_n[8]; 
double g12_n[8]; 
double gr12_n[8]; 
double g13_n[8]; 
double gr13_n[8]; 
double b2_n[8]; 
double g22_n[8]; 
double gr22_n[8]; 
double g23_n[8]; 
double gr23_n[8]; 
double b3_n[8]; 
double g33_n[8]; 
double gr33_n[8]; 
double Jsq_n[8]; 
double J_n[8]; 
double Jinv_n[8]; 
double bmag_n[8]; 
double cmag_n[8]; 
double Jtot_n[8]; 
double Jtotinv_n[8]; 
double bmaginv_n[8]; 
double bmaginvsq_n[8]; 
double gxxJ_n[8]; 
double gxyJ_n[8]; 
double gyyJ_n[8]; 
double gxzJ_n[8]; 
double eps2_n[8]; 
double *g21_n = g12_n; 
double *g31_n = g13_n; 
double *g32_n = g23_n; 
// Calculate g_ij at nodes 
 g11_n[0] = (-1.837117307087383*g11[7])+1.060660171779821*g11[6]+1.060660171779821*g11[5]+1.060660171779821*g11[4]-0.6123724356957944*g11[3]-0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[1] = 1.837117307087383*g11[7]+1.060660171779821*g11[6]-1.060660171779821*g11[5]-1.060660171779821*g11[4]-0.6123724356957944*g11[3]-0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[2] = 1.837117307087383*g11[7]-1.060660171779821*g11[6]+1.060660171779821*g11[5]-1.060660171779821*g11[4]-0.6123724356957944*g11[3]+0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[3] = (-1.837117307087383*g11[7])-1.060660171779821*g11[6]-1.060660171779821*g11[5]+1.060660171779821*g11[4]-0.6123724356957944*g11[3]+0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[4] = 1.837117307087383*g11[7]-1.060660171779821*g11[6]-1.060660171779821*g11[5]+1.060660171779821*g11[4]+0.6123724356957944*g11[3]-0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[5] = (-1.837117307087383*g11[7])-1.060660171779821*g11[6]+1.060660171779821*g11[5]-1.060660171779821*g11[4]+0.6123724356957944*g11[3]-0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[6] = (-1.837117307087383*g11[7])+1.060660171779821*g11[6]-1.060660171779821*g11[5]-1.060660171779821*g11[4]+0.6123724356957944*g11[3]+0.6123724356957944*g11[2]-0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[7] = 1.837117307087383*g11[7]+1.060660171779821*g11[6]+1.060660171779821*g11[5]+1.060660171779821*g11[4]+0.6123724356957944*g11[3]+0.6123724356957944*g11[2]+0.6123724356957944*g11[1]+0.3535533905932737*g11[0]; 
 g12_n[0] = (-1.837117307087383*g12[7])+1.060660171779821*g12[6]+1.060660171779821*g12[5]+1.060660171779821*g12[4]-0.6123724356957944*g12[3]-0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[1] = 1.837117307087383*g12[7]+1.060660171779821*g12[6]-1.060660171779821*g12[5]-1.060660171779821*g12[4]-0.6123724356957944*g12[3]-0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[2] = 1.837117307087383*g12[7]-1.060660171779821*g12[6]+1.060660171779821*g12[5]-1.060660171779821*g12[4]-0.6123724356957944*g12[3]+0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[3] = (-1.837117307087383*g12[7])-1.060660171779821*g12[6]-1.060660171779821*g12[5]+1.060660171779821*g12[4]-0.6123724356957944*g12[3]+0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[4] = 1.837117307087383*g12[7]-1.060660171779821*g12[6]-1.060660171779821*g12[5]+1.060660171779821*g12[4]+0.6123724356957944*g12[3]-0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[5] = (-1.837117307087383*g12[7])-1.060660171779821*g12[6]+1.060660171779821*g12[5]-1.060660171779821*g12[4]+0.6123724356957944*g12[3]-0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[6] = (-1.837117307087383*g12[7])+1.060660171779821*g12[6]-1.060660171779821*g12[5]-1.060660171779821*g12[4]+0.6123724356957944*g12[3]+0.6123724356957944*g12[2]-0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[7] = 1.837117307087383*g12[7]+1.060660171779821*g12[6]+1.060660171779821*g12[5]+1.060660171779821*g12[4]+0.6123724356957944*g12[3]+0.6123724356957944*g12[2]+0.6123724356957944*g12[1]+0.3535533905932737*g12[0]; 
 g13_n[0] = (-1.837117307087383*g13[7])+1.060660171779821*g13[6]+1.060660171779821*g13[5]+1.060660171779821*g13[4]-0.6123724356957944*g13[3]-0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[1] = 1.837117307087383*g13[7]+1.060660171779821*g13[6]-1.060660171779821*g13[5]-1.060660171779821*g13[4]-0.6123724356957944*g13[3]-0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[2] = 1.837117307087383*g13[7]-1.060660171779821*g13[6]+1.060660171779821*g13[5]-1.060660171779821*g13[4]-0.6123724356957944*g13[3]+0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[3] = (-1.837117307087383*g13[7])-1.060660171779821*g13[6]-1.060660171779821*g13[5]+1.060660171779821*g13[4]-0.6123724356957944*g13[3]+0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[4] = 1.837117307087383*g13[7]-1.060660171779821*g13[6]-1.060660171779821*g13[5]+1.060660171779821*g13[4]+0.6123724356957944*g13[3]-0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[5] = (-1.837117307087383*g13[7])-1.060660171779821*g13[6]+1.060660171779821*g13[5]-1.060660171779821*g13[4]+0.6123724356957944*g13[3]-0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[6] = (-1.837117307087383*g13[7])+1.060660171779821*g13[6]-1.060660171779821*g13[5]-1.060660171779821*g13[4]+0.6123724356957944*g13[3]+0.6123724356957944*g13[2]-0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[7] = 1.837117307087383*g13[7]+1.060660171779821*g13[6]+1.060660171779821*g13[5]+1.060660171779821*g13[4]+0.6123724356957944*g13[3]+0.6123724356957944*g13[2]+0.6123724356957944*g13[1]+0.3535533905932737*g13[0]; 
 g22_n[0] = (-1.837117307087383*g22[7])+1.060660171779821*g22[6]+1.060660171779821*g22[5]+1.060660171779821*g22[4]-0.6123724356957944*g22[3]-0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[1] = 1.837117307087383*g22[7]+1.060660171779821*g22[6]-1.060660171779821*g22[5]-1.060660171779821*g22[4]-0.6123724356957944*g22[3]-0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[2] = 1.837117307087383*g22[7]-1.060660171779821*g22[6]+1.060660171779821*g22[5]-1.060660171779821*g22[4]-0.6123724356957944*g22[3]+0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[3] = (-1.837117307087383*g22[7])-1.060660171779821*g22[6]-1.060660171779821*g22[5]+1.060660171779821*g22[4]-0.6123724356957944*g22[3]+0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[4] = 1.837117307087383*g22[7]-1.060660171779821*g22[6]-1.060660171779821*g22[5]+1.060660171779821*g22[4]+0.6123724356957944*g22[3]-0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[5] = (-1.837117307087383*g22[7])-1.060660171779821*g22[6]+1.060660171779821*g22[5]-1.060660171779821*g22[4]+0.6123724356957944*g22[3]-0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[6] = (-1.837117307087383*g22[7])+1.060660171779821*g22[6]-1.060660171779821*g22[5]-1.060660171779821*g22[4]+0.6123724356957944*g22[3]+0.6123724356957944*g22[2]-0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[7] = 1.837117307087383*g22[7]+1.060660171779821*g22[6]+1.060660171779821*g22[5]+1.060660171779821*g22[4]+0.6123724356957944*g22[3]+0.6123724356957944*g22[2]+0.6123724356957944*g22[1]+0.3535533905932737*g22[0]; 
 g23_n[0] = (-1.837117307087383*g23[7])+1.060660171779821*g23[6]+1.060660171779821*g23[5]+1.060660171779821*g23[4]-0.6123724356957944*g23[3]-0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[1] = 1.837117307087383*g23[7]+1.060660171779821*g23[6]-1.060660171779821*g23[5]-1.060660171779821*g23[4]-0.6123724356957944*g23[3]-0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[2] = 1.837117307087383*g23[7]-1.060660171779821*g23[6]+1.060660171779821*g23[5]-1.060660171779821*g23[4]-0.6123724356957944*g23[3]+0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[3] = (-1.837117307087383*g23[7])-1.060660171779821*g23[6]-1.060660171779821*g23[5]+1.060660171779821*g23[4]-0.6123724356957944*g23[3]+0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[4] = 1.837117307087383*g23[7]-1.060660171779821*g23[6]-1.060660171779821*g23[5]+1.060660171779821*g23[4]+0.6123724356957944*g23[3]-0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[5] = (-1.837117307087383*g23[7])-1.060660171779821*g23[6]+1.060660171779821*g23[5]-1.060660171779821*g23[4]+0.6123724356957944*g23[3]-0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[6] = (-1.837117307087383*g23[7])+1.060660171779821*g23[6]-1.060660171779821*g23[5]-1.060660171779821*g23[4]+0.6123724356957944*g23[3]+0.6123724356957944*g23[2]-0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[7] = 1.837117307087383*g23[7]+1.060660171779821*g23[6]+1.060660171779821*g23[5]+1.060660171779821*g23[4]+0.6123724356957944*g23[3]+0.6123724356957944*g23[2]+0.6123724356957944*g23[1]+0.3535533905932737*g23[0]; 
 g33_n[0] = (-1.837117307087383*g33[7])+1.060660171779821*g33[6]+1.060660171779821*g33[5]+1.060660171779821*g33[4]-0.6123724356957944*g33[3]-0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[1] = 1.837117307087383*g33[7]+1.060660171779821*g33[6]-1.060660171779821*g33[5]-1.060660171779821*g33[4]-0.6123724356957944*g33[3]-0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[2] = 1.837117307087383*g33[7]-1.060660171779821*g33[6]+1.060660171779821*g33[5]-1.060660171779821*g33[4]-0.6123724356957944*g33[3]+0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[3] = (-1.837117307087383*g33[7])-1.060660171779821*g33[6]-1.060660171779821*g33[5]+1.060660171779821*g33[4]-0.6123724356957944*g33[3]+0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[4] = 1.837117307087383*g33[7]-1.060660171779821*g33[6]-1.060660171779821*g33[5]+1.060660171779821*g33[4]+0.6123724356957944*g33[3]-0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[5] = (-1.837117307087383*g33[7])-1.060660171779821*g33[6]+1.060660171779821*g33[5]-1.060660171779821*g33[4]+0.6123724356957944*g33[3]-0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[6] = (-1.837117307087383*g33[7])+1.060660171779821*g33[6]-1.060660171779821*g33[5]-1.060660171779821*g33[4]+0.6123724356957944*g33[3]+0.6123724356957944*g33[2]-0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[7] = 1.837117307087383*g33[7]+1.060660171779821*g33[6]+1.060660171779821*g33[5]+1.060660171779821*g33[4]+0.6123724356957944*g33[3]+0.6123724356957944*g33[2]+0.6123724356957944*g33[1]+0.3535533905932737*g33[0]; 
// Calculate bmag at nodes 
 bmag_n[0] = (-1.837117307087383*bmag[7])+1.060660171779821*bmag[6]+1.060660171779821*bmag[5]+1.060660171779821*bmag[4]-0.6123724356957944*bmag[3]-0.6123724356957944*bmag[2]-0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[1] = 1.837117307087383*bmag[7]+1.060660171779821*bmag[6]-1.060660171779821*bmag[5]-1.060660171779821*bmag[4]-0.6123724356957944*bmag[3]-0.6123724356957944*bmag[2]+0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[2] = 1.837117307087383*bmag[7]-1.060660171779821*bmag[6]+1.060660171779821*bmag[5]-1.060660171779821*bmag[4]-0.6123724356957944*bmag[3]+0.6123724356957944*bmag[2]-0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[3] = (-1.837117307087383*bmag[7])-1.060660171779821*bmag[6]-1.060660171779821*bmag[5]+1.060660171779821*bmag[4]-0.6123724356957944*bmag[3]+0.6123724356957944*bmag[2]+0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[4] = 1.837117307087383*bmag[7]-1.060660171779821*bmag[6]-1.060660171779821*bmag[5]+1.060660171779821*bmag[4]+0.6123724356957944*bmag[3]-0.6123724356957944*bmag[2]-0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[5] = (-1.837117307087383*bmag[7])-1.060660171779821*bmag[6]+1.060660171779821*bmag[5]-1.060660171779821*bmag[4]+0.6123724356957944*bmag[3]-0.6123724356957944*bmag[2]+0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[6] = (-1.837117307087383*bmag[7])+1.060660171779821*bmag[6]-1.060660171779821*bmag[5]-1.060660171779821*bmag[4]+0.6123724356957944*bmag[3]+0.6123724356957944*bmag[2]-0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[7] = 1.837117307087383*bmag[7]+1.060660171779821*bmag[6]+1.060660171779821*bmag[5]+1.060660171779821*bmag[4]+0.6123724356957944*bmag[3]+0.6123724356957944*bmag[2]+0.6123724356957944*bmag[1]+0.3535533905932737*bmag[0]; 
// Calculate Jsq at nodes 
  Jsq_n[0] = g11_n[0]*(g22_n[0]*g33_n[0]-1.0*g23_n[0]*g32_n[0])-1.0*g12_n[0]*(g21_n[0]*g33_n[0]-1.0*g23_n[0]*g31_n[0])+g13_n[0]*(g21_n[0]*g32_n[0]-1.0*g22_n[0]*g31_n[0]); 
  Jsq_n[1] = g11_n[1]*(g22_n[1]*g33_n[1]-1.0*g23_n[1]*g32_n[1])-1.0*g12_n[1]*(g21_n[1]*g33_n[1]-1.0*g23_n[1]*g31_n[1])+g13_n[1]*(g21_n[1]*g32_n[1]-1.0*g22_n[1]*g31_n[1]); 
  Jsq_n[2] = g11_n[2]*(g22_n[2]*g33_n[2]-1.0*g23_n[2]*g32_n[2])-1.0*g12_n[2]*(g21_n[2]*g33_n[2]-1.0*g23_n[2]*g31_n[2])+g13_n[2]*(g21_n[2]*g32_n[2]-1.0*g22_n[2]*g31_n[2]); 
  Jsq_n[3] = g11_n[3]*(g22_n[3]*g33_n[3]-1.0*g23_n[3]*g32_n[3])-1.0*g12_n[3]*(g21_n[3]*g33_n[3]-1.0*g23_n[3]*g31_n[3])+g13_n[3]*(g21_n[3]*g32_n[3]-1.0*g22_n[3]*g31_n[3]); 
  Jsq_n[4] = g11_n[4]*(g22_n[4]*g33_n[4]-1.0*g23_n[4]*g32_n[4])-1.0*g12_n[4]*(g21_n[4]*g33_n[4]-1.0*g23_n[4]*g31_n[4])+g13_n[4]*(g21_n[4]*g32_n[4]-1.0*g22_n[4]*g31_n[4]); 
  Jsq_n[5] = g11_n[5]*(g22_n[5]*g33_n[5]-1.0*g23_n[5]*g32_n[5])-1.0*g12_n[5]*(g21_n[5]*g33_n[5]-1.0*g23_n[5]*g31_n[5])+g13_n[5]*(g21_n[5]*g32_n[5]-1.0*g22_n[5]*g31_n[5]); 
  Jsq_n[6] = g11_n[6]*(g22_n[6]*g33_n[6]-1.0*g23_n[6]*g32_n[6])-1.0*g12_n[6]*(g21_n[6]*g33_n[6]-1.0*g23_n[6]*g31_n[6])+g13_n[6]*(g21_n[6]*g32_n[6]-1.0*g22_n[6]*g31_n[6]); 
  Jsq_n[7] = g11_n[7]*(g22_n[7]*g33_n[7]-1.0*g23_n[7]*g32_n[7])-1.0*g12_n[7]*(g21_n[7]*g33_n[7]-1.0*g23_n[7]*g31_n[7])+g13_n[7]*(g21_n[7]*g32_n[7]-1.0*g22_n[7]*g31_n[7]); 
// Jsq at nodes cannot be less than 0 
for (int k=0; k<8; k++){ Jsq_n[k] =fmax(Jsq_n[k],0); } 
// Take the square root to get J at nodes 
J_n[0] = sqrt(Jsq_n[0]); 
J_n[1] = sqrt(Jsq_n[1]); 
J_n[2] = sqrt(Jsq_n[2]); 
J_n[3] = sqrt(Jsq_n[3]); 
J_n[4] = sqrt(Jsq_n[4]); 
J_n[5] = sqrt(Jsq_n[5]); 
J_n[6] = sqrt(Jsq_n[6]); 
J_n[7] = sqrt(Jsq_n[7]); 
// Convert nodal to modal for J 
  J[0] = 0.3535533905932741*J_n[7]+0.353553390593274*J_n[6]+0.353553390593274*J_n[5]+0.3535533905932739*J_n[4]+0.3535533905932738*J_n[3]+0.3535533905932738*J_n[2]+0.3535533905932738*J_n[1]+0.3535533905932738*J_n[0]; 
  J[1] = 0.2041241452319316*J_n[7]-0.2041241452319316*J_n[6]+0.2041241452319317*J_n[5]-0.2041241452319317*J_n[4]+0.2041241452319315*J_n[3]-0.2041241452319315*J_n[2]+0.2041241452319315*J_n[1]-0.2041241452319315*J_n[0]; 
  J[2] = 0.2041241452319317*J_n[7]+0.2041241452319316*J_n[6]-0.2041241452319317*J_n[5]-0.2041241452319316*J_n[4]+0.2041241452319315*J_n[3]+0.2041241452319315*J_n[2]-0.2041241452319315*J_n[1]-0.2041241452319315*J_n[0]; 
  J[3] = 0.2041241452319316*J_n[7]+0.2041241452319316*J_n[6]+0.2041241452319316*J_n[5]+0.2041241452319316*J_n[4]-0.2041241452319315*J_n[3]-0.2041241452319315*J_n[2]-0.2041241452319315*J_n[1]-0.2041241452319315*J_n[0]; 
  J[4] = 0.117851130197758*J_n[7]-0.117851130197758*J_n[6]-0.117851130197758*J_n[5]+0.117851130197758*J_n[4]+0.1178511301977579*J_n[3]-0.1178511301977579*J_n[2]-0.1178511301977579*J_n[1]+0.1178511301977579*J_n[0]; 
  J[5] = 0.117851130197758*J_n[7]-0.117851130197758*J_n[6]+0.117851130197758*J_n[5]-0.117851130197758*J_n[4]-0.1178511301977579*J_n[3]+0.1178511301977579*J_n[2]-0.1178511301977579*J_n[1]+0.1178511301977579*J_n[0]; 
  J[6] = 0.1178511301977579*J_n[7]+0.117851130197758*J_n[6]-0.117851130197758*J_n[5]-0.117851130197758*J_n[4]-0.1178511301977579*J_n[3]-0.1178511301977579*J_n[2]+0.1178511301977579*J_n[1]+0.1178511301977579*J_n[0]; 
  J[7] = 0.0680413817439772*J_n[7]-0.06804138174397721*J_n[6]-0.06804138174397721*J_n[5]+0.06804138174397721*J_n[4]-0.06804138174397717*J_n[3]+0.06804138174397717*J_n[2]+0.06804138174397717*J_n[1]-0.06804138174397717*J_n[0]; 
// Calculate Jinv at nodes 
Jinv_n[0] = 1.0/J_n[0]; 
Jinv_n[1] = 1.0/J_n[1]; 
Jinv_n[2] = 1.0/J_n[2]; 
Jinv_n[3] = 1.0/J_n[3]; 
Jinv_n[4] = 1.0/J_n[4]; 
Jinv_n[5] = 1.0/J_n[5]; 
Jinv_n[6] = 1.0/J_n[6]; 
Jinv_n[7] = 1.0/J_n[7]; 
// Convert nodal to modal for Jinv 
  Jinv[0] = 0.3535533905932741*Jinv_n[7]+0.353553390593274*Jinv_n[6]+0.353553390593274*Jinv_n[5]+0.3535533905932739*Jinv_n[4]+0.3535533905932738*Jinv_n[3]+0.3535533905932738*Jinv_n[2]+0.3535533905932738*Jinv_n[1]+0.3535533905932738*Jinv_n[0]; 
  Jinv[1] = 0.2041241452319316*Jinv_n[7]-0.2041241452319316*Jinv_n[6]+0.2041241452319317*Jinv_n[5]-0.2041241452319317*Jinv_n[4]+0.2041241452319315*Jinv_n[3]-0.2041241452319315*Jinv_n[2]+0.2041241452319315*Jinv_n[1]-0.2041241452319315*Jinv_n[0]; 
  Jinv[2] = 0.2041241452319317*Jinv_n[7]+0.2041241452319316*Jinv_n[6]-0.2041241452319317*Jinv_n[5]-0.2041241452319316*Jinv_n[4]+0.2041241452319315*Jinv_n[3]+0.2041241452319315*Jinv_n[2]-0.2041241452319315*Jinv_n[1]-0.2041241452319315*Jinv_n[0]; 
  Jinv[3] = 0.2041241452319316*Jinv_n[7]+0.2041241452319316*Jinv_n[6]+0.2041241452319316*Jinv_n[5]+0.2041241452319316*Jinv_n[4]-0.2041241452319315*Jinv_n[3]-0.2041241452319315*Jinv_n[2]-0.2041241452319315*Jinv_n[1]-0.2041241452319315*Jinv_n[0]; 
  Jinv[4] = 0.117851130197758*Jinv_n[7]-0.117851130197758*Jinv_n[6]-0.117851130197758*Jinv_n[5]+0.117851130197758*Jinv_n[4]+0.1178511301977579*Jinv_n[3]-0.1178511301977579*Jinv_n[2]-0.1178511301977579*Jinv_n[1]+0.1178511301977579*Jinv_n[0]; 
  Jinv[5] = 0.117851130197758*Jinv_n[7]-0.117851130197758*Jinv_n[6]+0.117851130197758*Jinv_n[5]-0.117851130197758*Jinv_n[4]-0.1178511301977579*Jinv_n[3]+0.1178511301977579*Jinv_n[2]-0.1178511301977579*Jinv_n[1]+0.1178511301977579*Jinv_n[0]; 
  Jinv[6] = 0.1178511301977579*Jinv_n[7]+0.117851130197758*Jinv_n[6]-0.117851130197758*Jinv_n[5]-0.117851130197758*Jinv_n[4]-0.1178511301977579*Jinv_n[3]-0.1178511301977579*Jinv_n[2]+0.1178511301977579*Jinv_n[1]+0.1178511301977579*Jinv_n[0]; 
  Jinv[7] = 0.0680413817439772*Jinv_n[7]-0.06804138174397721*Jinv_n[6]-0.06804138174397721*Jinv_n[5]+0.06804138174397721*Jinv_n[4]-0.06804138174397717*Jinv_n[3]+0.06804138174397717*Jinv_n[2]+0.06804138174397717*Jinv_n[1]-0.06804138174397717*Jinv_n[0]; 
// Calculate Jtot at nodes 
Jtot_n[0] = bmag_n[0]*J_n[0]; 
Jtot_n[1] = bmag_n[1]*J_n[1]; 
Jtot_n[2] = bmag_n[2]*J_n[2]; 
Jtot_n[3] = bmag_n[3]*J_n[3]; 
Jtot_n[4] = bmag_n[4]*J_n[4]; 
Jtot_n[5] = bmag_n[5]*J_n[5]; 
Jtot_n[6] = bmag_n[6]*J_n[6]; 
Jtot_n[7] = bmag_n[7]*J_n[7]; 
// Convert nodal to modal for Jtot 
  Jtot[0] = 0.3535533905932741*Jtot_n[7]+0.353553390593274*Jtot_n[6]+0.353553390593274*Jtot_n[5]+0.3535533905932739*Jtot_n[4]+0.3535533905932738*Jtot_n[3]+0.3535533905932738*Jtot_n[2]+0.3535533905932738*Jtot_n[1]+0.3535533905932738*Jtot_n[0]; 
  Jtot[1] = 0.2041241452319316*Jtot_n[7]-0.2041241452319316*Jtot_n[6]+0.2041241452319317*Jtot_n[5]-0.2041241452319317*Jtot_n[4]+0.2041241452319315*Jtot_n[3]-0.2041241452319315*Jtot_n[2]+0.2041241452319315*Jtot_n[1]-0.2041241452319315*Jtot_n[0]; 
  Jtot[2] = 0.2041241452319317*Jtot_n[7]+0.2041241452319316*Jtot_n[6]-0.2041241452319317*Jtot_n[5]-0.2041241452319316*Jtot_n[4]+0.2041241452319315*Jtot_n[3]+0.2041241452319315*Jtot_n[2]-0.2041241452319315*Jtot_n[1]-0.2041241452319315*Jtot_n[0]; 
  Jtot[3] = 0.2041241452319316*Jtot_n[7]+0.2041241452319316*Jtot_n[6]+0.2041241452319316*Jtot_n[5]+0.2041241452319316*Jtot_n[4]-0.2041241452319315*Jtot_n[3]-0.2041241452319315*Jtot_n[2]-0.2041241452319315*Jtot_n[1]-0.2041241452319315*Jtot_n[0]; 
  Jtot[4] = 0.117851130197758*Jtot_n[7]-0.117851130197758*Jtot_n[6]-0.117851130197758*Jtot_n[5]+0.117851130197758*Jtot_n[4]+0.1178511301977579*Jtot_n[3]-0.1178511301977579*Jtot_n[2]-0.1178511301977579*Jtot_n[1]+0.1178511301977579*Jtot_n[0]; 
  Jtot[5] = 0.117851130197758*Jtot_n[7]-0.117851130197758*Jtot_n[6]+0.117851130197758*Jtot_n[5]-0.117851130197758*Jtot_n[4]-0.1178511301977579*Jtot_n[3]+0.1178511301977579*Jtot_n[2]-0.1178511301977579*Jtot_n[1]+0.1178511301977579*Jtot_n[0]; 
  Jtot[6] = 0.1178511301977579*Jtot_n[7]+0.117851130197758*Jtot_n[6]-0.117851130197758*Jtot_n[5]-0.117851130197758*Jtot_n[4]-0.1178511301977579*Jtot_n[3]-0.1178511301977579*Jtot_n[2]+0.1178511301977579*Jtot_n[1]+0.1178511301977579*Jtot_n[0]; 
  Jtot[7] = 0.0680413817439772*Jtot_n[7]-0.06804138174397721*Jtot_n[6]-0.06804138174397721*Jtot_n[5]+0.06804138174397721*Jtot_n[4]-0.06804138174397717*Jtot_n[3]+0.06804138174397717*Jtot_n[2]+0.06804138174397717*Jtot_n[1]-0.06804138174397717*Jtot_n[0]; 
// Calculate Jtotinv at nodes 
Jtotinv_n[0] = 1/Jtot_n[0]; 
Jtotinv_n[1] = 1/Jtot_n[1]; 
Jtotinv_n[2] = 1/Jtot_n[2]; 
Jtotinv_n[3] = 1/Jtot_n[3]; 
Jtotinv_n[4] = 1/Jtot_n[4]; 
Jtotinv_n[5] = 1/Jtot_n[5]; 
Jtotinv_n[6] = 1/Jtot_n[6]; 
Jtotinv_n[7] = 1/Jtot_n[7]; 
// Convert nodal to modal for Jtotinv 
  Jtotinv[0] = 0.3535533905932741*Jtotinv_n[7]+0.353553390593274*Jtotinv_n[6]+0.353553390593274*Jtotinv_n[5]+0.3535533905932739*Jtotinv_n[4]+0.3535533905932738*Jtotinv_n[3]+0.3535533905932738*Jtotinv_n[2]+0.3535533905932738*Jtotinv_n[1]+0.3535533905932738*Jtotinv_n[0]; 
  Jtotinv[1] = 0.2041241452319316*Jtotinv_n[7]-0.2041241452319316*Jtotinv_n[6]+0.2041241452319317*Jtotinv_n[5]-0.2041241452319317*Jtotinv_n[4]+0.2041241452319315*Jtotinv_n[3]-0.2041241452319315*Jtotinv_n[2]+0.2041241452319315*Jtotinv_n[1]-0.2041241452319315*Jtotinv_n[0]; 
  Jtotinv[2] = 0.2041241452319317*Jtotinv_n[7]+0.2041241452319316*Jtotinv_n[6]-0.2041241452319317*Jtotinv_n[5]-0.2041241452319316*Jtotinv_n[4]+0.2041241452319315*Jtotinv_n[3]+0.2041241452319315*Jtotinv_n[2]-0.2041241452319315*Jtotinv_n[1]-0.2041241452319315*Jtotinv_n[0]; 
  Jtotinv[3] = 0.2041241452319316*Jtotinv_n[7]+0.2041241452319316*Jtotinv_n[6]+0.2041241452319316*Jtotinv_n[5]+0.2041241452319316*Jtotinv_n[4]-0.2041241452319315*Jtotinv_n[3]-0.2041241452319315*Jtotinv_n[2]-0.2041241452319315*Jtotinv_n[1]-0.2041241452319315*Jtotinv_n[0]; 
  Jtotinv[4] = 0.117851130197758*Jtotinv_n[7]-0.117851130197758*Jtotinv_n[6]-0.117851130197758*Jtotinv_n[5]+0.117851130197758*Jtotinv_n[4]+0.1178511301977579*Jtotinv_n[3]-0.1178511301977579*Jtotinv_n[2]-0.1178511301977579*Jtotinv_n[1]+0.1178511301977579*Jtotinv_n[0]; 
  Jtotinv[5] = 0.117851130197758*Jtotinv_n[7]-0.117851130197758*Jtotinv_n[6]+0.117851130197758*Jtotinv_n[5]-0.117851130197758*Jtotinv_n[4]-0.1178511301977579*Jtotinv_n[3]+0.1178511301977579*Jtotinv_n[2]-0.1178511301977579*Jtotinv_n[1]+0.1178511301977579*Jtotinv_n[0]; 
  Jtotinv[6] = 0.1178511301977579*Jtotinv_n[7]+0.117851130197758*Jtotinv_n[6]-0.117851130197758*Jtotinv_n[5]-0.117851130197758*Jtotinv_n[4]-0.1178511301977579*Jtotinv_n[3]-0.1178511301977579*Jtotinv_n[2]+0.1178511301977579*Jtotinv_n[1]+0.1178511301977579*Jtotinv_n[0]; 
  Jtotinv[7] = 0.0680413817439772*Jtotinv_n[7]-0.06804138174397721*Jtotinv_n[6]-0.06804138174397721*Jtotinv_n[5]+0.06804138174397721*Jtotinv_n[4]-0.06804138174397717*Jtotinv_n[3]+0.06804138174397717*Jtotinv_n[2]+0.06804138174397717*Jtotinv_n[1]-0.06804138174397717*Jtotinv_n[0]; 
// Calculate bmaginv at nodes 
bmaginv_n[0] = 1.0/bmag_n[0]; 
bmaginv_n[1] = 1.0/bmag_n[1]; 
bmaginv_n[2] = 1.0/bmag_n[2]; 
bmaginv_n[3] = 1.0/bmag_n[3]; 
bmaginv_n[4] = 1.0/bmag_n[4]; 
bmaginv_n[5] = 1.0/bmag_n[5]; 
bmaginv_n[6] = 1.0/bmag_n[6]; 
bmaginv_n[7] = 1.0/bmag_n[7]; 
// Calculate bmaginvsq at nodes 
bmaginvsq_n[0] = bmaginv_n[0]*bmaginv_n[0]; 
bmaginvsq_n[1] = bmaginv_n[1]*bmaginv_n[1]; 
bmaginvsq_n[2] = bmaginv_n[2]*bmaginv_n[2]; 
bmaginvsq_n[3] = bmaginv_n[3]*bmaginv_n[3]; 
bmaginvsq_n[4] = bmaginv_n[4]*bmaginv_n[4]; 
bmaginvsq_n[5] = bmaginv_n[5]*bmaginv_n[5]; 
bmaginvsq_n[6] = bmaginv_n[6]*bmaginv_n[6]; 
bmaginvsq_n[7] = bmaginv_n[7]*bmaginv_n[7]; 
// Calculate g^ij at nodes without factor of 1/det
  gr11_n[0] = g22_n[0]*g33_n[0]-1.0*g23_n[0]*g32_n[0]; 
  gr11_n[1] = g22_n[1]*g33_n[1]-1.0*g23_n[1]*g32_n[1]; 
  gr11_n[2] = g22_n[2]*g33_n[2]-1.0*g23_n[2]*g32_n[2]; 
  gr11_n[3] = g22_n[3]*g33_n[3]-1.0*g23_n[3]*g32_n[3]; 
  gr11_n[4] = g22_n[4]*g33_n[4]-1.0*g23_n[4]*g32_n[4]; 
  gr11_n[5] = g22_n[5]*g33_n[5]-1.0*g23_n[5]*g32_n[5]; 
  gr11_n[6] = g22_n[6]*g33_n[6]-1.0*g23_n[6]*g32_n[6]; 
  gr11_n[7] = g22_n[7]*g33_n[7]-1.0*g23_n[7]*g32_n[7]; 
  gr12_n[0] = g13_n[0]*g32_n[0]-1.0*g12_n[0]*g33_n[0]; 
  gr12_n[1] = g13_n[1]*g32_n[1]-1.0*g12_n[1]*g33_n[1]; 
  gr12_n[2] = g13_n[2]*g32_n[2]-1.0*g12_n[2]*g33_n[2]; 
  gr12_n[3] = g13_n[3]*g32_n[3]-1.0*g12_n[3]*g33_n[3]; 
  gr12_n[4] = g13_n[4]*g32_n[4]-1.0*g12_n[4]*g33_n[4]; 
  gr12_n[5] = g13_n[5]*g32_n[5]-1.0*g12_n[5]*g33_n[5]; 
  gr12_n[6] = g13_n[6]*g32_n[6]-1.0*g12_n[6]*g33_n[6]; 
  gr12_n[7] = g13_n[7]*g32_n[7]-1.0*g12_n[7]*g33_n[7]; 
  gr13_n[0] = g12_n[0]*g23_n[0]-1.0*g13_n[0]*g22_n[0]; 
  gr13_n[1] = g12_n[1]*g23_n[1]-1.0*g13_n[1]*g22_n[1]; 
  gr13_n[2] = g12_n[2]*g23_n[2]-1.0*g13_n[2]*g22_n[2]; 
  gr13_n[3] = g12_n[3]*g23_n[3]-1.0*g13_n[3]*g22_n[3]; 
  gr13_n[4] = g12_n[4]*g23_n[4]-1.0*g13_n[4]*g22_n[4]; 
  gr13_n[5] = g12_n[5]*g23_n[5]-1.0*g13_n[5]*g22_n[5]; 
  gr13_n[6] = g12_n[6]*g23_n[6]-1.0*g13_n[6]*g22_n[6]; 
  gr13_n[7] = g12_n[7]*g23_n[7]-1.0*g13_n[7]*g22_n[7]; 
  gr22_n[0] = g11_n[0]*g33_n[0]-1.0*g13_n[0]*g31_n[0]; 
  gr22_n[1] = g11_n[1]*g33_n[1]-1.0*g13_n[1]*g31_n[1]; 
  gr22_n[2] = g11_n[2]*g33_n[2]-1.0*g13_n[2]*g31_n[2]; 
  gr22_n[3] = g11_n[3]*g33_n[3]-1.0*g13_n[3]*g31_n[3]; 
  gr22_n[4] = g11_n[4]*g33_n[4]-1.0*g13_n[4]*g31_n[4]; 
  gr22_n[5] = g11_n[5]*g33_n[5]-1.0*g13_n[5]*g31_n[5]; 
  gr22_n[6] = g11_n[6]*g33_n[6]-1.0*g13_n[6]*g31_n[6]; 
  gr22_n[7] = g11_n[7]*g33_n[7]-1.0*g13_n[7]*g31_n[7]; 
  gr23_n[0] = g13_n[0]*g21_n[0]-1.0*g11_n[0]*g23_n[0]; 
  gr23_n[1] = g13_n[1]*g21_n[1]-1.0*g11_n[1]*g23_n[1]; 
  gr23_n[2] = g13_n[2]*g21_n[2]-1.0*g11_n[2]*g23_n[2]; 
  gr23_n[3] = g13_n[3]*g21_n[3]-1.0*g11_n[3]*g23_n[3]; 
  gr23_n[4] = g13_n[4]*g21_n[4]-1.0*g11_n[4]*g23_n[4]; 
  gr23_n[5] = g13_n[5]*g21_n[5]-1.0*g11_n[5]*g23_n[5]; 
  gr23_n[6] = g13_n[6]*g21_n[6]-1.0*g11_n[6]*g23_n[6]; 
  gr23_n[7] = g13_n[7]*g21_n[7]-1.0*g11_n[7]*g23_n[7]; 
  gr33_n[0] = g11_n[0]*g22_n[0]-1.0*g12_n[0]*g21_n[0]; 
  gr33_n[1] = g11_n[1]*g22_n[1]-1.0*g12_n[1]*g21_n[1]; 
  gr33_n[2] = g11_n[2]*g22_n[2]-1.0*g12_n[2]*g21_n[2]; 
  gr33_n[3] = g11_n[3]*g22_n[3]-1.0*g12_n[3]*g21_n[3]; 
  gr33_n[4] = g11_n[4]*g22_n[4]-1.0*g12_n[4]*g21_n[4]; 
  gr33_n[5] = g11_n[5]*g22_n[5]-1.0*g12_n[5]*g21_n[5]; 
  gr33_n[6] = g11_n[6]*g22_n[6]-1.0*g12_n[6]*g21_n[6]; 
  gr33_n[7] = g11_n[7]*g22_n[7]-1.0*g12_n[7]*g21_n[7]; 
// multiply by 1/det
gr11_n[0] = gr11_n[0]/Jsq_n[0]; 
gr11_n[1] = gr11_n[1]/Jsq_n[1]; 
gr11_n[2] = gr11_n[2]/Jsq_n[2]; 
gr11_n[3] = gr11_n[3]/Jsq_n[3]; 
gr11_n[4] = gr11_n[4]/Jsq_n[4]; 
gr11_n[5] = gr11_n[5]/Jsq_n[5]; 
gr11_n[6] = gr11_n[6]/Jsq_n[6]; 
gr11_n[7] = gr11_n[7]/Jsq_n[7]; 
gr12_n[0] = gr12_n[0]/Jsq_n[0]; 
gr12_n[1] = gr12_n[1]/Jsq_n[1]; 
gr12_n[2] = gr12_n[2]/Jsq_n[2]; 
gr12_n[3] = gr12_n[3]/Jsq_n[3]; 
gr12_n[4] = gr12_n[4]/Jsq_n[4]; 
gr12_n[5] = gr12_n[5]/Jsq_n[5]; 
gr12_n[6] = gr12_n[6]/Jsq_n[6]; 
gr12_n[7] = gr12_n[7]/Jsq_n[7]; 
gr13_n[0] = gr13_n[0]/Jsq_n[0]; 
gr13_n[1] = gr13_n[1]/Jsq_n[1]; 
gr13_n[2] = gr13_n[2]/Jsq_n[2]; 
gr13_n[3] = gr13_n[3]/Jsq_n[3]; 
gr13_n[4] = gr13_n[4]/Jsq_n[4]; 
gr13_n[5] = gr13_n[5]/Jsq_n[5]; 
gr13_n[6] = gr13_n[6]/Jsq_n[6]; 
gr13_n[7] = gr13_n[7]/Jsq_n[7]; 
gr22_n[0] = gr22_n[0]/Jsq_n[0]; 
gr22_n[1] = gr22_n[1]/Jsq_n[1]; 
gr22_n[2] = gr22_n[2]/Jsq_n[2]; 
gr22_n[3] = gr22_n[3]/Jsq_n[3]; 
gr22_n[4] = gr22_n[4]/Jsq_n[4]; 
gr22_n[5] = gr22_n[5]/Jsq_n[5]; 
gr22_n[6] = gr22_n[6]/Jsq_n[6]; 
gr22_n[7] = gr22_n[7]/Jsq_n[7]; 
gr23_n[0] = gr23_n[0]/Jsq_n[0]; 
gr23_n[1] = gr23_n[1]/Jsq_n[1]; 
gr23_n[2] = gr23_n[2]/Jsq_n[2]; 
gr23_n[3] = gr23_n[3]/Jsq_n[3]; 
gr23_n[4] = gr23_n[4]/Jsq_n[4]; 
gr23_n[5] = gr23_n[5]/Jsq_n[5]; 
gr23_n[6] = gr23_n[6]/Jsq_n[6]; 
gr23_n[7] = gr23_n[7]/Jsq_n[7]; 
gr33_n[0] = gr33_n[0]/Jsq_n[0]; 
gr33_n[1] = gr33_n[1]/Jsq_n[1]; 
gr33_n[2] = gr33_n[2]/Jsq_n[2]; 
gr33_n[3] = gr33_n[3]/Jsq_n[3]; 
gr33_n[4] = gr33_n[4]/Jsq_n[4]; 
gr33_n[5] = gr33_n[5]/Jsq_n[5]; 
gr33_n[6] = gr33_n[6]/Jsq_n[6]; 
gr33_n[7] = gr33_n[7]/Jsq_n[7]; 
// Convert nodal to modal for g^ij 
  gr11[0] = 0.3535533905932741*gr11_n[7]+0.353553390593274*gr11_n[6]+0.353553390593274*gr11_n[5]+0.3535533905932739*gr11_n[4]+0.3535533905932738*gr11_n[3]+0.3535533905932738*gr11_n[2]+0.3535533905932738*gr11_n[1]+0.3535533905932738*gr11_n[0]; 
  gr11[1] = 0.2041241452319316*gr11_n[7]-0.2041241452319316*gr11_n[6]+0.2041241452319317*gr11_n[5]-0.2041241452319317*gr11_n[4]+0.2041241452319315*gr11_n[3]-0.2041241452319315*gr11_n[2]+0.2041241452319315*gr11_n[1]-0.2041241452319315*gr11_n[0]; 
  gr11[2] = 0.2041241452319317*gr11_n[7]+0.2041241452319316*gr11_n[6]-0.2041241452319317*gr11_n[5]-0.2041241452319316*gr11_n[4]+0.2041241452319315*gr11_n[3]+0.2041241452319315*gr11_n[2]-0.2041241452319315*gr11_n[1]-0.2041241452319315*gr11_n[0]; 
  gr11[3] = 0.2041241452319316*gr11_n[7]+0.2041241452319316*gr11_n[6]+0.2041241452319316*gr11_n[5]+0.2041241452319316*gr11_n[4]-0.2041241452319315*gr11_n[3]-0.2041241452319315*gr11_n[2]-0.2041241452319315*gr11_n[1]-0.2041241452319315*gr11_n[0]; 
  gr11[4] = 0.117851130197758*gr11_n[7]-0.117851130197758*gr11_n[6]-0.117851130197758*gr11_n[5]+0.117851130197758*gr11_n[4]+0.1178511301977579*gr11_n[3]-0.1178511301977579*gr11_n[2]-0.1178511301977579*gr11_n[1]+0.1178511301977579*gr11_n[0]; 
  gr11[5] = 0.117851130197758*gr11_n[7]-0.117851130197758*gr11_n[6]+0.117851130197758*gr11_n[5]-0.117851130197758*gr11_n[4]-0.1178511301977579*gr11_n[3]+0.1178511301977579*gr11_n[2]-0.1178511301977579*gr11_n[1]+0.1178511301977579*gr11_n[0]; 
  gr11[6] = 0.1178511301977579*gr11_n[7]+0.117851130197758*gr11_n[6]-0.117851130197758*gr11_n[5]-0.117851130197758*gr11_n[4]-0.1178511301977579*gr11_n[3]-0.1178511301977579*gr11_n[2]+0.1178511301977579*gr11_n[1]+0.1178511301977579*gr11_n[0]; 
  gr11[7] = 0.0680413817439772*gr11_n[7]-0.06804138174397721*gr11_n[6]-0.06804138174397721*gr11_n[5]+0.06804138174397721*gr11_n[4]-0.06804138174397717*gr11_n[3]+0.06804138174397717*gr11_n[2]+0.06804138174397717*gr11_n[1]-0.06804138174397717*gr11_n[0]; 

  gr12[0] = 0.3535533905932741*gr12_n[7]+0.353553390593274*gr12_n[6]+0.353553390593274*gr12_n[5]+0.3535533905932739*gr12_n[4]+0.3535533905932738*gr12_n[3]+0.3535533905932738*gr12_n[2]+0.3535533905932738*gr12_n[1]+0.3535533905932738*gr12_n[0]; 
  gr12[1] = 0.2041241452319316*gr12_n[7]-0.2041241452319316*gr12_n[6]+0.2041241452319317*gr12_n[5]-0.2041241452319317*gr12_n[4]+0.2041241452319315*gr12_n[3]-0.2041241452319315*gr12_n[2]+0.2041241452319315*gr12_n[1]-0.2041241452319315*gr12_n[0]; 
  gr12[2] = 0.2041241452319317*gr12_n[7]+0.2041241452319316*gr12_n[6]-0.2041241452319317*gr12_n[5]-0.2041241452319316*gr12_n[4]+0.2041241452319315*gr12_n[3]+0.2041241452319315*gr12_n[2]-0.2041241452319315*gr12_n[1]-0.2041241452319315*gr12_n[0]; 
  gr12[3] = 0.2041241452319316*gr12_n[7]+0.2041241452319316*gr12_n[6]+0.2041241452319316*gr12_n[5]+0.2041241452319316*gr12_n[4]-0.2041241452319315*gr12_n[3]-0.2041241452319315*gr12_n[2]-0.2041241452319315*gr12_n[1]-0.2041241452319315*gr12_n[0]; 
  gr12[4] = 0.117851130197758*gr12_n[7]-0.117851130197758*gr12_n[6]-0.117851130197758*gr12_n[5]+0.117851130197758*gr12_n[4]+0.1178511301977579*gr12_n[3]-0.1178511301977579*gr12_n[2]-0.1178511301977579*gr12_n[1]+0.1178511301977579*gr12_n[0]; 
  gr12[5] = 0.117851130197758*gr12_n[7]-0.117851130197758*gr12_n[6]+0.117851130197758*gr12_n[5]-0.117851130197758*gr12_n[4]-0.1178511301977579*gr12_n[3]+0.1178511301977579*gr12_n[2]-0.1178511301977579*gr12_n[1]+0.1178511301977579*gr12_n[0]; 
  gr12[6] = 0.1178511301977579*gr12_n[7]+0.117851130197758*gr12_n[6]-0.117851130197758*gr12_n[5]-0.117851130197758*gr12_n[4]-0.1178511301977579*gr12_n[3]-0.1178511301977579*gr12_n[2]+0.1178511301977579*gr12_n[1]+0.1178511301977579*gr12_n[0]; 
  gr12[7] = 0.0680413817439772*gr12_n[7]-0.06804138174397721*gr12_n[6]-0.06804138174397721*gr12_n[5]+0.06804138174397721*gr12_n[4]-0.06804138174397717*gr12_n[3]+0.06804138174397717*gr12_n[2]+0.06804138174397717*gr12_n[1]-0.06804138174397717*gr12_n[0]; 

  gr13[0] = 0.3535533905932741*gr13_n[7]+0.353553390593274*gr13_n[6]+0.353553390593274*gr13_n[5]+0.3535533905932739*gr13_n[4]+0.3535533905932738*gr13_n[3]+0.3535533905932738*gr13_n[2]+0.3535533905932738*gr13_n[1]+0.3535533905932738*gr13_n[0]; 
  gr13[1] = 0.2041241452319316*gr13_n[7]-0.2041241452319316*gr13_n[6]+0.2041241452319317*gr13_n[5]-0.2041241452319317*gr13_n[4]+0.2041241452319315*gr13_n[3]-0.2041241452319315*gr13_n[2]+0.2041241452319315*gr13_n[1]-0.2041241452319315*gr13_n[0]; 
  gr13[2] = 0.2041241452319317*gr13_n[7]+0.2041241452319316*gr13_n[6]-0.2041241452319317*gr13_n[5]-0.2041241452319316*gr13_n[4]+0.2041241452319315*gr13_n[3]+0.2041241452319315*gr13_n[2]-0.2041241452319315*gr13_n[1]-0.2041241452319315*gr13_n[0]; 
  gr13[3] = 0.2041241452319316*gr13_n[7]+0.2041241452319316*gr13_n[6]+0.2041241452319316*gr13_n[5]+0.2041241452319316*gr13_n[4]-0.2041241452319315*gr13_n[3]-0.2041241452319315*gr13_n[2]-0.2041241452319315*gr13_n[1]-0.2041241452319315*gr13_n[0]; 
  gr13[4] = 0.117851130197758*gr13_n[7]-0.117851130197758*gr13_n[6]-0.117851130197758*gr13_n[5]+0.117851130197758*gr13_n[4]+0.1178511301977579*gr13_n[3]-0.1178511301977579*gr13_n[2]-0.1178511301977579*gr13_n[1]+0.1178511301977579*gr13_n[0]; 
  gr13[5] = 0.117851130197758*gr13_n[7]-0.117851130197758*gr13_n[6]+0.117851130197758*gr13_n[5]-0.117851130197758*gr13_n[4]-0.1178511301977579*gr13_n[3]+0.1178511301977579*gr13_n[2]-0.1178511301977579*gr13_n[1]+0.1178511301977579*gr13_n[0]; 
  gr13[6] = 0.1178511301977579*gr13_n[7]+0.117851130197758*gr13_n[6]-0.117851130197758*gr13_n[5]-0.117851130197758*gr13_n[4]-0.1178511301977579*gr13_n[3]-0.1178511301977579*gr13_n[2]+0.1178511301977579*gr13_n[1]+0.1178511301977579*gr13_n[0]; 
  gr13[7] = 0.0680413817439772*gr13_n[7]-0.06804138174397721*gr13_n[6]-0.06804138174397721*gr13_n[5]+0.06804138174397721*gr13_n[4]-0.06804138174397717*gr13_n[3]+0.06804138174397717*gr13_n[2]+0.06804138174397717*gr13_n[1]-0.06804138174397717*gr13_n[0]; 

  gr22[0] = 0.3535533905932741*gr22_n[7]+0.353553390593274*gr22_n[6]+0.353553390593274*gr22_n[5]+0.3535533905932739*gr22_n[4]+0.3535533905932738*gr22_n[3]+0.3535533905932738*gr22_n[2]+0.3535533905932738*gr22_n[1]+0.3535533905932738*gr22_n[0]; 
  gr22[1] = 0.2041241452319316*gr22_n[7]-0.2041241452319316*gr22_n[6]+0.2041241452319317*gr22_n[5]-0.2041241452319317*gr22_n[4]+0.2041241452319315*gr22_n[3]-0.2041241452319315*gr22_n[2]+0.2041241452319315*gr22_n[1]-0.2041241452319315*gr22_n[0]; 
  gr22[2] = 0.2041241452319317*gr22_n[7]+0.2041241452319316*gr22_n[6]-0.2041241452319317*gr22_n[5]-0.2041241452319316*gr22_n[4]+0.2041241452319315*gr22_n[3]+0.2041241452319315*gr22_n[2]-0.2041241452319315*gr22_n[1]-0.2041241452319315*gr22_n[0]; 
  gr22[3] = 0.2041241452319316*gr22_n[7]+0.2041241452319316*gr22_n[6]+0.2041241452319316*gr22_n[5]+0.2041241452319316*gr22_n[4]-0.2041241452319315*gr22_n[3]-0.2041241452319315*gr22_n[2]-0.2041241452319315*gr22_n[1]-0.2041241452319315*gr22_n[0]; 
  gr22[4] = 0.117851130197758*gr22_n[7]-0.117851130197758*gr22_n[6]-0.117851130197758*gr22_n[5]+0.117851130197758*gr22_n[4]+0.1178511301977579*gr22_n[3]-0.1178511301977579*gr22_n[2]-0.1178511301977579*gr22_n[1]+0.1178511301977579*gr22_n[0]; 
  gr22[5] = 0.117851130197758*gr22_n[7]-0.117851130197758*gr22_n[6]+0.117851130197758*gr22_n[5]-0.117851130197758*gr22_n[4]-0.1178511301977579*gr22_n[3]+0.1178511301977579*gr22_n[2]-0.1178511301977579*gr22_n[1]+0.1178511301977579*gr22_n[0]; 
  gr22[6] = 0.1178511301977579*gr22_n[7]+0.117851130197758*gr22_n[6]-0.117851130197758*gr22_n[5]-0.117851130197758*gr22_n[4]-0.1178511301977579*gr22_n[3]-0.1178511301977579*gr22_n[2]+0.1178511301977579*gr22_n[1]+0.1178511301977579*gr22_n[0]; 
  gr22[7] = 0.0680413817439772*gr22_n[7]-0.06804138174397721*gr22_n[6]-0.06804138174397721*gr22_n[5]+0.06804138174397721*gr22_n[4]-0.06804138174397717*gr22_n[3]+0.06804138174397717*gr22_n[2]+0.06804138174397717*gr22_n[1]-0.06804138174397717*gr22_n[0]; 

  gr23[0] = 0.3535533905932741*gr23_n[7]+0.353553390593274*gr23_n[6]+0.353553390593274*gr23_n[5]+0.3535533905932739*gr23_n[4]+0.3535533905932738*gr23_n[3]+0.3535533905932738*gr23_n[2]+0.3535533905932738*gr23_n[1]+0.3535533905932738*gr23_n[0]; 
  gr23[1] = 0.2041241452319316*gr23_n[7]-0.2041241452319316*gr23_n[6]+0.2041241452319317*gr23_n[5]-0.2041241452319317*gr23_n[4]+0.2041241452319315*gr23_n[3]-0.2041241452319315*gr23_n[2]+0.2041241452319315*gr23_n[1]-0.2041241452319315*gr23_n[0]; 
  gr23[2] = 0.2041241452319317*gr23_n[7]+0.2041241452319316*gr23_n[6]-0.2041241452319317*gr23_n[5]-0.2041241452319316*gr23_n[4]+0.2041241452319315*gr23_n[3]+0.2041241452319315*gr23_n[2]-0.2041241452319315*gr23_n[1]-0.2041241452319315*gr23_n[0]; 
  gr23[3] = 0.2041241452319316*gr23_n[7]+0.2041241452319316*gr23_n[6]+0.2041241452319316*gr23_n[5]+0.2041241452319316*gr23_n[4]-0.2041241452319315*gr23_n[3]-0.2041241452319315*gr23_n[2]-0.2041241452319315*gr23_n[1]-0.2041241452319315*gr23_n[0]; 
  gr23[4] = 0.117851130197758*gr23_n[7]-0.117851130197758*gr23_n[6]-0.117851130197758*gr23_n[5]+0.117851130197758*gr23_n[4]+0.1178511301977579*gr23_n[3]-0.1178511301977579*gr23_n[2]-0.1178511301977579*gr23_n[1]+0.1178511301977579*gr23_n[0]; 
  gr23[5] = 0.117851130197758*gr23_n[7]-0.117851130197758*gr23_n[6]+0.117851130197758*gr23_n[5]-0.117851130197758*gr23_n[4]-0.1178511301977579*gr23_n[3]+0.1178511301977579*gr23_n[2]-0.1178511301977579*gr23_n[1]+0.1178511301977579*gr23_n[0]; 
  gr23[6] = 0.1178511301977579*gr23_n[7]+0.117851130197758*gr23_n[6]-0.117851130197758*gr23_n[5]-0.117851130197758*gr23_n[4]-0.1178511301977579*gr23_n[3]-0.1178511301977579*gr23_n[2]+0.1178511301977579*gr23_n[1]+0.1178511301977579*gr23_n[0]; 
  gr23[7] = 0.0680413817439772*gr23_n[7]-0.06804138174397721*gr23_n[6]-0.06804138174397721*gr23_n[5]+0.06804138174397721*gr23_n[4]-0.06804138174397717*gr23_n[3]+0.06804138174397717*gr23_n[2]+0.06804138174397717*gr23_n[1]-0.06804138174397717*gr23_n[0]; 

  gr33[0] = 0.3535533905932741*gr33_n[7]+0.353553390593274*gr33_n[6]+0.353553390593274*gr33_n[5]+0.3535533905932739*gr33_n[4]+0.3535533905932738*gr33_n[3]+0.3535533905932738*gr33_n[2]+0.3535533905932738*gr33_n[1]+0.3535533905932738*gr33_n[0]; 
  gr33[1] = 0.2041241452319316*gr33_n[7]-0.2041241452319316*gr33_n[6]+0.2041241452319317*gr33_n[5]-0.2041241452319317*gr33_n[4]+0.2041241452319315*gr33_n[3]-0.2041241452319315*gr33_n[2]+0.2041241452319315*gr33_n[1]-0.2041241452319315*gr33_n[0]; 
  gr33[2] = 0.2041241452319317*gr33_n[7]+0.2041241452319316*gr33_n[6]-0.2041241452319317*gr33_n[5]-0.2041241452319316*gr33_n[4]+0.2041241452319315*gr33_n[3]+0.2041241452319315*gr33_n[2]-0.2041241452319315*gr33_n[1]-0.2041241452319315*gr33_n[0]; 
  gr33[3] = 0.2041241452319316*gr33_n[7]+0.2041241452319316*gr33_n[6]+0.2041241452319316*gr33_n[5]+0.2041241452319316*gr33_n[4]-0.2041241452319315*gr33_n[3]-0.2041241452319315*gr33_n[2]-0.2041241452319315*gr33_n[1]-0.2041241452319315*gr33_n[0]; 
  gr33[4] = 0.117851130197758*gr33_n[7]-0.117851130197758*gr33_n[6]-0.117851130197758*gr33_n[5]+0.117851130197758*gr33_n[4]+0.1178511301977579*gr33_n[3]-0.1178511301977579*gr33_n[2]-0.1178511301977579*gr33_n[1]+0.1178511301977579*gr33_n[0]; 
  gr33[5] = 0.117851130197758*gr33_n[7]-0.117851130197758*gr33_n[6]+0.117851130197758*gr33_n[5]-0.117851130197758*gr33_n[4]-0.1178511301977579*gr33_n[3]+0.1178511301977579*gr33_n[2]-0.1178511301977579*gr33_n[1]+0.1178511301977579*gr33_n[0]; 
  gr33[6] = 0.1178511301977579*gr33_n[7]+0.117851130197758*gr33_n[6]-0.117851130197758*gr33_n[5]-0.117851130197758*gr33_n[4]-0.1178511301977579*gr33_n[3]-0.1178511301977579*gr33_n[2]+0.1178511301977579*gr33_n[1]+0.1178511301977579*gr33_n[0]; 
  gr33[7] = 0.0680413817439772*gr33_n[7]-0.06804138174397721*gr33_n[6]-0.06804138174397721*gr33_n[5]+0.06804138174397721*gr33_n[4]-0.06804138174397717*gr33_n[3]+0.06804138174397717*gr33_n[2]+0.06804138174397717*gr33_n[1]-0.06804138174397717*gr33_n[0]; 

// Calculate b_i at nodes 
  b1_n[0] = g13_n[0]/sqrt(g33_n[0]); 
  b1_n[1] = g13_n[1]/sqrt(g33_n[1]); 
  b1_n[2] = g13_n[2]/sqrt(g33_n[2]); 
  b1_n[3] = g13_n[3]/sqrt(g33_n[3]); 
  b1_n[4] = g13_n[4]/sqrt(g33_n[4]); 
  b1_n[5] = g13_n[5]/sqrt(g33_n[5]); 
  b1_n[6] = g13_n[6]/sqrt(g33_n[6]); 
  b1_n[7] = g13_n[7]/sqrt(g33_n[7]); 
  b2_n[0] = g23_n[0]/sqrt(g33_n[0]); 
  b2_n[1] = g23_n[1]/sqrt(g33_n[1]); 
  b2_n[2] = g23_n[2]/sqrt(g33_n[2]); 
  b2_n[3] = g23_n[3]/sqrt(g33_n[3]); 
  b2_n[4] = g23_n[4]/sqrt(g33_n[4]); 
  b2_n[5] = g23_n[5]/sqrt(g33_n[5]); 
  b2_n[6] = g23_n[6]/sqrt(g33_n[6]); 
  b2_n[7] = g23_n[7]/sqrt(g33_n[7]); 
  b3_n[0] = sqrt(g33_n[0]); 
  b3_n[1] = sqrt(g33_n[1]); 
  b3_n[2] = sqrt(g33_n[2]); 
  b3_n[3] = sqrt(g33_n[3]); 
  b3_n[4] = sqrt(g33_n[4]); 
  b3_n[5] = sqrt(g33_n[5]); 
  b3_n[6] = sqrt(g33_n[6]); 
  b3_n[7] = sqrt(g33_n[7]); 
// Convert nodal to modal for b_i 
  b1[0] = 0.3535533905932741*b1_n[7]+0.353553390593274*b1_n[6]+0.353553390593274*b1_n[5]+0.3535533905932739*b1_n[4]+0.3535533905932738*b1_n[3]+0.3535533905932738*b1_n[2]+0.3535533905932738*b1_n[1]+0.3535533905932738*b1_n[0]; 
  b1[1] = 0.2041241452319316*b1_n[7]-0.2041241452319316*b1_n[6]+0.2041241452319317*b1_n[5]-0.2041241452319317*b1_n[4]+0.2041241452319315*b1_n[3]-0.2041241452319315*b1_n[2]+0.2041241452319315*b1_n[1]-0.2041241452319315*b1_n[0]; 
  b1[2] = 0.2041241452319317*b1_n[7]+0.2041241452319316*b1_n[6]-0.2041241452319317*b1_n[5]-0.2041241452319316*b1_n[4]+0.2041241452319315*b1_n[3]+0.2041241452319315*b1_n[2]-0.2041241452319315*b1_n[1]-0.2041241452319315*b1_n[0]; 
  b1[3] = 0.2041241452319316*b1_n[7]+0.2041241452319316*b1_n[6]+0.2041241452319316*b1_n[5]+0.2041241452319316*b1_n[4]-0.2041241452319315*b1_n[3]-0.2041241452319315*b1_n[2]-0.2041241452319315*b1_n[1]-0.2041241452319315*b1_n[0]; 
  b1[4] = 0.117851130197758*b1_n[7]-0.117851130197758*b1_n[6]-0.117851130197758*b1_n[5]+0.117851130197758*b1_n[4]+0.1178511301977579*b1_n[3]-0.1178511301977579*b1_n[2]-0.1178511301977579*b1_n[1]+0.1178511301977579*b1_n[0]; 
  b1[5] = 0.117851130197758*b1_n[7]-0.117851130197758*b1_n[6]+0.117851130197758*b1_n[5]-0.117851130197758*b1_n[4]-0.1178511301977579*b1_n[3]+0.1178511301977579*b1_n[2]-0.1178511301977579*b1_n[1]+0.1178511301977579*b1_n[0]; 
  b1[6] = 0.1178511301977579*b1_n[7]+0.117851130197758*b1_n[6]-0.117851130197758*b1_n[5]-0.117851130197758*b1_n[4]-0.1178511301977579*b1_n[3]-0.1178511301977579*b1_n[2]+0.1178511301977579*b1_n[1]+0.1178511301977579*b1_n[0]; 
  b1[7] = 0.0680413817439772*b1_n[7]-0.06804138174397721*b1_n[6]-0.06804138174397721*b1_n[5]+0.06804138174397721*b1_n[4]-0.06804138174397717*b1_n[3]+0.06804138174397717*b1_n[2]+0.06804138174397717*b1_n[1]-0.06804138174397717*b1_n[0]; 

  b2[0] = 0.3535533905932741*b2_n[7]+0.353553390593274*b2_n[6]+0.353553390593274*b2_n[5]+0.3535533905932739*b2_n[4]+0.3535533905932738*b2_n[3]+0.3535533905932738*b2_n[2]+0.3535533905932738*b2_n[1]+0.3535533905932738*b2_n[0]; 
  b2[1] = 0.2041241452319316*b2_n[7]-0.2041241452319316*b2_n[6]+0.2041241452319317*b2_n[5]-0.2041241452319317*b2_n[4]+0.2041241452319315*b2_n[3]-0.2041241452319315*b2_n[2]+0.2041241452319315*b2_n[1]-0.2041241452319315*b2_n[0]; 
  b2[2] = 0.2041241452319317*b2_n[7]+0.2041241452319316*b2_n[6]-0.2041241452319317*b2_n[5]-0.2041241452319316*b2_n[4]+0.2041241452319315*b2_n[3]+0.2041241452319315*b2_n[2]-0.2041241452319315*b2_n[1]-0.2041241452319315*b2_n[0]; 
  b2[3] = 0.2041241452319316*b2_n[7]+0.2041241452319316*b2_n[6]+0.2041241452319316*b2_n[5]+0.2041241452319316*b2_n[4]-0.2041241452319315*b2_n[3]-0.2041241452319315*b2_n[2]-0.2041241452319315*b2_n[1]-0.2041241452319315*b2_n[0]; 
  b2[4] = 0.117851130197758*b2_n[7]-0.117851130197758*b2_n[6]-0.117851130197758*b2_n[5]+0.117851130197758*b2_n[4]+0.1178511301977579*b2_n[3]-0.1178511301977579*b2_n[2]-0.1178511301977579*b2_n[1]+0.1178511301977579*b2_n[0]; 
  b2[5] = 0.117851130197758*b2_n[7]-0.117851130197758*b2_n[6]+0.117851130197758*b2_n[5]-0.117851130197758*b2_n[4]-0.1178511301977579*b2_n[3]+0.1178511301977579*b2_n[2]-0.1178511301977579*b2_n[1]+0.1178511301977579*b2_n[0]; 
  b2[6] = 0.1178511301977579*b2_n[7]+0.117851130197758*b2_n[6]-0.117851130197758*b2_n[5]-0.117851130197758*b2_n[4]-0.1178511301977579*b2_n[3]-0.1178511301977579*b2_n[2]+0.1178511301977579*b2_n[1]+0.1178511301977579*b2_n[0]; 
  b2[7] = 0.0680413817439772*b2_n[7]-0.06804138174397721*b2_n[6]-0.06804138174397721*b2_n[5]+0.06804138174397721*b2_n[4]-0.06804138174397717*b2_n[3]+0.06804138174397717*b2_n[2]+0.06804138174397717*b2_n[1]-0.06804138174397717*b2_n[0]; 

  b3[0] = 0.3535533905932741*b3_n[7]+0.353553390593274*b3_n[6]+0.353553390593274*b3_n[5]+0.3535533905932739*b3_n[4]+0.3535533905932738*b3_n[3]+0.3535533905932738*b3_n[2]+0.3535533905932738*b3_n[1]+0.3535533905932738*b3_n[0]; 
  b3[1] = 0.2041241452319316*b3_n[7]-0.2041241452319316*b3_n[6]+0.2041241452319317*b3_n[5]-0.2041241452319317*b3_n[4]+0.2041241452319315*b3_n[3]-0.2041241452319315*b3_n[2]+0.2041241452319315*b3_n[1]-0.2041241452319315*b3_n[0]; 
  b3[2] = 0.2041241452319317*b3_n[7]+0.2041241452319316*b3_n[6]-0.2041241452319317*b3_n[5]-0.2041241452319316*b3_n[4]+0.2041241452319315*b3_n[3]+0.2041241452319315*b3_n[2]-0.2041241452319315*b3_n[1]-0.2041241452319315*b3_n[0]; 
  b3[3] = 0.2041241452319316*b3_n[7]+0.2041241452319316*b3_n[6]+0.2041241452319316*b3_n[5]+0.2041241452319316*b3_n[4]-0.2041241452319315*b3_n[3]-0.2041241452319315*b3_n[2]-0.2041241452319315*b3_n[1]-0.2041241452319315*b3_n[0]; 
  b3[4] = 0.117851130197758*b3_n[7]-0.117851130197758*b3_n[6]-0.117851130197758*b3_n[5]+0.117851130197758*b3_n[4]+0.1178511301977579*b3_n[3]-0.1178511301977579*b3_n[2]-0.1178511301977579*b3_n[1]+0.1178511301977579*b3_n[0]; 
  b3[5] = 0.117851130197758*b3_n[7]-0.117851130197758*b3_n[6]+0.117851130197758*b3_n[5]-0.117851130197758*b3_n[4]-0.1178511301977579*b3_n[3]+0.1178511301977579*b3_n[2]-0.1178511301977579*b3_n[1]+0.1178511301977579*b3_n[0]; 
  b3[6] = 0.1178511301977579*b3_n[7]+0.117851130197758*b3_n[6]-0.117851130197758*b3_n[5]-0.117851130197758*b3_n[4]-0.1178511301977579*b3_n[3]-0.1178511301977579*b3_n[2]+0.1178511301977579*b3_n[1]+0.1178511301977579*b3_n[0]; 
  b3[7] = 0.0680413817439772*b3_n[7]-0.06804138174397721*b3_n[6]-0.06804138174397721*b3_n[5]+0.06804138174397721*b3_n[4]-0.06804138174397717*b3_n[3]+0.06804138174397717*b3_n[2]+0.06804138174397717*b3_n[1]-0.06804138174397717*b3_n[0]; 

// Calculate cmag at nodes 
  cmag_n[0] = (J_n[0]*bmag_n[0])/sqrt(g33_n[0]); 
  cmag_n[1] = (J_n[1]*bmag_n[1])/sqrt(g33_n[1]); 
  cmag_n[2] = (J_n[2]*bmag_n[2])/sqrt(g33_n[2]); 
  cmag_n[3] = (J_n[3]*bmag_n[3])/sqrt(g33_n[3]); 
  cmag_n[4] = (J_n[4]*bmag_n[4])/sqrt(g33_n[4]); 
  cmag_n[5] = (J_n[5]*bmag_n[5])/sqrt(g33_n[5]); 
  cmag_n[6] = (J_n[6]*bmag_n[6])/sqrt(g33_n[6]); 
  cmag_n[7] = (J_n[7]*bmag_n[7])/sqrt(g33_n[7]); 
// Convert nodal to modal for cmag 
  cmag[0] = 0.3535533905932741*cmag_n[7]+0.353553390593274*cmag_n[6]+0.353553390593274*cmag_n[5]+0.3535533905932739*cmag_n[4]+0.3535533905932738*cmag_n[3]+0.3535533905932738*cmag_n[2]+0.3535533905932738*cmag_n[1]+0.3535533905932738*cmag_n[0]; 
  cmag[1] = 0.2041241452319316*cmag_n[7]-0.2041241452319316*cmag_n[6]+0.2041241452319317*cmag_n[5]-0.2041241452319317*cmag_n[4]+0.2041241452319315*cmag_n[3]-0.2041241452319315*cmag_n[2]+0.2041241452319315*cmag_n[1]-0.2041241452319315*cmag_n[0]; 
  cmag[2] = 0.2041241452319317*cmag_n[7]+0.2041241452319316*cmag_n[6]-0.2041241452319317*cmag_n[5]-0.2041241452319316*cmag_n[4]+0.2041241452319315*cmag_n[3]+0.2041241452319315*cmag_n[2]-0.2041241452319315*cmag_n[1]-0.2041241452319315*cmag_n[0]; 
  cmag[3] = 0.2041241452319316*cmag_n[7]+0.2041241452319316*cmag_n[6]+0.2041241452319316*cmag_n[5]+0.2041241452319316*cmag_n[4]-0.2041241452319315*cmag_n[3]-0.2041241452319315*cmag_n[2]-0.2041241452319315*cmag_n[1]-0.2041241452319315*cmag_n[0]; 
  cmag[4] = 0.117851130197758*cmag_n[7]-0.117851130197758*cmag_n[6]-0.117851130197758*cmag_n[5]+0.117851130197758*cmag_n[4]+0.1178511301977579*cmag_n[3]-0.1178511301977579*cmag_n[2]-0.1178511301977579*cmag_n[1]+0.1178511301977579*cmag_n[0]; 
  cmag[5] = 0.117851130197758*cmag_n[7]-0.117851130197758*cmag_n[6]+0.117851130197758*cmag_n[5]-0.117851130197758*cmag_n[4]-0.1178511301977579*cmag_n[3]+0.1178511301977579*cmag_n[2]-0.1178511301977579*cmag_n[1]+0.1178511301977579*cmag_n[0]; 
  cmag[6] = 0.1178511301977579*cmag_n[7]+0.117851130197758*cmag_n[6]-0.117851130197758*cmag_n[5]-0.117851130197758*cmag_n[4]-0.1178511301977579*cmag_n[3]-0.1178511301977579*cmag_n[2]+0.1178511301977579*cmag_n[1]+0.1178511301977579*cmag_n[0]; 
  cmag[7] = 0.0680413817439772*cmag_n[7]-0.06804138174397721*cmag_n[6]-0.06804138174397721*cmag_n[5]+0.06804138174397721*cmag_n[4]-0.06804138174397717*cmag_n[3]+0.06804138174397717*cmag_n[2]+0.06804138174397717*cmag_n[1]-0.06804138174397717*cmag_n[0]; 
// Calculate gxxJ at nodes 
gxxJ_n[0] = gr11_n[0]*J_n[0]; 
gxxJ_n[1] = gr11_n[1]*J_n[1]; 
gxxJ_n[2] = gr11_n[2]*J_n[2]; 
gxxJ_n[3] = gr11_n[3]*J_n[3]; 
gxxJ_n[4] = gr11_n[4]*J_n[4]; 
gxxJ_n[5] = gr11_n[5]*J_n[5]; 
gxxJ_n[6] = gr11_n[6]*J_n[6]; 
gxxJ_n[7] = gr11_n[7]*J_n[7]; 
// Convert nodal to modal for gxxJ 
  gxxJ[0] = 0.3535533905932741*gxxJ_n[7]+0.353553390593274*gxxJ_n[6]+0.353553390593274*gxxJ_n[5]+0.3535533905932739*gxxJ_n[4]+0.3535533905932738*gxxJ_n[3]+0.3535533905932738*gxxJ_n[2]+0.3535533905932738*gxxJ_n[1]+0.3535533905932738*gxxJ_n[0]; 
  gxxJ[1] = 0.2041241452319316*gxxJ_n[7]-0.2041241452319316*gxxJ_n[6]+0.2041241452319317*gxxJ_n[5]-0.2041241452319317*gxxJ_n[4]+0.2041241452319315*gxxJ_n[3]-0.2041241452319315*gxxJ_n[2]+0.2041241452319315*gxxJ_n[1]-0.2041241452319315*gxxJ_n[0]; 
  gxxJ[2] = 0.2041241452319317*gxxJ_n[7]+0.2041241452319316*gxxJ_n[6]-0.2041241452319317*gxxJ_n[5]-0.2041241452319316*gxxJ_n[4]+0.2041241452319315*gxxJ_n[3]+0.2041241452319315*gxxJ_n[2]-0.2041241452319315*gxxJ_n[1]-0.2041241452319315*gxxJ_n[0]; 
  gxxJ[3] = 0.2041241452319316*gxxJ_n[7]+0.2041241452319316*gxxJ_n[6]+0.2041241452319316*gxxJ_n[5]+0.2041241452319316*gxxJ_n[4]-0.2041241452319315*gxxJ_n[3]-0.2041241452319315*gxxJ_n[2]-0.2041241452319315*gxxJ_n[1]-0.2041241452319315*gxxJ_n[0]; 
  gxxJ[4] = 0.117851130197758*gxxJ_n[7]-0.117851130197758*gxxJ_n[6]-0.117851130197758*gxxJ_n[5]+0.117851130197758*gxxJ_n[4]+0.1178511301977579*gxxJ_n[3]-0.1178511301977579*gxxJ_n[2]-0.1178511301977579*gxxJ_n[1]+0.1178511301977579*gxxJ_n[0]; 
  gxxJ[5] = 0.117851130197758*gxxJ_n[7]-0.117851130197758*gxxJ_n[6]+0.117851130197758*gxxJ_n[5]-0.117851130197758*gxxJ_n[4]-0.1178511301977579*gxxJ_n[3]+0.1178511301977579*gxxJ_n[2]-0.1178511301977579*gxxJ_n[1]+0.1178511301977579*gxxJ_n[0]; 
  gxxJ[6] = 0.1178511301977579*gxxJ_n[7]+0.117851130197758*gxxJ_n[6]-0.117851130197758*gxxJ_n[5]-0.117851130197758*gxxJ_n[4]-0.1178511301977579*gxxJ_n[3]-0.1178511301977579*gxxJ_n[2]+0.1178511301977579*gxxJ_n[1]+0.1178511301977579*gxxJ_n[0]; 
  gxxJ[7] = 0.0680413817439772*gxxJ_n[7]-0.06804138174397721*gxxJ_n[6]-0.06804138174397721*gxxJ_n[5]+0.06804138174397721*gxxJ_n[4]-0.06804138174397717*gxxJ_n[3]+0.06804138174397717*gxxJ_n[2]+0.06804138174397717*gxxJ_n[1]-0.06804138174397717*gxxJ_n[0]; 
// Calculate gxyJ at nodes 
gxyJ_n[0] = gr12_n[0]*J_n[0]; 
gxyJ_n[1] = gr12_n[1]*J_n[1]; 
gxyJ_n[2] = gr12_n[2]*J_n[2]; 
gxyJ_n[3] = gr12_n[3]*J_n[3]; 
gxyJ_n[4] = gr12_n[4]*J_n[4]; 
gxyJ_n[5] = gr12_n[5]*J_n[5]; 
gxyJ_n[6] = gr12_n[6]*J_n[6]; 
gxyJ_n[7] = gr12_n[7]*J_n[7]; 
// Convert nodal to modal for gxyJ 
  gxyJ[0] = 0.3535533905932741*gxyJ_n[7]+0.353553390593274*gxyJ_n[6]+0.353553390593274*gxyJ_n[5]+0.3535533905932739*gxyJ_n[4]+0.3535533905932738*gxyJ_n[3]+0.3535533905932738*gxyJ_n[2]+0.3535533905932738*gxyJ_n[1]+0.3535533905932738*gxyJ_n[0]; 
  gxyJ[1] = 0.2041241452319316*gxyJ_n[7]-0.2041241452319316*gxyJ_n[6]+0.2041241452319317*gxyJ_n[5]-0.2041241452319317*gxyJ_n[4]+0.2041241452319315*gxyJ_n[3]-0.2041241452319315*gxyJ_n[2]+0.2041241452319315*gxyJ_n[1]-0.2041241452319315*gxyJ_n[0]; 
  gxyJ[2] = 0.2041241452319317*gxyJ_n[7]+0.2041241452319316*gxyJ_n[6]-0.2041241452319317*gxyJ_n[5]-0.2041241452319316*gxyJ_n[4]+0.2041241452319315*gxyJ_n[3]+0.2041241452319315*gxyJ_n[2]-0.2041241452319315*gxyJ_n[1]-0.2041241452319315*gxyJ_n[0]; 
  gxyJ[3] = 0.2041241452319316*gxyJ_n[7]+0.2041241452319316*gxyJ_n[6]+0.2041241452319316*gxyJ_n[5]+0.2041241452319316*gxyJ_n[4]-0.2041241452319315*gxyJ_n[3]-0.2041241452319315*gxyJ_n[2]-0.2041241452319315*gxyJ_n[1]-0.2041241452319315*gxyJ_n[0]; 
  gxyJ[4] = 0.117851130197758*gxyJ_n[7]-0.117851130197758*gxyJ_n[6]-0.117851130197758*gxyJ_n[5]+0.117851130197758*gxyJ_n[4]+0.1178511301977579*gxyJ_n[3]-0.1178511301977579*gxyJ_n[2]-0.1178511301977579*gxyJ_n[1]+0.1178511301977579*gxyJ_n[0]; 
  gxyJ[5] = 0.117851130197758*gxyJ_n[7]-0.117851130197758*gxyJ_n[6]+0.117851130197758*gxyJ_n[5]-0.117851130197758*gxyJ_n[4]-0.1178511301977579*gxyJ_n[3]+0.1178511301977579*gxyJ_n[2]-0.1178511301977579*gxyJ_n[1]+0.1178511301977579*gxyJ_n[0]; 
  gxyJ[6] = 0.1178511301977579*gxyJ_n[7]+0.117851130197758*gxyJ_n[6]-0.117851130197758*gxyJ_n[5]-0.117851130197758*gxyJ_n[4]-0.1178511301977579*gxyJ_n[3]-0.1178511301977579*gxyJ_n[2]+0.1178511301977579*gxyJ_n[1]+0.1178511301977579*gxyJ_n[0]; 
  gxyJ[7] = 0.0680413817439772*gxyJ_n[7]-0.06804138174397721*gxyJ_n[6]-0.06804138174397721*gxyJ_n[5]+0.06804138174397721*gxyJ_n[4]-0.06804138174397717*gxyJ_n[3]+0.06804138174397717*gxyJ_n[2]+0.06804138174397717*gxyJ_n[1]-0.06804138174397717*gxyJ_n[0]; 
// Calculate gyyJ at nodes 
gyyJ_n[0] = gr22_n[0]*J_n[0]; 
gyyJ_n[1] = gr22_n[1]*J_n[1]; 
gyyJ_n[2] = gr22_n[2]*J_n[2]; 
gyyJ_n[3] = gr22_n[3]*J_n[3]; 
gyyJ_n[4] = gr22_n[4]*J_n[4]; 
gyyJ_n[5] = gr22_n[5]*J_n[5]; 
gyyJ_n[6] = gr22_n[6]*J_n[6]; 
gyyJ_n[7] = gr22_n[7]*J_n[7]; 
// Convert nodal to modal for gyyJ 
  gyyJ[0] = 0.3535533905932741*gyyJ_n[7]+0.353553390593274*gyyJ_n[6]+0.353553390593274*gyyJ_n[5]+0.3535533905932739*gyyJ_n[4]+0.3535533905932738*gyyJ_n[3]+0.3535533905932738*gyyJ_n[2]+0.3535533905932738*gyyJ_n[1]+0.3535533905932738*gyyJ_n[0]; 
  gyyJ[1] = 0.2041241452319316*gyyJ_n[7]-0.2041241452319316*gyyJ_n[6]+0.2041241452319317*gyyJ_n[5]-0.2041241452319317*gyyJ_n[4]+0.2041241452319315*gyyJ_n[3]-0.2041241452319315*gyyJ_n[2]+0.2041241452319315*gyyJ_n[1]-0.2041241452319315*gyyJ_n[0]; 
  gyyJ[2] = 0.2041241452319317*gyyJ_n[7]+0.2041241452319316*gyyJ_n[6]-0.2041241452319317*gyyJ_n[5]-0.2041241452319316*gyyJ_n[4]+0.2041241452319315*gyyJ_n[3]+0.2041241452319315*gyyJ_n[2]-0.2041241452319315*gyyJ_n[1]-0.2041241452319315*gyyJ_n[0]; 
  gyyJ[3] = 0.2041241452319316*gyyJ_n[7]+0.2041241452319316*gyyJ_n[6]+0.2041241452319316*gyyJ_n[5]+0.2041241452319316*gyyJ_n[4]-0.2041241452319315*gyyJ_n[3]-0.2041241452319315*gyyJ_n[2]-0.2041241452319315*gyyJ_n[1]-0.2041241452319315*gyyJ_n[0]; 
  gyyJ[4] = 0.117851130197758*gyyJ_n[7]-0.117851130197758*gyyJ_n[6]-0.117851130197758*gyyJ_n[5]+0.117851130197758*gyyJ_n[4]+0.1178511301977579*gyyJ_n[3]-0.1178511301977579*gyyJ_n[2]-0.1178511301977579*gyyJ_n[1]+0.1178511301977579*gyyJ_n[0]; 
  gyyJ[5] = 0.117851130197758*gyyJ_n[7]-0.117851130197758*gyyJ_n[6]+0.117851130197758*gyyJ_n[5]-0.117851130197758*gyyJ_n[4]-0.1178511301977579*gyyJ_n[3]+0.1178511301977579*gyyJ_n[2]-0.1178511301977579*gyyJ_n[1]+0.1178511301977579*gyyJ_n[0]; 
  gyyJ[6] = 0.1178511301977579*gyyJ_n[7]+0.117851130197758*gyyJ_n[6]-0.117851130197758*gyyJ_n[5]-0.117851130197758*gyyJ_n[4]-0.1178511301977579*gyyJ_n[3]-0.1178511301977579*gyyJ_n[2]+0.1178511301977579*gyyJ_n[1]+0.1178511301977579*gyyJ_n[0]; 
  gyyJ[7] = 0.0680413817439772*gyyJ_n[7]-0.06804138174397721*gyyJ_n[6]-0.06804138174397721*gyyJ_n[5]+0.06804138174397721*gyyJ_n[4]-0.06804138174397717*gyyJ_n[3]+0.06804138174397717*gyyJ_n[2]+0.06804138174397717*gyyJ_n[1]-0.06804138174397717*gyyJ_n[0]; 
// Calculate gxzJ at nodes 
gxzJ_n[0] = gr13_n[0]*J_n[0]; 
gxzJ_n[1] = gr13_n[1]*J_n[1]; 
gxzJ_n[2] = gr13_n[2]*J_n[2]; 
gxzJ_n[3] = gr13_n[3]*J_n[3]; 
gxzJ_n[4] = gr13_n[4]*J_n[4]; 
gxzJ_n[5] = gr13_n[5]*J_n[5]; 
gxzJ_n[6] = gr13_n[6]*J_n[6]; 
gxzJ_n[7] = gr13_n[7]*J_n[7]; 
// Convert nodal to modal for gxzJ 
  gxzJ[0] = 0.3535533905932741*gxzJ_n[7]+0.353553390593274*gxzJ_n[6]+0.353553390593274*gxzJ_n[5]+0.3535533905932739*gxzJ_n[4]+0.3535533905932738*gxzJ_n[3]+0.3535533905932738*gxzJ_n[2]+0.3535533905932738*gxzJ_n[1]+0.3535533905932738*gxzJ_n[0]; 
  gxzJ[1] = 0.2041241452319316*gxzJ_n[7]-0.2041241452319316*gxzJ_n[6]+0.2041241452319317*gxzJ_n[5]-0.2041241452319317*gxzJ_n[4]+0.2041241452319315*gxzJ_n[3]-0.2041241452319315*gxzJ_n[2]+0.2041241452319315*gxzJ_n[1]-0.2041241452319315*gxzJ_n[0]; 
  gxzJ[2] = 0.2041241452319317*gxzJ_n[7]+0.2041241452319316*gxzJ_n[6]-0.2041241452319317*gxzJ_n[5]-0.2041241452319316*gxzJ_n[4]+0.2041241452319315*gxzJ_n[3]+0.2041241452319315*gxzJ_n[2]-0.2041241452319315*gxzJ_n[1]-0.2041241452319315*gxzJ_n[0]; 
  gxzJ[3] = 0.2041241452319316*gxzJ_n[7]+0.2041241452319316*gxzJ_n[6]+0.2041241452319316*gxzJ_n[5]+0.2041241452319316*gxzJ_n[4]-0.2041241452319315*gxzJ_n[3]-0.2041241452319315*gxzJ_n[2]-0.2041241452319315*gxzJ_n[1]-0.2041241452319315*gxzJ_n[0]; 
  gxzJ[4] = 0.117851130197758*gxzJ_n[7]-0.117851130197758*gxzJ_n[6]-0.117851130197758*gxzJ_n[5]+0.117851130197758*gxzJ_n[4]+0.1178511301977579*gxzJ_n[3]-0.1178511301977579*gxzJ_n[2]-0.1178511301977579*gxzJ_n[1]+0.1178511301977579*gxzJ_n[0]; 
  gxzJ[5] = 0.117851130197758*gxzJ_n[7]-0.117851130197758*gxzJ_n[6]+0.117851130197758*gxzJ_n[5]-0.117851130197758*gxzJ_n[4]-0.1178511301977579*gxzJ_n[3]+0.1178511301977579*gxzJ_n[2]-0.1178511301977579*gxzJ_n[1]+0.1178511301977579*gxzJ_n[0]; 
  gxzJ[6] = 0.1178511301977579*gxzJ_n[7]+0.117851130197758*gxzJ_n[6]-0.117851130197758*gxzJ_n[5]-0.117851130197758*gxzJ_n[4]-0.1178511301977579*gxzJ_n[3]-0.1178511301977579*gxzJ_n[2]+0.1178511301977579*gxzJ_n[1]+0.1178511301977579*gxzJ_n[0]; 
  gxzJ[7] = 0.0680413817439772*gxzJ_n[7]-0.06804138174397721*gxzJ_n[6]-0.06804138174397721*gxzJ_n[5]+0.06804138174397721*gxzJ_n[4]-0.06804138174397717*gxzJ_n[3]+0.06804138174397717*gxzJ_n[2]+0.06804138174397717*gxzJ_n[1]-0.06804138174397717*gxzJ_n[0]; 
// Calculate gzzJ - J/g_zz at nodes 
eps2_n[0] = gr33_n[0]*J_n[0] - J_n[0]/g33_n[0]; 
eps2_n[1] = gr33_n[1]*J_n[1] - J_n[1]/g33_n[1]; 
eps2_n[2] = gr33_n[2]*J_n[2] - J_n[2]/g33_n[2]; 
eps2_n[3] = gr33_n[3]*J_n[3] - J_n[3]/g33_n[3]; 
eps2_n[4] = gr33_n[4]*J_n[4] - J_n[4]/g33_n[4]; 
eps2_n[5] = gr33_n[5]*J_n[5] - J_n[5]/g33_n[5]; 
eps2_n[6] = gr33_n[6]*J_n[6] - J_n[6]/g33_n[6]; 
eps2_n[7] = gr33_n[7]*J_n[7] - J_n[7]/g33_n[7]; 
// Convert nodal to modal for eps2 
  eps2[0] = 0.3535533905932741*eps2_n[7]+0.353553390593274*eps2_n[6]+0.353553390593274*eps2_n[5]+0.3535533905932739*eps2_n[4]+0.3535533905932738*eps2_n[3]+0.3535533905932738*eps2_n[2]+0.3535533905932738*eps2_n[1]+0.3535533905932738*eps2_n[0]; 
  eps2[1] = 0.2041241452319316*eps2_n[7]-0.2041241452319316*eps2_n[6]+0.2041241452319317*eps2_n[5]-0.2041241452319317*eps2_n[4]+0.2041241452319315*eps2_n[3]-0.2041241452319315*eps2_n[2]+0.2041241452319315*eps2_n[1]-0.2041241452319315*eps2_n[0]; 
  eps2[2] = 0.2041241452319317*eps2_n[7]+0.2041241452319316*eps2_n[6]-0.2041241452319317*eps2_n[5]-0.2041241452319316*eps2_n[4]+0.2041241452319315*eps2_n[3]+0.2041241452319315*eps2_n[2]-0.2041241452319315*eps2_n[1]-0.2041241452319315*eps2_n[0]; 
  eps2[3] = 0.2041241452319316*eps2_n[7]+0.2041241452319316*eps2_n[6]+0.2041241452319316*eps2_n[5]+0.2041241452319316*eps2_n[4]-0.2041241452319315*eps2_n[3]-0.2041241452319315*eps2_n[2]-0.2041241452319315*eps2_n[1]-0.2041241452319315*eps2_n[0]; 
  eps2[4] = 0.117851130197758*eps2_n[7]-0.117851130197758*eps2_n[6]-0.117851130197758*eps2_n[5]+0.117851130197758*eps2_n[4]+0.1178511301977579*eps2_n[3]-0.1178511301977579*eps2_n[2]-0.1178511301977579*eps2_n[1]+0.1178511301977579*eps2_n[0]; 
  eps2[5] = 0.117851130197758*eps2_n[7]-0.117851130197758*eps2_n[6]+0.117851130197758*eps2_n[5]-0.117851130197758*eps2_n[4]-0.1178511301977579*eps2_n[3]+0.1178511301977579*eps2_n[2]-0.1178511301977579*eps2_n[1]+0.1178511301977579*eps2_n[0]; 
  eps2[6] = 0.1178511301977579*eps2_n[7]+0.117851130197758*eps2_n[6]-0.117851130197758*eps2_n[5]-0.117851130197758*eps2_n[4]-0.1178511301977579*eps2_n[3]-0.1178511301977579*eps2_n[2]+0.1178511301977579*eps2_n[1]+0.1178511301977579*eps2_n[0]; 
  eps2[7] = 0.0680413817439772*eps2_n[7]-0.06804138174397721*eps2_n[6]-0.06804138174397721*eps2_n[5]+0.06804138174397721*eps2_n[4]-0.06804138174397717*eps2_n[3]+0.06804138174397717*eps2_n[2]+0.06804138174397717*eps2_n[1]-0.06804138174397717*eps2_n[0]; 
 
}
GKYL_CU_DH void derived_geo_quad_3x_Ser_p1(const double *gij, const double *bmag, double *J, double *Jinv, double *grij, double *bi, double *cmag, double *Jtot, double *Jtotinv, double *gxxJ, double *gxyJ, double *gyyJ, double *gxzJ, double *eps2) 
{ 
const double *g11  = &gij[0 * 8];
const double *g12  = &gij[1 * 8];
const double *g13  = &gij[2 * 8];
const double *g22  = &gij[3 * 8];
const double *g23  = &gij[4 * 8];
const double *g33  = &gij[5 * 8];
double *gr11  = &grij[0 * 8];
double *gr12  = &grij[1 * 8];
double *gr13  = &grij[2 * 8];
double *gr22  = &grij[3 * 8];
double *gr23  = &grij[4 * 8];
double *gr33  = &grij[5 * 8];
double *b1  = &bi[0 * 8];
double *b2  = &bi[1 * 8];
double *b3  = &bi[2 * 8];
double b1_n[8]; 
double g11_n[8]; 
double gr11_n[8]; 
double g12_n[8]; 
double gr12_n[8]; 
double g13_n[8]; 
double gr13_n[8]; 
double b2_n[8]; 
double g22_n[8]; 
double gr22_n[8]; 
double g23_n[8]; 
double gr23_n[8]; 
double b3_n[8]; 
double g33_n[8]; 
double gr33_n[8]; 
double Jsq_n[8]; 
double J_n[8]; 
double Jinv_n[8]; 
double bmag_n[8]; 
double cmag_n[8]; 
double Jtot_n[8]; 
double Jtotinv_n[8]; 
double bmaginv_n[8]; 
double bmaginvsq_n[8]; 
double gxxJ_n[8]; 
double gxyJ_n[8]; 
double gyyJ_n[8]; 
double gxzJ_n[8]; 
double eps2_n[8]; 
double *g21_n = g12_n; 
double *g31_n = g13_n; 
double *g32_n = g23_n; 
// Calculate g_ij at nodes 
 g11_n[0] = (-0.3535533905932737*g11[7])+0.3535533905932737*g11[6]+0.3535533905932737*g11[5]+0.3535533905932737*g11[4]-0.3535533905932737*g11[3]-0.3535533905932737*g11[2]-0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[1] = 0.3535533905932737*g11[7]-0.3535533905932737*g11[6]-0.3535533905932737*g11[5]+0.3535533905932737*g11[4]+0.3535533905932737*g11[3]-0.3535533905932737*g11[2]-0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[2] = 0.3535533905932737*g11[7]-0.3535533905932737*g11[6]+0.3535533905932737*g11[5]-0.3535533905932737*g11[4]-0.3535533905932737*g11[3]+0.3535533905932737*g11[2]-0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[3] = (-0.3535533905932737*g11[7])+0.3535533905932737*g11[6]-0.3535533905932737*g11[5]-0.3535533905932737*g11[4]+0.3535533905932737*g11[3]+0.3535533905932737*g11[2]-0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[4] = 0.3535533905932737*g11[7]+0.3535533905932737*g11[6]-0.3535533905932737*g11[5]-0.3535533905932737*g11[4]-0.3535533905932737*g11[3]-0.3535533905932737*g11[2]+0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[5] = (-0.3535533905932737*g11[7])-0.3535533905932737*g11[6]+0.3535533905932737*g11[5]-0.3535533905932737*g11[4]+0.3535533905932737*g11[3]-0.3535533905932737*g11[2]+0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[6] = (-0.3535533905932737*g11[7])-0.3535533905932737*g11[6]-0.3535533905932737*g11[5]+0.3535533905932737*g11[4]-0.3535533905932737*g11[3]+0.3535533905932737*g11[2]+0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g11_n[7] = 0.3535533905932737*g11[7]+0.3535533905932737*g11[6]+0.3535533905932737*g11[5]+0.3535533905932737*g11[4]+0.3535533905932737*g11[3]+0.3535533905932737*g11[2]+0.3535533905932737*g11[1]+0.3535533905932737*g11[0]; 
 g12_n[0] = (-0.3535533905932737*g12[7])+0.3535533905932737*g12[6]+0.3535533905932737*g12[5]+0.3535533905932737*g12[4]-0.3535533905932737*g12[3]-0.3535533905932737*g12[2]-0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[1] = 0.3535533905932737*g12[7]-0.3535533905932737*g12[6]-0.3535533905932737*g12[5]+0.3535533905932737*g12[4]+0.3535533905932737*g12[3]-0.3535533905932737*g12[2]-0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[2] = 0.3535533905932737*g12[7]-0.3535533905932737*g12[6]+0.3535533905932737*g12[5]-0.3535533905932737*g12[4]-0.3535533905932737*g12[3]+0.3535533905932737*g12[2]-0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[3] = (-0.3535533905932737*g12[7])+0.3535533905932737*g12[6]-0.3535533905932737*g12[5]-0.3535533905932737*g12[4]+0.3535533905932737*g12[3]+0.3535533905932737*g12[2]-0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[4] = 0.3535533905932737*g12[7]+0.3535533905932737*g12[6]-0.3535533905932737*g12[5]-0.3535533905932737*g12[4]-0.3535533905932737*g12[3]-0.3535533905932737*g12[2]+0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[5] = (-0.3535533905932737*g12[7])-0.3535533905932737*g12[6]+0.3535533905932737*g12[5]-0.3535533905932737*g12[4]+0.3535533905932737*g12[3]-0.3535533905932737*g12[2]+0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[6] = (-0.3535533905932737*g12[7])-0.3535533905932737*g12[6]-0.3535533905932737*g12[5]+0.3535533905932737*g12[4]-0.3535533905932737*g12[3]+0.3535533905932737*g12[2]+0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g12_n[7] = 0.3535533905932737*g12[7]+0.3535533905932737*g12[6]+0.3535533905932737*g12[5]+0.3535533905932737*g12[4]+0.3535533905932737*g12[3]+0.3535533905932737*g12[2]+0.3535533905932737*g12[1]+0.3535533905932737*g12[0]; 
 g13_n[0] = (-0.3535533905932737*g13[7])+0.3535533905932737*g13[6]+0.3535533905932737*g13[5]+0.3535533905932737*g13[4]-0.3535533905932737*g13[3]-0.3535533905932737*g13[2]-0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[1] = 0.3535533905932737*g13[7]-0.3535533905932737*g13[6]-0.3535533905932737*g13[5]+0.3535533905932737*g13[4]+0.3535533905932737*g13[3]-0.3535533905932737*g13[2]-0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[2] = 0.3535533905932737*g13[7]-0.3535533905932737*g13[6]+0.3535533905932737*g13[5]-0.3535533905932737*g13[4]-0.3535533905932737*g13[3]+0.3535533905932737*g13[2]-0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[3] = (-0.3535533905932737*g13[7])+0.3535533905932737*g13[6]-0.3535533905932737*g13[5]-0.3535533905932737*g13[4]+0.3535533905932737*g13[3]+0.3535533905932737*g13[2]-0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[4] = 0.3535533905932737*g13[7]+0.3535533905932737*g13[6]-0.3535533905932737*g13[5]-0.3535533905932737*g13[4]-0.3535533905932737*g13[3]-0.3535533905932737*g13[2]+0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[5] = (-0.3535533905932737*g13[7])-0.3535533905932737*g13[6]+0.3535533905932737*g13[5]-0.3535533905932737*g13[4]+0.3535533905932737*g13[3]-0.3535533905932737*g13[2]+0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[6] = (-0.3535533905932737*g13[7])-0.3535533905932737*g13[6]-0.3535533905932737*g13[5]+0.3535533905932737*g13[4]-0.3535533905932737*g13[3]+0.3535533905932737*g13[2]+0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g13_n[7] = 0.3535533905932737*g13[7]+0.3535533905932737*g13[6]+0.3535533905932737*g13[5]+0.3535533905932737*g13[4]+0.3535533905932737*g13[3]+0.3535533905932737*g13[2]+0.3535533905932737*g13[1]+0.3535533905932737*g13[0]; 
 g22_n[0] = (-0.3535533905932737*g22[7])+0.3535533905932737*g22[6]+0.3535533905932737*g22[5]+0.3535533905932737*g22[4]-0.3535533905932737*g22[3]-0.3535533905932737*g22[2]-0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[1] = 0.3535533905932737*g22[7]-0.3535533905932737*g22[6]-0.3535533905932737*g22[5]+0.3535533905932737*g22[4]+0.3535533905932737*g22[3]-0.3535533905932737*g22[2]-0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[2] = 0.3535533905932737*g22[7]-0.3535533905932737*g22[6]+0.3535533905932737*g22[5]-0.3535533905932737*g22[4]-0.3535533905932737*g22[3]+0.3535533905932737*g22[2]-0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[3] = (-0.3535533905932737*g22[7])+0.3535533905932737*g22[6]-0.3535533905932737*g22[5]-0.3535533905932737*g22[4]+0.3535533905932737*g22[3]+0.3535533905932737*g22[2]-0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[4] = 0.3535533905932737*g22[7]+0.3535533905932737*g22[6]-0.3535533905932737*g22[5]-0.3535533905932737*g22[4]-0.3535533905932737*g22[3]-0.3535533905932737*g22[2]+0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[5] = (-0.3535533905932737*g22[7])-0.3535533905932737*g22[6]+0.3535533905932737*g22[5]-0.3535533905932737*g22[4]+0.3535533905932737*g22[3]-0.3535533905932737*g22[2]+0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[6] = (-0.3535533905932737*g22[7])-0.3535533905932737*g22[6]-0.3535533905932737*g22[5]+0.3535533905932737*g22[4]-0.3535533905932737*g22[3]+0.3535533905932737*g22[2]+0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g22_n[7] = 0.3535533905932737*g22[7]+0.3535533905932737*g22[6]+0.3535533905932737*g22[5]+0.3535533905932737*g22[4]+0.3535533905932737*g22[3]+0.3535533905932737*g22[2]+0.3535533905932737*g22[1]+0.3535533905932737*g22[0]; 
 g23_n[0] = (-0.3535533905932737*g23[7])+0.3535533905932737*g23[6]+0.3535533905932737*g23[5]+0.3535533905932737*g23[4]-0.3535533905932737*g23[3]-0.3535533905932737*g23[2]-0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[1] = 0.3535533905932737*g23[7]-0.3535533905932737*g23[6]-0.3535533905932737*g23[5]+0.3535533905932737*g23[4]+0.3535533905932737*g23[3]-0.3535533905932737*g23[2]-0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[2] = 0.3535533905932737*g23[7]-0.3535533905932737*g23[6]+0.3535533905932737*g23[5]-0.3535533905932737*g23[4]-0.3535533905932737*g23[3]+0.3535533905932737*g23[2]-0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[3] = (-0.3535533905932737*g23[7])+0.3535533905932737*g23[6]-0.3535533905932737*g23[5]-0.3535533905932737*g23[4]+0.3535533905932737*g23[3]+0.3535533905932737*g23[2]-0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[4] = 0.3535533905932737*g23[7]+0.3535533905932737*g23[6]-0.3535533905932737*g23[5]-0.3535533905932737*g23[4]-0.3535533905932737*g23[3]-0.3535533905932737*g23[2]+0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[5] = (-0.3535533905932737*g23[7])-0.3535533905932737*g23[6]+0.3535533905932737*g23[5]-0.3535533905932737*g23[4]+0.3535533905932737*g23[3]-0.3535533905932737*g23[2]+0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[6] = (-0.3535533905932737*g23[7])-0.3535533905932737*g23[6]-0.3535533905932737*g23[5]+0.3535533905932737*g23[4]-0.3535533905932737*g23[3]+0.3535533905932737*g23[2]+0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g23_n[7] = 0.3535533905932737*g23[7]+0.3535533905932737*g23[6]+0.3535533905932737*g23[5]+0.3535533905932737*g23[4]+0.3535533905932737*g23[3]+0.3535533905932737*g23[2]+0.3535533905932737*g23[1]+0.3535533905932737*g23[0]; 
 g33_n[0] = (-0.3535533905932737*g33[7])+0.3535533905932737*g33[6]+0.3535533905932737*g33[5]+0.3535533905932737*g33[4]-0.3535533905932737*g33[3]-0.3535533905932737*g33[2]-0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[1] = 0.3535533905932737*g33[7]-0.3535533905932737*g33[6]-0.3535533905932737*g33[5]+0.3535533905932737*g33[4]+0.3535533905932737*g33[3]-0.3535533905932737*g33[2]-0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[2] = 0.3535533905932737*g33[7]-0.3535533905932737*g33[6]+0.3535533905932737*g33[5]-0.3535533905932737*g33[4]-0.3535533905932737*g33[3]+0.3535533905932737*g33[2]-0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[3] = (-0.3535533905932737*g33[7])+0.3535533905932737*g33[6]-0.3535533905932737*g33[5]-0.3535533905932737*g33[4]+0.3535533905932737*g33[3]+0.3535533905932737*g33[2]-0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[4] = 0.3535533905932737*g33[7]+0.3535533905932737*g33[6]-0.3535533905932737*g33[5]-0.3535533905932737*g33[4]-0.3535533905932737*g33[3]-0.3535533905932737*g33[2]+0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[5] = (-0.3535533905932737*g33[7])-0.3535533905932737*g33[6]+0.3535533905932737*g33[5]-0.3535533905932737*g33[4]+0.3535533905932737*g33[3]-0.3535533905932737*g33[2]+0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[6] = (-0.3535533905932737*g33[7])-0.3535533905932737*g33[6]-0.3535533905932737*g33[5]+0.3535533905932737*g33[4]-0.3535533905932737*g33[3]+0.3535533905932737*g33[2]+0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
 g33_n[7] = 0.3535533905932737*g33[7]+0.3535533905932737*g33[6]+0.3535533905932737*g33[5]+0.3535533905932737*g33[4]+0.3535533905932737*g33[3]+0.3535533905932737*g33[2]+0.3535533905932737*g33[1]+0.3535533905932737*g33[0]; 
// Calculate bmag at nodes 
 bmag_n[0] = (-0.3535533905932737*bmag[7])+0.3535533905932737*bmag[6]+0.3535533905932737*bmag[5]+0.3535533905932737*bmag[4]-0.3535533905932737*bmag[3]-0.3535533905932737*bmag[2]-0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[1] = 0.3535533905932737*bmag[7]-0.3535533905932737*bmag[6]-0.3535533905932737*bmag[5]+0.3535533905932737*bmag[4]+0.3535533905932737*bmag[3]-0.3535533905932737*bmag[2]-0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[2] = 0.3535533905932737*bmag[7]-0.3535533905932737*bmag[6]+0.3535533905932737*bmag[5]-0.3535533905932737*bmag[4]-0.3535533905932737*bmag[3]+0.3535533905932737*bmag[2]-0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[3] = (-0.3535533905932737*bmag[7])+0.3535533905932737*bmag[6]-0.3535533905932737*bmag[5]-0.3535533905932737*bmag[4]+0.3535533905932737*bmag[3]+0.3535533905932737*bmag[2]-0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[4] = 0.3535533905932737*bmag[7]+0.3535533905932737*bmag[6]-0.3535533905932737*bmag[5]-0.3535533905932737*bmag[4]-0.3535533905932737*bmag[3]-0.3535533905932737*bmag[2]+0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[5] = (-0.3535533905932737*bmag[7])-0.3535533905932737*bmag[6]+0.3535533905932737*bmag[5]-0.3535533905932737*bmag[4]+0.3535533905932737*bmag[3]-0.3535533905932737*bmag[2]+0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[6] = (-0.3535533905932737*bmag[7])-0.3535533905932737*bmag[6]-0.3535533905932737*bmag[5]+0.3535533905932737*bmag[4]-0.3535533905932737*bmag[3]+0.3535533905932737*bmag[2]+0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
 bmag_n[7] = 0.3535533905932737*bmag[7]+0.3535533905932737*bmag[6]+0.3535533905932737*bmag[5]+0.3535533905932737*bmag[4]+0.3535533905932737*bmag[3]+0.3535533905932737*bmag[2]+0.3535533905932737*bmag[1]+0.3535533905932737*bmag[0]; 
// Calculate Jsq at nodes 
  Jsq_n[0] = g11_n[0]*(g22_n[0]*g33_n[0]-1.0*g23_n[0]*g32_n[0])-1.0*g12_n[0]*(g21_n[0]*g33_n[0]-1.0*g23_n[0]*g31_n[0])+g13_n[0]*(g21_n[0]*g32_n[0]-1.0*g22_n[0]*g31_n[0]); 
  Jsq_n[1] = g11_n[1]*(g22_n[1]*g33_n[1]-1.0*g23_n[1]*g32_n[1])-1.0*g12_n[1]*(g21_n[1]*g33_n[1]-1.0*g23_n[1]*g31_n[1])+g13_n[1]*(g21_n[1]*g32_n[1]-1.0*g22_n[1]*g31_n[1]); 
  Jsq_n[2] = g11_n[2]*(g22_n[2]*g33_n[2]-1.0*g23_n[2]*g32_n[2])-1.0*g12_n[2]*(g21_n[2]*g33_n[2]-1.0*g23_n[2]*g31_n[2])+g13_n[2]*(g21_n[2]*g32_n[2]-1.0*g22_n[2]*g31_n[2]); 
  Jsq_n[3] = g11_n[3]*(g22_n[3]*g33_n[3]-1.0*g23_n[3]*g32_n[3])-1.0*g12_n[3]*(g21_n[3]*g33_n[3]-1.0*g23_n[3]*g31_n[3])+g13_n[3]*(g21_n[3]*g32_n[3]-1.0*g22_n[3]*g31_n[3]); 
  Jsq_n[4] = g11_n[4]*(g22_n[4]*g33_n[4]-1.0*g23_n[4]*g32_n[4])-1.0*g12_n[4]*(g21_n[4]*g33_n[4]-1.0*g23_n[4]*g31_n[4])+g13_n[4]*(g21_n[4]*g32_n[4]-1.0*g22_n[4]*g31_n[4]); 
  Jsq_n[5] = g11_n[5]*(g22_n[5]*g33_n[5]-1.0*g23_n[5]*g32_n[5])-1.0*g12_n[5]*(g21_n[5]*g33_n[5]-1.0*g23_n[5]*g31_n[5])+g13_n[5]*(g21_n[5]*g32_n[5]-1.0*g22_n[5]*g31_n[5]); 
  Jsq_n[6] = g11_n[6]*(g22_n[6]*g33_n[6]-1.0*g23_n[6]*g32_n[6])-1.0*g12_n[6]*(g21_n[6]*g33_n[6]-1.0*g23_n[6]*g31_n[6])+g13_n[6]*(g21_n[6]*g32_n[6]-1.0*g22_n[6]*g31_n[6]); 
  Jsq_n[7] = g11_n[7]*(g22_n[7]*g33_n[7]-1.0*g23_n[7]*g32_n[7])-1.0*g12_n[7]*(g21_n[7]*g33_n[7]-1.0*g23_n[7]*g31_n[7])+g13_n[7]*(g21_n[7]*g32_n[7]-1.0*g22_n[7]*g31_n[7]); 
// Jsq at nodes cannot be less than 0 
for (int k=0; k<8; k++){ Jsq_n[k] =fmax(Jsq_n[k],0); } 
// Take the square root to get J at nodes 
J_n[0] = sqrt(Jsq_n[0]); 
J_n[1] = sqrt(Jsq_n[1]); 
J_n[2] = sqrt(Jsq_n[2]); 
J_n[3] = sqrt(Jsq_n[3]); 
J_n[4] = sqrt(Jsq_n[4]); 
J_n[5] = sqrt(Jsq_n[5]); 
J_n[6] = sqrt(Jsq_n[6]); 
J_n[7] = sqrt(Jsq_n[7]); 
// Convert nodal to modal for J 
  J[0] = 0.3535533905932737*J_n[7]+0.3535533905932737*J_n[6]+0.3535533905932737*J_n[5]+0.3535533905932737*J_n[4]+0.3535533905932737*J_n[3]+0.3535533905932737*J_n[2]+0.3535533905932737*J_n[1]+0.3535533905932737*J_n[0]; 
  J[1] = 0.3535533905932737*J_n[7]+0.3535533905932737*J_n[6]+0.3535533905932737*J_n[5]+0.3535533905932737*J_n[4]-0.3535533905932737*J_n[3]-0.3535533905932737*J_n[2]-0.3535533905932737*J_n[1]-0.3535533905932737*J_n[0]; 
  J[2] = 0.3535533905932737*J_n[7]+0.3535533905932737*J_n[6]-0.3535533905932737*J_n[5]-0.3535533905932737*J_n[4]+0.3535533905932737*J_n[3]+0.3535533905932737*J_n[2]-0.3535533905932737*J_n[1]-0.3535533905932737*J_n[0]; 
  J[3] = 0.3535533905932737*J_n[7]-0.3535533905932737*J_n[6]+0.3535533905932737*J_n[5]-0.3535533905932737*J_n[4]+0.3535533905932737*J_n[3]-0.3535533905932737*J_n[2]+0.3535533905932737*J_n[1]-0.3535533905932737*J_n[0]; 
  J[4] = 0.3535533905932737*J_n[7]+0.3535533905932737*J_n[6]-0.3535533905932737*J_n[5]-0.3535533905932737*J_n[4]-0.3535533905932737*J_n[3]-0.3535533905932737*J_n[2]+0.3535533905932737*J_n[1]+0.3535533905932737*J_n[0]; 
  J[5] = 0.3535533905932737*J_n[7]-0.3535533905932737*J_n[6]+0.3535533905932737*J_n[5]-0.3535533905932737*J_n[4]-0.3535533905932737*J_n[3]+0.3535533905932737*J_n[2]-0.3535533905932737*J_n[1]+0.3535533905932737*J_n[0]; 
  J[6] = 0.3535533905932737*J_n[7]-0.3535533905932737*J_n[6]-0.3535533905932737*J_n[5]+0.3535533905932737*J_n[4]+0.3535533905932737*J_n[3]-0.3535533905932737*J_n[2]-0.3535533905932737*J_n[1]+0.3535533905932737*J_n[0]; 
  J[7] = 0.3535533905932737*J_n[7]-0.3535533905932737*J_n[6]-0.3535533905932737*J_n[5]+0.3535533905932737*J_n[4]-0.3535533905932737*J_n[3]+0.3535533905932737*J_n[2]+0.3535533905932737*J_n[1]-0.3535533905932737*J_n[0]; 
// Calculate Jinv at nodes 
Jinv_n[0] = 1.0/J_n[0]; 
Jinv_n[1] = 1.0/J_n[1]; 
Jinv_n[2] = 1.0/J_n[2]; 
Jinv_n[3] = 1.0/J_n[3]; 
Jinv_n[4] = 1.0/J_n[4]; 
Jinv_n[5] = 1.0/J_n[5]; 
Jinv_n[6] = 1.0/J_n[6]; 
Jinv_n[7] = 1.0/J_n[7]; 
// Convert nodal to modal for Jinv 
  Jinv[0] = 0.3535533905932737*Jinv_n[7]+0.3535533905932737*Jinv_n[6]+0.3535533905932737*Jinv_n[5]+0.3535533905932737*Jinv_n[4]+0.3535533905932737*Jinv_n[3]+0.3535533905932737*Jinv_n[2]+0.3535533905932737*Jinv_n[1]+0.3535533905932737*Jinv_n[0]; 
  Jinv[1] = 0.3535533905932737*Jinv_n[7]+0.3535533905932737*Jinv_n[6]+0.3535533905932737*Jinv_n[5]+0.3535533905932737*Jinv_n[4]-0.3535533905932737*Jinv_n[3]-0.3535533905932737*Jinv_n[2]-0.3535533905932737*Jinv_n[1]-0.3535533905932737*Jinv_n[0]; 
  Jinv[2] = 0.3535533905932737*Jinv_n[7]+0.3535533905932737*Jinv_n[6]-0.3535533905932737*Jinv_n[5]-0.3535533905932737*Jinv_n[4]+0.3535533905932737*Jinv_n[3]+0.3535533905932737*Jinv_n[2]-0.3535533905932737*Jinv_n[1]-0.3535533905932737*Jinv_n[0]; 
  Jinv[3] = 0.3535533905932737*Jinv_n[7]-0.3535533905932737*Jinv_n[6]+0.3535533905932737*Jinv_n[5]-0.3535533905932737*Jinv_n[4]+0.3535533905932737*Jinv_n[3]-0.3535533905932737*Jinv_n[2]+0.3535533905932737*Jinv_n[1]-0.3535533905932737*Jinv_n[0]; 
  Jinv[4] = 0.3535533905932737*Jinv_n[7]+0.3535533905932737*Jinv_n[6]-0.3535533905932737*Jinv_n[5]-0.3535533905932737*Jinv_n[4]-0.3535533905932737*Jinv_n[3]-0.3535533905932737*Jinv_n[2]+0.3535533905932737*Jinv_n[1]+0.3535533905932737*Jinv_n[0]; 
  Jinv[5] = 0.3535533905932737*Jinv_n[7]-0.3535533905932737*Jinv_n[6]+0.3535533905932737*Jinv_n[5]-0.3535533905932737*Jinv_n[4]-0.3535533905932737*Jinv_n[3]+0.3535533905932737*Jinv_n[2]-0.3535533905932737*Jinv_n[1]+0.3535533905932737*Jinv_n[0]; 
  Jinv[6] = 0.3535533905932737*Jinv_n[7]-0.3535533905932737*Jinv_n[6]-0.3535533905932737*Jinv_n[5]+0.3535533905932737*Jinv_n[4]+0.3535533905932737*Jinv_n[3]-0.3535533905932737*Jinv_n[2]-0.3535533905932737*Jinv_n[1]+0.3535533905932737*Jinv_n[0]; 
  Jinv[7] = 0.3535533905932737*Jinv_n[7]-0.3535533905932737*Jinv_n[6]-0.3535533905932737*Jinv_n[5]+0.3535533905932737*Jinv_n[4]-0.3535533905932737*Jinv_n[3]+0.3535533905932737*Jinv_n[2]+0.3535533905932737*Jinv_n[1]-0.3535533905932737*Jinv_n[0]; 
// Calculate Jtot at nodes 
Jtot_n[0] = bmag_n[0]*J_n[0]; 
Jtot_n[1] = bmag_n[1]*J_n[1]; 
Jtot_n[2] = bmag_n[2]*J_n[2]; 
Jtot_n[3] = bmag_n[3]*J_n[3]; 
Jtot_n[4] = bmag_n[4]*J_n[4]; 
Jtot_n[5] = bmag_n[5]*J_n[5]; 
Jtot_n[6] = bmag_n[6]*J_n[6]; 
Jtot_n[7] = bmag_n[7]*J_n[7]; 
// Convert nodal to modal for Jtot 
  Jtot[0] = 0.3535533905932737*Jtot_n[7]+0.3535533905932737*Jtot_n[6]+0.3535533905932737*Jtot_n[5]+0.3535533905932737*Jtot_n[4]+0.3535533905932737*Jtot_n[3]+0.3535533905932737*Jtot_n[2]+0.3535533905932737*Jtot_n[1]+0.3535533905932737*Jtot_n[0]; 
  Jtot[1] = 0.3535533905932737*Jtot_n[7]+0.3535533905932737*Jtot_n[6]+0.3535533905932737*Jtot_n[5]+0.3535533905932737*Jtot_n[4]-0.3535533905932737*Jtot_n[3]-0.3535533905932737*Jtot_n[2]-0.3535533905932737*Jtot_n[1]-0.3535533905932737*Jtot_n[0]; 
  Jtot[2] = 0.3535533905932737*Jtot_n[7]+0.3535533905932737*Jtot_n[6]-0.3535533905932737*Jtot_n[5]-0.3535533905932737*Jtot_n[4]+0.3535533905932737*Jtot_n[3]+0.3535533905932737*Jtot_n[2]-0.3535533905932737*Jtot_n[1]-0.3535533905932737*Jtot_n[0]; 
  Jtot[3] = 0.3535533905932737*Jtot_n[7]-0.3535533905932737*Jtot_n[6]+0.3535533905932737*Jtot_n[5]-0.3535533905932737*Jtot_n[4]+0.3535533905932737*Jtot_n[3]-0.3535533905932737*Jtot_n[2]+0.3535533905932737*Jtot_n[1]-0.3535533905932737*Jtot_n[0]; 
  Jtot[4] = 0.3535533905932737*Jtot_n[7]+0.3535533905932737*Jtot_n[6]-0.3535533905932737*Jtot_n[5]-0.3535533905932737*Jtot_n[4]-0.3535533905932737*Jtot_n[3]-0.3535533905932737*Jtot_n[2]+0.3535533905932737*Jtot_n[1]+0.3535533905932737*Jtot_n[0]; 
  Jtot[5] = 0.3535533905932737*Jtot_n[7]-0.3535533905932737*Jtot_n[6]+0.3535533905932737*Jtot_n[5]-0.3535533905932737*Jtot_n[4]-0.3535533905932737*Jtot_n[3]+0.3535533905932737*Jtot_n[2]-0.3535533905932737*Jtot_n[1]+0.3535533905932737*Jtot_n[0]; 
  Jtot[6] = 0.3535533905932737*Jtot_n[7]-0.3535533905932737*Jtot_n[6]-0.3535533905932737*Jtot_n[5]+0.3535533905932737*Jtot_n[4]+0.3535533905932737*Jtot_n[3]-0.3535533905932737*Jtot_n[2]-0.3535533905932737*Jtot_n[1]+0.3535533905932737*Jtot_n[0]; 
  Jtot[7] = 0.3535533905932737*Jtot_n[7]-0.3535533905932737*Jtot_n[6]-0.3535533905932737*Jtot_n[5]+0.3535533905932737*Jtot_n[4]-0.3535533905932737*Jtot_n[3]+0.3535533905932737*Jtot_n[2]+0.3535533905932737*Jtot_n[1]-0.3535533905932737*Jtot_n[0]; 
// Calculate Jtotinv at nodes 
Jtotinv_n[0] = 1/Jtot_n[0]; 
Jtotinv_n[1] = 1/Jtot_n[1]; 
Jtotinv_n[2] = 1/Jtot_n[2]; 
Jtotinv_n[3] = 1/Jtot_n[3]; 
Jtotinv_n[4] = 1/Jtot_n[4]; 
Jtotinv_n[5] = 1/Jtot_n[5]; 
Jtotinv_n[6] = 1/Jtot_n[6]; 
Jtotinv_n[7] = 1/Jtot_n[7]; 
// Convert nodal to modal for Jtotinv 
  Jtotinv[0] = 0.3535533905932737*Jtotinv_n[7]+0.3535533905932737*Jtotinv_n[6]+0.3535533905932737*Jtotinv_n[5]+0.3535533905932737*Jtotinv_n[4]+0.3535533905932737*Jtotinv_n[3]+0.3535533905932737*Jtotinv_n[2]+0.3535533905932737*Jtotinv_n[1]+0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[1] = 0.3535533905932737*Jtotinv_n[7]+0.3535533905932737*Jtotinv_n[6]+0.3535533905932737*Jtotinv_n[5]+0.3535533905932737*Jtotinv_n[4]-0.3535533905932737*Jtotinv_n[3]-0.3535533905932737*Jtotinv_n[2]-0.3535533905932737*Jtotinv_n[1]-0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[2] = 0.3535533905932737*Jtotinv_n[7]+0.3535533905932737*Jtotinv_n[6]-0.3535533905932737*Jtotinv_n[5]-0.3535533905932737*Jtotinv_n[4]+0.3535533905932737*Jtotinv_n[3]+0.3535533905932737*Jtotinv_n[2]-0.3535533905932737*Jtotinv_n[1]-0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[3] = 0.3535533905932737*Jtotinv_n[7]-0.3535533905932737*Jtotinv_n[6]+0.3535533905932737*Jtotinv_n[5]-0.3535533905932737*Jtotinv_n[4]+0.3535533905932737*Jtotinv_n[3]-0.3535533905932737*Jtotinv_n[2]+0.3535533905932737*Jtotinv_n[1]-0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[4] = 0.3535533905932737*Jtotinv_n[7]+0.3535533905932737*Jtotinv_n[6]-0.3535533905932737*Jtotinv_n[5]-0.3535533905932737*Jtotinv_n[4]-0.3535533905932737*Jtotinv_n[3]-0.3535533905932737*Jtotinv_n[2]+0.3535533905932737*Jtotinv_n[1]+0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[5] = 0.3535533905932737*Jtotinv_n[7]-0.3535533905932737*Jtotinv_n[6]+0.3535533905932737*Jtotinv_n[5]-0.3535533905932737*Jtotinv_n[4]-0.3535533905932737*Jtotinv_n[3]+0.3535533905932737*Jtotinv_n[2]-0.3535533905932737*Jtotinv_n[1]+0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[6] = 0.3535533905932737*Jtotinv_n[7]-0.3535533905932737*Jtotinv_n[6]-0.3535533905932737*Jtotinv_n[5]+0.3535533905932737*Jtotinv_n[4]+0.3535533905932737*Jtotinv_n[3]-0.3535533905932737*Jtotinv_n[2]-0.3535533905932737*Jtotinv_n[1]+0.3535533905932737*Jtotinv_n[0]; 
  Jtotinv[7] = 0.3535533905932737*Jtotinv_n[7]-0.3535533905932737*Jtotinv_n[6]-0.3535533905932737*Jtotinv_n[5]+0.3535533905932737*Jtotinv_n[4]-0.3535533905932737*Jtotinv_n[3]+0.3535533905932737*Jtotinv_n[2]+0.3535533905932737*Jtotinv_n[1]-0.3535533905932737*Jtotinv_n[0]; 
// Calculate bmaginv at nodes 
bmaginv_n[0] = 1.0/bmag_n[0]; 
bmaginv_n[1] = 1.0/bmag_n[1]; 
bmaginv_n[2] = 1.0/bmag_n[2]; 
bmaginv_n[3] = 1.0/bmag_n[3]; 
bmaginv_n[4] = 1.0/bmag_n[4]; 
bmaginv_n[5] = 1.0/bmag_n[5]; 
bmaginv_n[6] = 1.0/bmag_n[6]; 
bmaginv_n[7] = 1.0/bmag_n[7]; 
// Calculate bmaginvsq at nodes 
bmaginvsq_n[0] = bmaginv_n[0]*bmaginv_n[0]; 
bmaginvsq_n[1] = bmaginv_n[1]*bmaginv_n[1]; 
bmaginvsq_n[2] = bmaginv_n[2]*bmaginv_n[2]; 
bmaginvsq_n[3] = bmaginv_n[3]*bmaginv_n[3]; 
bmaginvsq_n[4] = bmaginv_n[4]*bmaginv_n[4]; 
bmaginvsq_n[5] = bmaginv_n[5]*bmaginv_n[5]; 
bmaginvsq_n[6] = bmaginv_n[6]*bmaginv_n[6]; 
bmaginvsq_n[7] = bmaginv_n[7]*bmaginv_n[7]; 
// Calculate g^ij at nodes without factor of 1/det
  gr11_n[0] = g22_n[0]*g33_n[0]-1.0*g23_n[0]*g32_n[0]; 
  gr11_n[1] = g22_n[1]*g33_n[1]-1.0*g23_n[1]*g32_n[1]; 
  gr11_n[2] = g22_n[2]*g33_n[2]-1.0*g23_n[2]*g32_n[2]; 
  gr11_n[3] = g22_n[3]*g33_n[3]-1.0*g23_n[3]*g32_n[3]; 
  gr11_n[4] = g22_n[4]*g33_n[4]-1.0*g23_n[4]*g32_n[4]; 
  gr11_n[5] = g22_n[5]*g33_n[5]-1.0*g23_n[5]*g32_n[5]; 
  gr11_n[6] = g22_n[6]*g33_n[6]-1.0*g23_n[6]*g32_n[6]; 
  gr11_n[7] = g22_n[7]*g33_n[7]-1.0*g23_n[7]*g32_n[7]; 
  gr12_n[0] = g13_n[0]*g32_n[0]-1.0*g12_n[0]*g33_n[0]; 
  gr12_n[1] = g13_n[1]*g32_n[1]-1.0*g12_n[1]*g33_n[1]; 
  gr12_n[2] = g13_n[2]*g32_n[2]-1.0*g12_n[2]*g33_n[2]; 
  gr12_n[3] = g13_n[3]*g32_n[3]-1.0*g12_n[3]*g33_n[3]; 
  gr12_n[4] = g13_n[4]*g32_n[4]-1.0*g12_n[4]*g33_n[4]; 
  gr12_n[5] = g13_n[5]*g32_n[5]-1.0*g12_n[5]*g33_n[5]; 
  gr12_n[6] = g13_n[6]*g32_n[6]-1.0*g12_n[6]*g33_n[6]; 
  gr12_n[7] = g13_n[7]*g32_n[7]-1.0*g12_n[7]*g33_n[7]; 
  gr13_n[0] = g12_n[0]*g23_n[0]-1.0*g13_n[0]*g22_n[0]; 
  gr13_n[1] = g12_n[1]*g23_n[1]-1.0*g13_n[1]*g22_n[1]; 
  gr13_n[2] = g12_n[2]*g23_n[2]-1.0*g13_n[2]*g22_n[2]; 
  gr13_n[3] = g12_n[3]*g23_n[3]-1.0*g13_n[3]*g22_n[3]; 
  gr13_n[4] = g12_n[4]*g23_n[4]-1.0*g13_n[4]*g22_n[4]; 
  gr13_n[5] = g12_n[5]*g23_n[5]-1.0*g13_n[5]*g22_n[5]; 
  gr13_n[6] = g12_n[6]*g23_n[6]-1.0*g13_n[6]*g22_n[6]; 
  gr13_n[7] = g12_n[7]*g23_n[7]-1.0*g13_n[7]*g22_n[7]; 
  gr22_n[0] = g11_n[0]*g33_n[0]-1.0*g13_n[0]*g31_n[0]; 
  gr22_n[1] = g11_n[1]*g33_n[1]-1.0*g13_n[1]*g31_n[1]; 
  gr22_n[2] = g11_n[2]*g33_n[2]-1.0*g13_n[2]*g31_n[2]; 
  gr22_n[3] = g11_n[3]*g33_n[3]-1.0*g13_n[3]*g31_n[3]; 
  gr22_n[4] = g11_n[4]*g33_n[4]-1.0*g13_n[4]*g31_n[4]; 
  gr22_n[5] = g11_n[5]*g33_n[5]-1.0*g13_n[5]*g31_n[5]; 
  gr22_n[6] = g11_n[6]*g33_n[6]-1.0*g13_n[6]*g31_n[6]; 
  gr22_n[7] = g11_n[7]*g33_n[7]-1.0*g13_n[7]*g31_n[7]; 
  gr23_n[0] = g13_n[0]*g21_n[0]-1.0*g11_n[0]*g23_n[0]; 
  gr23_n[1] = g13_n[1]*g21_n[1]-1.0*g11_n[1]*g23_n[1]; 
  gr23_n[2] = g13_n[2]*g21_n[2]-1.0*g11_n[2]*g23_n[2]; 
  gr23_n[3] = g13_n[3]*g21_n[3]-1.0*g11_n[3]*g23_n[3]; 
  gr23_n[4] = g13_n[4]*g21_n[4]-1.0*g11_n[4]*g23_n[4]; 
  gr23_n[5] = g13_n[5]*g21_n[5]-1.0*g11_n[5]*g23_n[5]; 
  gr23_n[6] = g13_n[6]*g21_n[6]-1.0*g11_n[6]*g23_n[6]; 
  gr23_n[7] = g13_n[7]*g21_n[7]-1.0*g11_n[7]*g23_n[7]; 
  gr33_n[0] = g11_n[0]*g22_n[0]-1.0*g12_n[0]*g21_n[0]; 
  gr33_n[1] = g11_n[1]*g22_n[1]-1.0*g12_n[1]*g21_n[1]; 
  gr33_n[2] = g11_n[2]*g22_n[2]-1.0*g12_n[2]*g21_n[2]; 
  gr33_n[3] = g11_n[3]*g22_n[3]-1.0*g12_n[3]*g21_n[3]; 
  gr33_n[4] = g11_n[4]*g22_n[4]-1.0*g12_n[4]*g21_n[4]; 
  gr33_n[5] = g11_n[5]*g22_n[5]-1.0*g12_n[5]*g21_n[5]; 
  gr33_n[6] = g11_n[6]*g22_n[6]-1.0*g12_n[6]*g21_n[6]; 
  gr33_n[7] = g11_n[7]*g22_n[7]-1.0*g12_n[7]*g21_n[7]; 
// multiply by 1/det
gr11_n[0] = gr11_n[0]/Jsq_n[0]; 
gr11_n[1] = gr11_n[1]/Jsq_n[1]; 
gr11_n[2] = gr11_n[2]/Jsq_n[2]; 
gr11_n[3] = gr11_n[3]/Jsq_n[3]; 
gr11_n[4] = gr11_n[4]/Jsq_n[4]; 
gr11_n[5] = gr11_n[5]/Jsq_n[5]; 
gr11_n[6] = gr11_n[6]/Jsq_n[6]; 
gr11_n[7] = gr11_n[7]/Jsq_n[7]; 
gr12_n[0] = gr12_n[0]/Jsq_n[0]; 
gr12_n[1] = gr12_n[1]/Jsq_n[1]; 
gr12_n[2] = gr12_n[2]/Jsq_n[2]; 
gr12_n[3] = gr12_n[3]/Jsq_n[3]; 
gr12_n[4] = gr12_n[4]/Jsq_n[4]; 
gr12_n[5] = gr12_n[5]/Jsq_n[5]; 
gr12_n[6] = gr12_n[6]/Jsq_n[6]; 
gr12_n[7] = gr12_n[7]/Jsq_n[7]; 
gr13_n[0] = gr13_n[0]/Jsq_n[0]; 
gr13_n[1] = gr13_n[1]/Jsq_n[1]; 
gr13_n[2] = gr13_n[2]/Jsq_n[2]; 
gr13_n[3] = gr13_n[3]/Jsq_n[3]; 
gr13_n[4] = gr13_n[4]/Jsq_n[4]; 
gr13_n[5] = gr13_n[5]/Jsq_n[5]; 
gr13_n[6] = gr13_n[6]/Jsq_n[6]; 
gr13_n[7] = gr13_n[7]/Jsq_n[7]; 
gr22_n[0] = gr22_n[0]/Jsq_n[0]; 
gr22_n[1] = gr22_n[1]/Jsq_n[1]; 
gr22_n[2] = gr22_n[2]/Jsq_n[2]; 
gr22_n[3] = gr22_n[3]/Jsq_n[3]; 
gr22_n[4] = gr22_n[4]/Jsq_n[4]; 
gr22_n[5] = gr22_n[5]/Jsq_n[5]; 
gr22_n[6] = gr22_n[6]/Jsq_n[6]; 
gr22_n[7] = gr22_n[7]/Jsq_n[7]; 
gr23_n[0] = gr23_n[0]/Jsq_n[0]; 
gr23_n[1] = gr23_n[1]/Jsq_n[1]; 
gr23_n[2] = gr23_n[2]/Jsq_n[2]; 
gr23_n[3] = gr23_n[3]/Jsq_n[3]; 
gr23_n[4] = gr23_n[4]/Jsq_n[4]; 
gr23_n[5] = gr23_n[5]/Jsq_n[5]; 
gr23_n[6] = gr23_n[6]/Jsq_n[6]; 
gr23_n[7] = gr23_n[7]/Jsq_n[7]; 
gr33_n[0] = gr33_n[0]/Jsq_n[0]; 
gr33_n[1] = gr33_n[1]/Jsq_n[1]; 
gr33_n[2] = gr33_n[2]/Jsq_n[2]; 
gr33_n[3] = gr33_n[3]/Jsq_n[3]; 
gr33_n[4] = gr33_n[4]/Jsq_n[4]; 
gr33_n[5] = gr33_n[5]/Jsq_n[5]; 
gr33_n[6] = gr33_n[6]/Jsq_n[6]; 
gr33_n[7] = gr33_n[7]/Jsq_n[7]; 
// Convert nodal to modal for g^ij 
  gr11[0] = 0.3535533905932737*gr11_n[7]+0.3535533905932737*gr11_n[6]+0.3535533905932737*gr11_n[5]+0.3535533905932737*gr11_n[4]+0.3535533905932737*gr11_n[3]+0.3535533905932737*gr11_n[2]+0.3535533905932737*gr11_n[1]+0.3535533905932737*gr11_n[0]; 
  gr11[1] = 0.3535533905932737*gr11_n[7]+0.3535533905932737*gr11_n[6]+0.3535533905932737*gr11_n[5]+0.3535533905932737*gr11_n[4]-0.3535533905932737*gr11_n[3]-0.3535533905932737*gr11_n[2]-0.3535533905932737*gr11_n[1]-0.3535533905932737*gr11_n[0]; 
  gr11[2] = 0.3535533905932737*gr11_n[7]+0.3535533905932737*gr11_n[6]-0.3535533905932737*gr11_n[5]-0.3535533905932737*gr11_n[4]+0.3535533905932737*gr11_n[3]+0.3535533905932737*gr11_n[2]-0.3535533905932737*gr11_n[1]-0.3535533905932737*gr11_n[0]; 
  gr11[3] = 0.3535533905932737*gr11_n[7]-0.3535533905932737*gr11_n[6]+0.3535533905932737*gr11_n[5]-0.3535533905932737*gr11_n[4]+0.3535533905932737*gr11_n[3]-0.3535533905932737*gr11_n[2]+0.3535533905932737*gr11_n[1]-0.3535533905932737*gr11_n[0]; 
  gr11[4] = 0.3535533905932737*gr11_n[7]+0.3535533905932737*gr11_n[6]-0.3535533905932737*gr11_n[5]-0.3535533905932737*gr11_n[4]-0.3535533905932737*gr11_n[3]-0.3535533905932737*gr11_n[2]+0.3535533905932737*gr11_n[1]+0.3535533905932737*gr11_n[0]; 
  gr11[5] = 0.3535533905932737*gr11_n[7]-0.3535533905932737*gr11_n[6]+0.3535533905932737*gr11_n[5]-0.3535533905932737*gr11_n[4]-0.3535533905932737*gr11_n[3]+0.3535533905932737*gr11_n[2]-0.3535533905932737*gr11_n[1]+0.3535533905932737*gr11_n[0]; 
  gr11[6] = 0.3535533905932737*gr11_n[7]-0.3535533905932737*gr11_n[6]-0.3535533905932737*gr11_n[5]+0.3535533905932737*gr11_n[4]+0.3535533905932737*gr11_n[3]-0.3535533905932737*gr11_n[2]-0.3535533905932737*gr11_n[1]+0.3535533905932737*gr11_n[0]; 
  gr11[7] = 0.3535533905932737*gr11_n[7]-0.3535533905932737*gr11_n[6]-0.3535533905932737*gr11_n[5]+0.3535533905932737*gr11_n[4]-0.3535533905932737*gr11_n[3]+0.3535533905932737*gr11_n[2]+0.3535533905932737*gr11_n[1]-0.3535533905932737*gr11_n[0]; 

  gr12[0] = 0.3535533905932737*gr12_n[7]+0.3535533905932737*gr12_n[6]+0.3535533905932737*gr12_n[5]+0.3535533905932737*gr12_n[4]+0.3535533905932737*gr12_n[3]+0.3535533905932737*gr12_n[2]+0.3535533905932737*gr12_n[1]+0.3535533905932737*gr12_n[0]; 
  gr12[1] = 0.3535533905932737*gr12_n[7]+0.3535533905932737*gr12_n[6]+0.3535533905932737*gr12_n[5]+0.3535533905932737*gr12_n[4]-0.3535533905932737*gr12_n[3]-0.3535533905932737*gr12_n[2]-0.3535533905932737*gr12_n[1]-0.3535533905932737*gr12_n[0]; 
  gr12[2] = 0.3535533905932737*gr12_n[7]+0.3535533905932737*gr12_n[6]-0.3535533905932737*gr12_n[5]-0.3535533905932737*gr12_n[4]+0.3535533905932737*gr12_n[3]+0.3535533905932737*gr12_n[2]-0.3535533905932737*gr12_n[1]-0.3535533905932737*gr12_n[0]; 
  gr12[3] = 0.3535533905932737*gr12_n[7]-0.3535533905932737*gr12_n[6]+0.3535533905932737*gr12_n[5]-0.3535533905932737*gr12_n[4]+0.3535533905932737*gr12_n[3]-0.3535533905932737*gr12_n[2]+0.3535533905932737*gr12_n[1]-0.3535533905932737*gr12_n[0]; 
  gr12[4] = 0.3535533905932737*gr12_n[7]+0.3535533905932737*gr12_n[6]-0.3535533905932737*gr12_n[5]-0.3535533905932737*gr12_n[4]-0.3535533905932737*gr12_n[3]-0.3535533905932737*gr12_n[2]+0.3535533905932737*gr12_n[1]+0.3535533905932737*gr12_n[0]; 
  gr12[5] = 0.3535533905932737*gr12_n[7]-0.3535533905932737*gr12_n[6]+0.3535533905932737*gr12_n[5]-0.3535533905932737*gr12_n[4]-0.3535533905932737*gr12_n[3]+0.3535533905932737*gr12_n[2]-0.3535533905932737*gr12_n[1]+0.3535533905932737*gr12_n[0]; 
  gr12[6] = 0.3535533905932737*gr12_n[7]-0.3535533905932737*gr12_n[6]-0.3535533905932737*gr12_n[5]+0.3535533905932737*gr12_n[4]+0.3535533905932737*gr12_n[3]-0.3535533905932737*gr12_n[2]-0.3535533905932737*gr12_n[1]+0.3535533905932737*gr12_n[0]; 
  gr12[7] = 0.3535533905932737*gr12_n[7]-0.3535533905932737*gr12_n[6]-0.3535533905932737*gr12_n[5]+0.3535533905932737*gr12_n[4]-0.3535533905932737*gr12_n[3]+0.3535533905932737*gr12_n[2]+0.3535533905932737*gr12_n[1]-0.3535533905932737*gr12_n[0]; 

  gr13[0] = 0.3535533905932737*gr13_n[7]+0.3535533905932737*gr13_n[6]+0.3535533905932737*gr13_n[5]+0.3535533905932737*gr13_n[4]+0.3535533905932737*gr13_n[3]+0.3535533905932737*gr13_n[2]+0.3535533905932737*gr13_n[1]+0.3535533905932737*gr13_n[0]; 
  gr13[1] = 0.3535533905932737*gr13_n[7]+0.3535533905932737*gr13_n[6]+0.3535533905932737*gr13_n[5]+0.3535533905932737*gr13_n[4]-0.3535533905932737*gr13_n[3]-0.3535533905932737*gr13_n[2]-0.3535533905932737*gr13_n[1]-0.3535533905932737*gr13_n[0]; 
  gr13[2] = 0.3535533905932737*gr13_n[7]+0.3535533905932737*gr13_n[6]-0.3535533905932737*gr13_n[5]-0.3535533905932737*gr13_n[4]+0.3535533905932737*gr13_n[3]+0.3535533905932737*gr13_n[2]-0.3535533905932737*gr13_n[1]-0.3535533905932737*gr13_n[0]; 
  gr13[3] = 0.3535533905932737*gr13_n[7]-0.3535533905932737*gr13_n[6]+0.3535533905932737*gr13_n[5]-0.3535533905932737*gr13_n[4]+0.3535533905932737*gr13_n[3]-0.3535533905932737*gr13_n[2]+0.3535533905932737*gr13_n[1]-0.3535533905932737*gr13_n[0]; 
  gr13[4] = 0.3535533905932737*gr13_n[7]+0.3535533905932737*gr13_n[6]-0.3535533905932737*gr13_n[5]-0.3535533905932737*gr13_n[4]-0.3535533905932737*gr13_n[3]-0.3535533905932737*gr13_n[2]+0.3535533905932737*gr13_n[1]+0.3535533905932737*gr13_n[0]; 
  gr13[5] = 0.3535533905932737*gr13_n[7]-0.3535533905932737*gr13_n[6]+0.3535533905932737*gr13_n[5]-0.3535533905932737*gr13_n[4]-0.3535533905932737*gr13_n[3]+0.3535533905932737*gr13_n[2]-0.3535533905932737*gr13_n[1]+0.3535533905932737*gr13_n[0]; 
  gr13[6] = 0.3535533905932737*gr13_n[7]-0.3535533905932737*gr13_n[6]-0.3535533905932737*gr13_n[5]+0.3535533905932737*gr13_n[4]+0.3535533905932737*gr13_n[3]-0.3535533905932737*gr13_n[2]-0.3535533905932737*gr13_n[1]+0.3535533905932737*gr13_n[0]; 
  gr13[7] = 0.3535533905932737*gr13_n[7]-0.3535533905932737*gr13_n[6]-0.3535533905932737*gr13_n[5]+0.3535533905932737*gr13_n[4]-0.3535533905932737*gr13_n[3]+0.3535533905932737*gr13_n[2]+0.3535533905932737*gr13_n[1]-0.3535533905932737*gr13_n[0]; 

  gr22[0] = 0.3535533905932737*gr22_n[7]+0.3535533905932737*gr22_n[6]+0.3535533905932737*gr22_n[5]+0.3535533905932737*gr22_n[4]+0.3535533905932737*gr22_n[3]+0.3535533905932737*gr22_n[2]+0.3535533905932737*gr22_n[1]+0.3535533905932737*gr22_n[0]; 
  gr22[1] = 0.3535533905932737*gr22_n[7]+0.3535533905932737*gr22_n[6]+0.3535533905932737*gr22_n[5]+0.3535533905932737*gr22_n[4]-0.3535533905932737*gr22_n[3]-0.3535533905932737*gr22_n[2]-0.3535533905932737*gr22_n[1]-0.3535533905932737*gr22_n[0]; 
  gr22[2] = 0.3535533905932737*gr22_n[7]+0.3535533905932737*gr22_n[6]-0.3535533905932737*gr22_n[5]-0.3535533905932737*gr22_n[4]+0.3535533905932737*gr22_n[3]+0.3535533905932737*gr22_n[2]-0.3535533905932737*gr22_n[1]-0.3535533905932737*gr22_n[0]; 
  gr22[3] = 0.3535533905932737*gr22_n[7]-0.3535533905932737*gr22_n[6]+0.3535533905932737*gr22_n[5]-0.3535533905932737*gr22_n[4]+0.3535533905932737*gr22_n[3]-0.3535533905932737*gr22_n[2]+0.3535533905932737*gr22_n[1]-0.3535533905932737*gr22_n[0]; 
  gr22[4] = 0.3535533905932737*gr22_n[7]+0.3535533905932737*gr22_n[6]-0.3535533905932737*gr22_n[5]-0.3535533905932737*gr22_n[4]-0.3535533905932737*gr22_n[3]-0.3535533905932737*gr22_n[2]+0.3535533905932737*gr22_n[1]+0.3535533905932737*gr22_n[0]; 
  gr22[5] = 0.3535533905932737*gr22_n[7]-0.3535533905932737*gr22_n[6]+0.3535533905932737*gr22_n[5]-0.3535533905932737*gr22_n[4]-0.3535533905932737*gr22_n[3]+0.3535533905932737*gr22_n[2]-0.3535533905932737*gr22_n[1]+0.3535533905932737*gr22_n[0]; 
  gr22[6] = 0.3535533905932737*gr22_n[7]-0.3535533905932737*gr22_n[6]-0.3535533905932737*gr22_n[5]+0.3535533905932737*gr22_n[4]+0.3535533905932737*gr22_n[3]-0.3535533905932737*gr22_n[2]-0.3535533905932737*gr22_n[1]+0.3535533905932737*gr22_n[0]; 
  gr22[7] = 0.3535533905932737*gr22_n[7]-0.3535533905932737*gr22_n[6]-0.3535533905932737*gr22_n[5]+0.3535533905932737*gr22_n[4]-0.3535533905932737*gr22_n[3]+0.3535533905932737*gr22_n[2]+0.3535533905932737*gr22_n[1]-0.3535533905932737*gr22_n[0]; 

  gr23[0] = 0.3535533905932737*gr23_n[7]+0.3535533905932737*gr23_n[6]+0.3535533905932737*gr23_n[5]+0.3535533905932737*gr23_n[4]+0.3535533905932737*gr23_n[3]+0.3535533905932737*gr23_n[2]+0.3535533905932737*gr23_n[1]+0.3535533905932737*gr23_n[0]; 
  gr23[1] = 0.3535533905932737*gr23_n[7]+0.3535533905932737*gr23_n[6]+0.3535533905932737*gr23_n[5]+0.3535533905932737*gr23_n[4]-0.3535533905932737*gr23_n[3]-0.3535533905932737*gr23_n[2]-0.3535533905932737*gr23_n[1]-0.3535533905932737*gr23_n[0]; 
  gr23[2] = 0.3535533905932737*gr23_n[7]+0.3535533905932737*gr23_n[6]-0.3535533905932737*gr23_n[5]-0.3535533905932737*gr23_n[4]+0.3535533905932737*gr23_n[3]+0.3535533905932737*gr23_n[2]-0.3535533905932737*gr23_n[1]-0.3535533905932737*gr23_n[0]; 
  gr23[3] = 0.3535533905932737*gr23_n[7]-0.3535533905932737*gr23_n[6]+0.3535533905932737*gr23_n[5]-0.3535533905932737*gr23_n[4]+0.3535533905932737*gr23_n[3]-0.3535533905932737*gr23_n[2]+0.3535533905932737*gr23_n[1]-0.3535533905932737*gr23_n[0]; 
  gr23[4] = 0.3535533905932737*gr23_n[7]+0.3535533905932737*gr23_n[6]-0.3535533905932737*gr23_n[5]-0.3535533905932737*gr23_n[4]-0.3535533905932737*gr23_n[3]-0.3535533905932737*gr23_n[2]+0.3535533905932737*gr23_n[1]+0.3535533905932737*gr23_n[0]; 
  gr23[5] = 0.3535533905932737*gr23_n[7]-0.3535533905932737*gr23_n[6]+0.3535533905932737*gr23_n[5]-0.3535533905932737*gr23_n[4]-0.3535533905932737*gr23_n[3]+0.3535533905932737*gr23_n[2]-0.3535533905932737*gr23_n[1]+0.3535533905932737*gr23_n[0]; 
  gr23[6] = 0.3535533905932737*gr23_n[7]-0.3535533905932737*gr23_n[6]-0.3535533905932737*gr23_n[5]+0.3535533905932737*gr23_n[4]+0.3535533905932737*gr23_n[3]-0.3535533905932737*gr23_n[2]-0.3535533905932737*gr23_n[1]+0.3535533905932737*gr23_n[0]; 
  gr23[7] = 0.3535533905932737*gr23_n[7]-0.3535533905932737*gr23_n[6]-0.3535533905932737*gr23_n[5]+0.3535533905932737*gr23_n[4]-0.3535533905932737*gr23_n[3]+0.3535533905932737*gr23_n[2]+0.3535533905932737*gr23_n[1]-0.3535533905932737*gr23_n[0]; 

  gr33[0] = 0.3535533905932737*gr33_n[7]+0.3535533905932737*gr33_n[6]+0.3535533905932737*gr33_n[5]+0.3535533905932737*gr33_n[4]+0.3535533905932737*gr33_n[3]+0.3535533905932737*gr33_n[2]+0.3535533905932737*gr33_n[1]+0.3535533905932737*gr33_n[0]; 
  gr33[1] = 0.3535533905932737*gr33_n[7]+0.3535533905932737*gr33_n[6]+0.3535533905932737*gr33_n[5]+0.3535533905932737*gr33_n[4]-0.3535533905932737*gr33_n[3]-0.3535533905932737*gr33_n[2]-0.3535533905932737*gr33_n[1]-0.3535533905932737*gr33_n[0]; 
  gr33[2] = 0.3535533905932737*gr33_n[7]+0.3535533905932737*gr33_n[6]-0.3535533905932737*gr33_n[5]-0.3535533905932737*gr33_n[4]+0.3535533905932737*gr33_n[3]+0.3535533905932737*gr33_n[2]-0.3535533905932737*gr33_n[1]-0.3535533905932737*gr33_n[0]; 
  gr33[3] = 0.3535533905932737*gr33_n[7]-0.3535533905932737*gr33_n[6]+0.3535533905932737*gr33_n[5]-0.3535533905932737*gr33_n[4]+0.3535533905932737*gr33_n[3]-0.3535533905932737*gr33_n[2]+0.3535533905932737*gr33_n[1]-0.3535533905932737*gr33_n[0]; 
  gr33[4] = 0.3535533905932737*gr33_n[7]+0.3535533905932737*gr33_n[6]-0.3535533905932737*gr33_n[5]-0.3535533905932737*gr33_n[4]-0.3535533905932737*gr33_n[3]-0.3535533905932737*gr33_n[2]+0.3535533905932737*gr33_n[1]+0.3535533905932737*gr33_n[0]; 
  gr33[5] = 0.3535533905932737*gr33_n[7]-0.3535533905932737*gr33_n[6]+0.3535533905932737*gr33_n[5]-0.3535533905932737*gr33_n[4]-0.3535533905932737*gr33_n[3]+0.3535533905932737*gr33_n[2]-0.3535533905932737*gr33_n[1]+0.3535533905932737*gr33_n[0]; 
  gr33[6] = 0.3535533905932737*gr33_n[7]-0.3535533905932737*gr33_n[6]-0.3535533905932737*gr33_n[5]+0.3535533905932737*gr33_n[4]+0.3535533905932737*gr33_n[3]-0.3535533905932737*gr33_n[2]-0.3535533905932737*gr33_n[1]+0.3535533905932737*gr33_n[0]; 
  gr33[7] = 0.3535533905932737*gr33_n[7]-0.3535533905932737*gr33_n[6]-0.3535533905932737*gr33_n[5]+0.3535533905932737*gr33_n[4]-0.3535533905932737*gr33_n[3]+0.3535533905932737*gr33_n[2]+0.3535533905932737*gr33_n[1]-0.3535533905932737*gr33_n[0]; 

// Calculate b_i at nodes 
  b1_n[0] = g13_n[0]/sqrt(g33_n[0]); 
  b1_n[1] = g13_n[1]/sqrt(g33_n[1]); 
  b1_n[2] = g13_n[2]/sqrt(g33_n[2]); 
  b1_n[3] = g13_n[3]/sqrt(g33_n[3]); 
  b1_n[4] = g13_n[4]/sqrt(g33_n[4]); 
  b1_n[5] = g13_n[5]/sqrt(g33_n[5]); 
  b1_n[6] = g13_n[6]/sqrt(g33_n[6]); 
  b1_n[7] = g13_n[7]/sqrt(g33_n[7]); 
  b2_n[0] = g23_n[0]/sqrt(g33_n[0]); 
  b2_n[1] = g23_n[1]/sqrt(g33_n[1]); 
  b2_n[2] = g23_n[2]/sqrt(g33_n[2]); 
  b2_n[3] = g23_n[3]/sqrt(g33_n[3]); 
  b2_n[4] = g23_n[4]/sqrt(g33_n[4]); 
  b2_n[5] = g23_n[5]/sqrt(g33_n[5]); 
  b2_n[6] = g23_n[6]/sqrt(g33_n[6]); 
  b2_n[7] = g23_n[7]/sqrt(g33_n[7]); 
  b3_n[0] = sqrt(g33_n[0]); 
  b3_n[1] = sqrt(g33_n[1]); 
  b3_n[2] = sqrt(g33_n[2]); 
  b3_n[3] = sqrt(g33_n[3]); 
  b3_n[4] = sqrt(g33_n[4]); 
  b3_n[5] = sqrt(g33_n[5]); 
  b3_n[6] = sqrt(g33_n[6]); 
  b3_n[7] = sqrt(g33_n[7]); 
// Convert nodal to modal for b_i 
  b1[0] = 0.3535533905932737*b1_n[7]+0.3535533905932737*b1_n[6]+0.3535533905932737*b1_n[5]+0.3535533905932737*b1_n[4]+0.3535533905932737*b1_n[3]+0.3535533905932737*b1_n[2]+0.3535533905932737*b1_n[1]+0.3535533905932737*b1_n[0]; 
  b1[1] = 0.3535533905932737*b1_n[7]+0.3535533905932737*b1_n[6]+0.3535533905932737*b1_n[5]+0.3535533905932737*b1_n[4]-0.3535533905932737*b1_n[3]-0.3535533905932737*b1_n[2]-0.3535533905932737*b1_n[1]-0.3535533905932737*b1_n[0]; 
  b1[2] = 0.3535533905932737*b1_n[7]+0.3535533905932737*b1_n[6]-0.3535533905932737*b1_n[5]-0.3535533905932737*b1_n[4]+0.3535533905932737*b1_n[3]+0.3535533905932737*b1_n[2]-0.3535533905932737*b1_n[1]-0.3535533905932737*b1_n[0]; 
  b1[3] = 0.3535533905932737*b1_n[7]-0.3535533905932737*b1_n[6]+0.3535533905932737*b1_n[5]-0.3535533905932737*b1_n[4]+0.3535533905932737*b1_n[3]-0.3535533905932737*b1_n[2]+0.3535533905932737*b1_n[1]-0.3535533905932737*b1_n[0]; 
  b1[4] = 0.3535533905932737*b1_n[7]+0.3535533905932737*b1_n[6]-0.3535533905932737*b1_n[5]-0.3535533905932737*b1_n[4]-0.3535533905932737*b1_n[3]-0.3535533905932737*b1_n[2]+0.3535533905932737*b1_n[1]+0.3535533905932737*b1_n[0]; 
  b1[5] = 0.3535533905932737*b1_n[7]-0.3535533905932737*b1_n[6]+0.3535533905932737*b1_n[5]-0.3535533905932737*b1_n[4]-0.3535533905932737*b1_n[3]+0.3535533905932737*b1_n[2]-0.3535533905932737*b1_n[1]+0.3535533905932737*b1_n[0]; 
  b1[6] = 0.3535533905932737*b1_n[7]-0.3535533905932737*b1_n[6]-0.3535533905932737*b1_n[5]+0.3535533905932737*b1_n[4]+0.3535533905932737*b1_n[3]-0.3535533905932737*b1_n[2]-0.3535533905932737*b1_n[1]+0.3535533905932737*b1_n[0]; 
  b1[7] = 0.3535533905932737*b1_n[7]-0.3535533905932737*b1_n[6]-0.3535533905932737*b1_n[5]+0.3535533905932737*b1_n[4]-0.3535533905932737*b1_n[3]+0.3535533905932737*b1_n[2]+0.3535533905932737*b1_n[1]-0.3535533905932737*b1_n[0]; 

  b2[0] = 0.3535533905932737*b2_n[7]+0.3535533905932737*b2_n[6]+0.3535533905932737*b2_n[5]+0.3535533905932737*b2_n[4]+0.3535533905932737*b2_n[3]+0.3535533905932737*b2_n[2]+0.3535533905932737*b2_n[1]+0.3535533905932737*b2_n[0]; 
  b2[1] = 0.3535533905932737*b2_n[7]+0.3535533905932737*b2_n[6]+0.3535533905932737*b2_n[5]+0.3535533905932737*b2_n[4]-0.3535533905932737*b2_n[3]-0.3535533905932737*b2_n[2]-0.3535533905932737*b2_n[1]-0.3535533905932737*b2_n[0]; 
  b2[2] = 0.3535533905932737*b2_n[7]+0.3535533905932737*b2_n[6]-0.3535533905932737*b2_n[5]-0.3535533905932737*b2_n[4]+0.3535533905932737*b2_n[3]+0.3535533905932737*b2_n[2]-0.3535533905932737*b2_n[1]-0.3535533905932737*b2_n[0]; 
  b2[3] = 0.3535533905932737*b2_n[7]-0.3535533905932737*b2_n[6]+0.3535533905932737*b2_n[5]-0.3535533905932737*b2_n[4]+0.3535533905932737*b2_n[3]-0.3535533905932737*b2_n[2]+0.3535533905932737*b2_n[1]-0.3535533905932737*b2_n[0]; 
  b2[4] = 0.3535533905932737*b2_n[7]+0.3535533905932737*b2_n[6]-0.3535533905932737*b2_n[5]-0.3535533905932737*b2_n[4]-0.3535533905932737*b2_n[3]-0.3535533905932737*b2_n[2]+0.3535533905932737*b2_n[1]+0.3535533905932737*b2_n[0]; 
  b2[5] = 0.3535533905932737*b2_n[7]-0.3535533905932737*b2_n[6]+0.3535533905932737*b2_n[5]-0.3535533905932737*b2_n[4]-0.3535533905932737*b2_n[3]+0.3535533905932737*b2_n[2]-0.3535533905932737*b2_n[1]+0.3535533905932737*b2_n[0]; 
  b2[6] = 0.3535533905932737*b2_n[7]-0.3535533905932737*b2_n[6]-0.3535533905932737*b2_n[5]+0.3535533905932737*b2_n[4]+0.3535533905932737*b2_n[3]-0.3535533905932737*b2_n[2]-0.3535533905932737*b2_n[1]+0.3535533905932737*b2_n[0]; 
  b2[7] = 0.3535533905932737*b2_n[7]-0.3535533905932737*b2_n[6]-0.3535533905932737*b2_n[5]+0.3535533905932737*b2_n[4]-0.3535533905932737*b2_n[3]+0.3535533905932737*b2_n[2]+0.3535533905932737*b2_n[1]-0.3535533905932737*b2_n[0]; 

  b3[0] = 0.3535533905932737*b3_n[7]+0.3535533905932737*b3_n[6]+0.3535533905932737*b3_n[5]+0.3535533905932737*b3_n[4]+0.3535533905932737*b3_n[3]+0.3535533905932737*b3_n[2]+0.3535533905932737*b3_n[1]+0.3535533905932737*b3_n[0]; 
  b3[1] = 0.3535533905932737*b3_n[7]+0.3535533905932737*b3_n[6]+0.3535533905932737*b3_n[5]+0.3535533905932737*b3_n[4]-0.3535533905932737*b3_n[3]-0.3535533905932737*b3_n[2]-0.3535533905932737*b3_n[1]-0.3535533905932737*b3_n[0]; 
  b3[2] = 0.3535533905932737*b3_n[7]+0.3535533905932737*b3_n[6]-0.3535533905932737*b3_n[5]-0.3535533905932737*b3_n[4]+0.3535533905932737*b3_n[3]+0.3535533905932737*b3_n[2]-0.3535533905932737*b3_n[1]-0.3535533905932737*b3_n[0]; 
  b3[3] = 0.3535533905932737*b3_n[7]-0.3535533905932737*b3_n[6]+0.3535533905932737*b3_n[5]-0.3535533905932737*b3_n[4]+0.3535533905932737*b3_n[3]-0.3535533905932737*b3_n[2]+0.3535533905932737*b3_n[1]-0.3535533905932737*b3_n[0]; 
  b3[4] = 0.3535533905932737*b3_n[7]+0.3535533905932737*b3_n[6]-0.3535533905932737*b3_n[5]-0.3535533905932737*b3_n[4]-0.3535533905932737*b3_n[3]-0.3535533905932737*b3_n[2]+0.3535533905932737*b3_n[1]+0.3535533905932737*b3_n[0]; 
  b3[5] = 0.3535533905932737*b3_n[7]-0.3535533905932737*b3_n[6]+0.3535533905932737*b3_n[5]-0.3535533905932737*b3_n[4]-0.3535533905932737*b3_n[3]+0.3535533905932737*b3_n[2]-0.3535533905932737*b3_n[1]+0.3535533905932737*b3_n[0]; 
  b3[6] = 0.3535533905932737*b3_n[7]-0.3535533905932737*b3_n[6]-0.3535533905932737*b3_n[5]+0.3535533905932737*b3_n[4]+0.3535533905932737*b3_n[3]-0.3535533905932737*b3_n[2]-0.3535533905932737*b3_n[1]+0.3535533905932737*b3_n[0]; 
  b3[7] = 0.3535533905932737*b3_n[7]-0.3535533905932737*b3_n[6]-0.3535533905932737*b3_n[5]+0.3535533905932737*b3_n[4]-0.3535533905932737*b3_n[3]+0.3535533905932737*b3_n[2]+0.3535533905932737*b3_n[1]-0.3535533905932737*b3_n[0]; 

// Calculate cmag at nodes 
  cmag_n[0] = (J_n[0]*bmag_n[0])/sqrt(g33_n[0]); 
  cmag_n[1] = (J_n[1]*bmag_n[1])/sqrt(g33_n[1]); 
  cmag_n[2] = (J_n[2]*bmag_n[2])/sqrt(g33_n[2]); 
  cmag_n[3] = (J_n[3]*bmag_n[3])/sqrt(g33_n[3]); 
  cmag_n[4] = (J_n[4]*bmag_n[4])/sqrt(g33_n[4]); 
  cmag_n[5] = (J_n[5]*bmag_n[5])/sqrt(g33_n[5]); 
  cmag_n[6] = (J_n[6]*bmag_n[6])/sqrt(g33_n[6]); 
  cmag_n[7] = (J_n[7]*bmag_n[7])/sqrt(g33_n[7]); 
// Convert nodal to modal for cmag 
  cmag[0] = 0.3535533905932737*cmag_n[7]+0.3535533905932737*cmag_n[6]+0.3535533905932737*cmag_n[5]+0.3535533905932737*cmag_n[4]+0.3535533905932737*cmag_n[3]+0.3535533905932737*cmag_n[2]+0.3535533905932737*cmag_n[1]+0.3535533905932737*cmag_n[0]; 
  cmag[1] = 0.3535533905932737*cmag_n[7]+0.3535533905932737*cmag_n[6]+0.3535533905932737*cmag_n[5]+0.3535533905932737*cmag_n[4]-0.3535533905932737*cmag_n[3]-0.3535533905932737*cmag_n[2]-0.3535533905932737*cmag_n[1]-0.3535533905932737*cmag_n[0]; 
  cmag[2] = 0.3535533905932737*cmag_n[7]+0.3535533905932737*cmag_n[6]-0.3535533905932737*cmag_n[5]-0.3535533905932737*cmag_n[4]+0.3535533905932737*cmag_n[3]+0.3535533905932737*cmag_n[2]-0.3535533905932737*cmag_n[1]-0.3535533905932737*cmag_n[0]; 
  cmag[3] = 0.3535533905932737*cmag_n[7]-0.3535533905932737*cmag_n[6]+0.3535533905932737*cmag_n[5]-0.3535533905932737*cmag_n[4]+0.3535533905932737*cmag_n[3]-0.3535533905932737*cmag_n[2]+0.3535533905932737*cmag_n[1]-0.3535533905932737*cmag_n[0]; 
  cmag[4] = 0.3535533905932737*cmag_n[7]+0.3535533905932737*cmag_n[6]-0.3535533905932737*cmag_n[5]-0.3535533905932737*cmag_n[4]-0.3535533905932737*cmag_n[3]-0.3535533905932737*cmag_n[2]+0.3535533905932737*cmag_n[1]+0.3535533905932737*cmag_n[0]; 
  cmag[5] = 0.3535533905932737*cmag_n[7]-0.3535533905932737*cmag_n[6]+0.3535533905932737*cmag_n[5]-0.3535533905932737*cmag_n[4]-0.3535533905932737*cmag_n[3]+0.3535533905932737*cmag_n[2]-0.3535533905932737*cmag_n[1]+0.3535533905932737*cmag_n[0]; 
  cmag[6] = 0.3535533905932737*cmag_n[7]-0.3535533905932737*cmag_n[6]-0.3535533905932737*cmag_n[5]+0.3535533905932737*cmag_n[4]+0.3535533905932737*cmag_n[3]-0.3535533905932737*cmag_n[2]-0.3535533905932737*cmag_n[1]+0.3535533905932737*cmag_n[0]; 
  cmag[7] = 0.3535533905932737*cmag_n[7]-0.3535533905932737*cmag_n[6]-0.3535533905932737*cmag_n[5]+0.3535533905932737*cmag_n[4]-0.3535533905932737*cmag_n[3]+0.3535533905932737*cmag_n[2]+0.3535533905932737*cmag_n[1]-0.3535533905932737*cmag_n[0]; 
// Calculate gxxJ at nodes 
gxxJ_n[0] = gr11_n[0]*J_n[0]; 
gxxJ_n[1] = gr11_n[1]*J_n[1]; 
gxxJ_n[2] = gr11_n[2]*J_n[2]; 
gxxJ_n[3] = gr11_n[3]*J_n[3]; 
gxxJ_n[4] = gr11_n[4]*J_n[4]; 
gxxJ_n[5] = gr11_n[5]*J_n[5]; 
gxxJ_n[6] = gr11_n[6]*J_n[6]; 
gxxJ_n[7] = gr11_n[7]*J_n[7]; 
// Convert nodal to modal for gxxJ 
  gxxJ[0] = 0.3535533905932737*gxxJ_n[7]+0.3535533905932737*gxxJ_n[6]+0.3535533905932737*gxxJ_n[5]+0.3535533905932737*gxxJ_n[4]+0.3535533905932737*gxxJ_n[3]+0.3535533905932737*gxxJ_n[2]+0.3535533905932737*gxxJ_n[1]+0.3535533905932737*gxxJ_n[0]; 
  gxxJ[1] = 0.3535533905932737*gxxJ_n[7]+0.3535533905932737*gxxJ_n[6]+0.3535533905932737*gxxJ_n[5]+0.3535533905932737*gxxJ_n[4]-0.3535533905932737*gxxJ_n[3]-0.3535533905932737*gxxJ_n[2]-0.3535533905932737*gxxJ_n[1]-0.3535533905932737*gxxJ_n[0]; 
  gxxJ[2] = 0.3535533905932737*gxxJ_n[7]+0.3535533905932737*gxxJ_n[6]-0.3535533905932737*gxxJ_n[5]-0.3535533905932737*gxxJ_n[4]+0.3535533905932737*gxxJ_n[3]+0.3535533905932737*gxxJ_n[2]-0.3535533905932737*gxxJ_n[1]-0.3535533905932737*gxxJ_n[0]; 
  gxxJ[3] = 0.3535533905932737*gxxJ_n[7]-0.3535533905932737*gxxJ_n[6]+0.3535533905932737*gxxJ_n[5]-0.3535533905932737*gxxJ_n[4]+0.3535533905932737*gxxJ_n[3]-0.3535533905932737*gxxJ_n[2]+0.3535533905932737*gxxJ_n[1]-0.3535533905932737*gxxJ_n[0]; 
  gxxJ[4] = 0.3535533905932737*gxxJ_n[7]+0.3535533905932737*gxxJ_n[6]-0.3535533905932737*gxxJ_n[5]-0.3535533905932737*gxxJ_n[4]-0.3535533905932737*gxxJ_n[3]-0.3535533905932737*gxxJ_n[2]+0.3535533905932737*gxxJ_n[1]+0.3535533905932737*gxxJ_n[0]; 
  gxxJ[5] = 0.3535533905932737*gxxJ_n[7]-0.3535533905932737*gxxJ_n[6]+0.3535533905932737*gxxJ_n[5]-0.3535533905932737*gxxJ_n[4]-0.3535533905932737*gxxJ_n[3]+0.3535533905932737*gxxJ_n[2]-0.3535533905932737*gxxJ_n[1]+0.3535533905932737*gxxJ_n[0]; 
  gxxJ[6] = 0.3535533905932737*gxxJ_n[7]-0.3535533905932737*gxxJ_n[6]-0.3535533905932737*gxxJ_n[5]+0.3535533905932737*gxxJ_n[4]+0.3535533905932737*gxxJ_n[3]-0.3535533905932737*gxxJ_n[2]-0.3535533905932737*gxxJ_n[1]+0.3535533905932737*gxxJ_n[0]; 
  gxxJ[7] = 0.3535533905932737*gxxJ_n[7]-0.3535533905932737*gxxJ_n[6]-0.3535533905932737*gxxJ_n[5]+0.3535533905932737*gxxJ_n[4]-0.3535533905932737*gxxJ_n[3]+0.3535533905932737*gxxJ_n[2]+0.3535533905932737*gxxJ_n[1]-0.3535533905932737*gxxJ_n[0]; 
// Calculate gxyJ at nodes 
gxyJ_n[0] = gr12_n[0]*J_n[0]; 
gxyJ_n[1] = gr12_n[1]*J_n[1]; 
gxyJ_n[2] = gr12_n[2]*J_n[2]; 
gxyJ_n[3] = gr12_n[3]*J_n[3]; 
gxyJ_n[4] = gr12_n[4]*J_n[4]; 
gxyJ_n[5] = gr12_n[5]*J_n[5]; 
gxyJ_n[6] = gr12_n[6]*J_n[6]; 
gxyJ_n[7] = gr12_n[7]*J_n[7]; 
// Convert nodal to modal for gxyJ 
  gxyJ[0] = 0.3535533905932737*gxyJ_n[7]+0.3535533905932737*gxyJ_n[6]+0.3535533905932737*gxyJ_n[5]+0.3535533905932737*gxyJ_n[4]+0.3535533905932737*gxyJ_n[3]+0.3535533905932737*gxyJ_n[2]+0.3535533905932737*gxyJ_n[1]+0.3535533905932737*gxyJ_n[0]; 
  gxyJ[1] = 0.3535533905932737*gxyJ_n[7]+0.3535533905932737*gxyJ_n[6]+0.3535533905932737*gxyJ_n[5]+0.3535533905932737*gxyJ_n[4]-0.3535533905932737*gxyJ_n[3]-0.3535533905932737*gxyJ_n[2]-0.3535533905932737*gxyJ_n[1]-0.3535533905932737*gxyJ_n[0]; 
  gxyJ[2] = 0.3535533905932737*gxyJ_n[7]+0.3535533905932737*gxyJ_n[6]-0.3535533905932737*gxyJ_n[5]-0.3535533905932737*gxyJ_n[4]+0.3535533905932737*gxyJ_n[3]+0.3535533905932737*gxyJ_n[2]-0.3535533905932737*gxyJ_n[1]-0.3535533905932737*gxyJ_n[0]; 
  gxyJ[3] = 0.3535533905932737*gxyJ_n[7]-0.3535533905932737*gxyJ_n[6]+0.3535533905932737*gxyJ_n[5]-0.3535533905932737*gxyJ_n[4]+0.3535533905932737*gxyJ_n[3]-0.3535533905932737*gxyJ_n[2]+0.3535533905932737*gxyJ_n[1]-0.3535533905932737*gxyJ_n[0]; 
  gxyJ[4] = 0.3535533905932737*gxyJ_n[7]+0.3535533905932737*gxyJ_n[6]-0.3535533905932737*gxyJ_n[5]-0.3535533905932737*gxyJ_n[4]-0.3535533905932737*gxyJ_n[3]-0.3535533905932737*gxyJ_n[2]+0.3535533905932737*gxyJ_n[1]+0.3535533905932737*gxyJ_n[0]; 
  gxyJ[5] = 0.3535533905932737*gxyJ_n[7]-0.3535533905932737*gxyJ_n[6]+0.3535533905932737*gxyJ_n[5]-0.3535533905932737*gxyJ_n[4]-0.3535533905932737*gxyJ_n[3]+0.3535533905932737*gxyJ_n[2]-0.3535533905932737*gxyJ_n[1]+0.3535533905932737*gxyJ_n[0]; 
  gxyJ[6] = 0.3535533905932737*gxyJ_n[7]-0.3535533905932737*gxyJ_n[6]-0.3535533905932737*gxyJ_n[5]+0.3535533905932737*gxyJ_n[4]+0.3535533905932737*gxyJ_n[3]-0.3535533905932737*gxyJ_n[2]-0.3535533905932737*gxyJ_n[1]+0.3535533905932737*gxyJ_n[0]; 
  gxyJ[7] = 0.3535533905932737*gxyJ_n[7]-0.3535533905932737*gxyJ_n[6]-0.3535533905932737*gxyJ_n[5]+0.3535533905932737*gxyJ_n[4]-0.3535533905932737*gxyJ_n[3]+0.3535533905932737*gxyJ_n[2]+0.3535533905932737*gxyJ_n[1]-0.3535533905932737*gxyJ_n[0]; 
// Calculate gyyJ at nodes 
gyyJ_n[0] = gr22_n[0]*J_n[0]; 
gyyJ_n[1] = gr22_n[1]*J_n[1]; 
gyyJ_n[2] = gr22_n[2]*J_n[2]; 
gyyJ_n[3] = gr22_n[3]*J_n[3]; 
gyyJ_n[4] = gr22_n[4]*J_n[4]; 
gyyJ_n[5] = gr22_n[5]*J_n[5]; 
gyyJ_n[6] = gr22_n[6]*J_n[6]; 
gyyJ_n[7] = gr22_n[7]*J_n[7]; 
// Convert nodal to modal for gyyJ 
  gyyJ[0] = 0.3535533905932737*gyyJ_n[7]+0.3535533905932737*gyyJ_n[6]+0.3535533905932737*gyyJ_n[5]+0.3535533905932737*gyyJ_n[4]+0.3535533905932737*gyyJ_n[3]+0.3535533905932737*gyyJ_n[2]+0.3535533905932737*gyyJ_n[1]+0.3535533905932737*gyyJ_n[0]; 
  gyyJ[1] = 0.3535533905932737*gyyJ_n[7]+0.3535533905932737*gyyJ_n[6]+0.3535533905932737*gyyJ_n[5]+0.3535533905932737*gyyJ_n[4]-0.3535533905932737*gyyJ_n[3]-0.3535533905932737*gyyJ_n[2]-0.3535533905932737*gyyJ_n[1]-0.3535533905932737*gyyJ_n[0]; 
  gyyJ[2] = 0.3535533905932737*gyyJ_n[7]+0.3535533905932737*gyyJ_n[6]-0.3535533905932737*gyyJ_n[5]-0.3535533905932737*gyyJ_n[4]+0.3535533905932737*gyyJ_n[3]+0.3535533905932737*gyyJ_n[2]-0.3535533905932737*gyyJ_n[1]-0.3535533905932737*gyyJ_n[0]; 
  gyyJ[3] = 0.3535533905932737*gyyJ_n[7]-0.3535533905932737*gyyJ_n[6]+0.3535533905932737*gyyJ_n[5]-0.3535533905932737*gyyJ_n[4]+0.3535533905932737*gyyJ_n[3]-0.3535533905932737*gyyJ_n[2]+0.3535533905932737*gyyJ_n[1]-0.3535533905932737*gyyJ_n[0]; 
  gyyJ[4] = 0.3535533905932737*gyyJ_n[7]+0.3535533905932737*gyyJ_n[6]-0.3535533905932737*gyyJ_n[5]-0.3535533905932737*gyyJ_n[4]-0.3535533905932737*gyyJ_n[3]-0.3535533905932737*gyyJ_n[2]+0.3535533905932737*gyyJ_n[1]+0.3535533905932737*gyyJ_n[0]; 
  gyyJ[5] = 0.3535533905932737*gyyJ_n[7]-0.3535533905932737*gyyJ_n[6]+0.3535533905932737*gyyJ_n[5]-0.3535533905932737*gyyJ_n[4]-0.3535533905932737*gyyJ_n[3]+0.3535533905932737*gyyJ_n[2]-0.3535533905932737*gyyJ_n[1]+0.3535533905932737*gyyJ_n[0]; 
  gyyJ[6] = 0.3535533905932737*gyyJ_n[7]-0.3535533905932737*gyyJ_n[6]-0.3535533905932737*gyyJ_n[5]+0.3535533905932737*gyyJ_n[4]+0.3535533905932737*gyyJ_n[3]-0.3535533905932737*gyyJ_n[2]-0.3535533905932737*gyyJ_n[1]+0.3535533905932737*gyyJ_n[0]; 
  gyyJ[7] = 0.3535533905932737*gyyJ_n[7]-0.3535533905932737*gyyJ_n[6]-0.3535533905932737*gyyJ_n[5]+0.3535533905932737*gyyJ_n[4]-0.3535533905932737*gyyJ_n[3]+0.3535533905932737*gyyJ_n[2]+0.3535533905932737*gyyJ_n[1]-0.3535533905932737*gyyJ_n[0]; 
// Calculate gxzJ at nodes 
gxzJ_n[0] = gr13_n[0]*J_n[0]; 
gxzJ_n[1] = gr13_n[1]*J_n[1]; 
gxzJ_n[2] = gr13_n[2]*J_n[2]; 
gxzJ_n[3] = gr13_n[3]*J_n[3]; 
gxzJ_n[4] = gr13_n[4]*J_n[4]; 
gxzJ_n[5] = gr13_n[5]*J_n[5]; 
gxzJ_n[6] = gr13_n[6]*J_n[6]; 
gxzJ_n[7] = gr13_n[7]*J_n[7]; 
// Convert nodal to modal for gxzJ 
  gxzJ[0] = 0.3535533905932737*gxzJ_n[7]+0.3535533905932737*gxzJ_n[6]+0.3535533905932737*gxzJ_n[5]+0.3535533905932737*gxzJ_n[4]+0.3535533905932737*gxzJ_n[3]+0.3535533905932737*gxzJ_n[2]+0.3535533905932737*gxzJ_n[1]+0.3535533905932737*gxzJ_n[0]; 
  gxzJ[1] = 0.3535533905932737*gxzJ_n[7]+0.3535533905932737*gxzJ_n[6]+0.3535533905932737*gxzJ_n[5]+0.3535533905932737*gxzJ_n[4]-0.3535533905932737*gxzJ_n[3]-0.3535533905932737*gxzJ_n[2]-0.3535533905932737*gxzJ_n[1]-0.3535533905932737*gxzJ_n[0]; 
  gxzJ[2] = 0.3535533905932737*gxzJ_n[7]+0.3535533905932737*gxzJ_n[6]-0.3535533905932737*gxzJ_n[5]-0.3535533905932737*gxzJ_n[4]+0.3535533905932737*gxzJ_n[3]+0.3535533905932737*gxzJ_n[2]-0.3535533905932737*gxzJ_n[1]-0.3535533905932737*gxzJ_n[0]; 
  gxzJ[3] = 0.3535533905932737*gxzJ_n[7]-0.3535533905932737*gxzJ_n[6]+0.3535533905932737*gxzJ_n[5]-0.3535533905932737*gxzJ_n[4]+0.3535533905932737*gxzJ_n[3]-0.3535533905932737*gxzJ_n[2]+0.3535533905932737*gxzJ_n[1]-0.3535533905932737*gxzJ_n[0]; 
  gxzJ[4] = 0.3535533905932737*gxzJ_n[7]+0.3535533905932737*gxzJ_n[6]-0.3535533905932737*gxzJ_n[5]-0.3535533905932737*gxzJ_n[4]-0.3535533905932737*gxzJ_n[3]-0.3535533905932737*gxzJ_n[2]+0.3535533905932737*gxzJ_n[1]+0.3535533905932737*gxzJ_n[0]; 
  gxzJ[5] = 0.3535533905932737*gxzJ_n[7]-0.3535533905932737*gxzJ_n[6]+0.3535533905932737*gxzJ_n[5]-0.3535533905932737*gxzJ_n[4]-0.3535533905932737*gxzJ_n[3]+0.3535533905932737*gxzJ_n[2]-0.3535533905932737*gxzJ_n[1]+0.3535533905932737*gxzJ_n[0]; 
  gxzJ[6] = 0.3535533905932737*gxzJ_n[7]-0.3535533905932737*gxzJ_n[6]-0.3535533905932737*gxzJ_n[5]+0.3535533905932737*gxzJ_n[4]+0.3535533905932737*gxzJ_n[3]-0.3535533905932737*gxzJ_n[2]-0.3535533905932737*gxzJ_n[1]+0.3535533905932737*gxzJ_n[0]; 
  gxzJ[7] = 0.3535533905932737*gxzJ_n[7]-0.3535533905932737*gxzJ_n[6]-0.3535533905932737*gxzJ_n[5]+0.3535533905932737*gxzJ_n[4]-0.3535533905932737*gxzJ_n[3]+0.3535533905932737*gxzJ_n[2]+0.3535533905932737*gxzJ_n[1]-0.3535533905932737*gxzJ_n[0]; 
// Calculate gzzJ - J/g_zz at nodes 
eps2_n[0] = gr33_n[0]*J_n[0] - J_n[0]/g33_n[0]; 
eps2_n[1] = gr33_n[1]*J_n[1] - J_n[1]/g33_n[1]; 
eps2_n[2] = gr33_n[2]*J_n[2] - J_n[2]/g33_n[2]; 
eps2_n[3] = gr33_n[3]*J_n[3] - J_n[3]/g33_n[3]; 
eps2_n[4] = gr33_n[4]*J_n[4] - J_n[4]/g33_n[4]; 
eps2_n[5] = gr33_n[5]*J_n[5] - J_n[5]/g33_n[5]; 
eps2_n[6] = gr33_n[6]*J_n[6] - J_n[6]/g33_n[6]; 
eps2_n[7] = gr33_n[7]*J_n[7] - J_n[7]/g33_n[7]; 
// Convert nodal to modal for eps2 
  eps2[0] = 0.3535533905932737*eps2_n[7]+0.3535533905932737*eps2_n[6]+0.3535533905932737*eps2_n[5]+0.3535533905932737*eps2_n[4]+0.3535533905932737*eps2_n[3]+0.3535533905932737*eps2_n[2]+0.3535533905932737*eps2_n[1]+0.3535533905932737*eps2_n[0]; 
  eps2[1] = 0.3535533905932737*eps2_n[7]+0.3535533905932737*eps2_n[6]+0.3535533905932737*eps2_n[5]+0.3535533905932737*eps2_n[4]-0.3535533905932737*eps2_n[3]-0.3535533905932737*eps2_n[2]-0.3535533905932737*eps2_n[1]-0.3535533905932737*eps2_n[0]; 
  eps2[2] = 0.3535533905932737*eps2_n[7]+0.3535533905932737*eps2_n[6]-0.3535533905932737*eps2_n[5]-0.3535533905932737*eps2_n[4]+0.3535533905932737*eps2_n[3]+0.3535533905932737*eps2_n[2]-0.3535533905932737*eps2_n[1]-0.3535533905932737*eps2_n[0]; 
  eps2[3] = 0.3535533905932737*eps2_n[7]-0.3535533905932737*eps2_n[6]+0.3535533905932737*eps2_n[5]-0.3535533905932737*eps2_n[4]+0.3535533905932737*eps2_n[3]-0.3535533905932737*eps2_n[2]+0.3535533905932737*eps2_n[1]-0.3535533905932737*eps2_n[0]; 
  eps2[4] = 0.3535533905932737*eps2_n[7]+0.3535533905932737*eps2_n[6]-0.3535533905932737*eps2_n[5]-0.3535533905932737*eps2_n[4]-0.3535533905932737*eps2_n[3]-0.3535533905932737*eps2_n[2]+0.3535533905932737*eps2_n[1]+0.3535533905932737*eps2_n[0]; 
  eps2[5] = 0.3535533905932737*eps2_n[7]-0.3535533905932737*eps2_n[6]+0.3535533905932737*eps2_n[5]-0.3535533905932737*eps2_n[4]-0.3535533905932737*eps2_n[3]+0.3535533905932737*eps2_n[2]-0.3535533905932737*eps2_n[1]+0.3535533905932737*eps2_n[0]; 
  eps2[6] = 0.3535533905932737*eps2_n[7]-0.3535533905932737*eps2_n[6]-0.3535533905932737*eps2_n[5]+0.3535533905932737*eps2_n[4]+0.3535533905932737*eps2_n[3]-0.3535533905932737*eps2_n[2]-0.3535533905932737*eps2_n[1]+0.3535533905932737*eps2_n[0]; 
  eps2[7] = 0.3535533905932737*eps2_n[7]-0.3535533905932737*eps2_n[6]-0.3535533905932737*eps2_n[5]+0.3535533905932737*eps2_n[4]-0.3535533905932737*eps2_n[3]+0.3535533905932737*eps2_n[2]+0.3535533905932737*eps2_n[1]-0.3535533905932737*eps2_n[0]; 
 
}
